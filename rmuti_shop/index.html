<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบจัดการสินค้า มหาวิทยาลัยเทคโนโลยีราชมงคลอีสาน วิทยาเขตขอนแก่น</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Sarabun', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #ff6b35 100%);
            min-height: 100vh;
            color: #333;
            display: flex;
            flex-direction: column;
        }

        /* Header ของมหาวิทยาลัย */
        .university-header {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 20px 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border-bottom: 4px solid #2a5298;
        }

        .university-header .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 25px;
        }

        .university-logo {
            width: 100px;
            height: 100px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px rgba(42, 82, 152, 0.3);
            border: 3px solid #f8f9fa;
            padding: 8px;
        }

        .university-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 50%;
        }

        .university-info h1 {
            font-size: 28px;
            font-weight: 700;
            color: #2a5298;
            margin-bottom: 5px;
            text-align: center;
        }

        .university-info h2 {
            font-size: 20px;
            font-weight: 500;
            color: #1e3c72;
            text-align: center;
            margin-bottom: 8px;
        }

        .university-info p {
            font-size: 16px;
            color: #666;
            text-align: center;
            margin: 0;
        }

        .main-wrapper {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            padding: 50px;
            width: 100%;
            max-width: 900px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .system-header {
            margin-bottom: 40px;
            padding-bottom: 25px;
            border-bottom: 2px solid #e9ecef;
        }

        .system-header h1 {
            font-size: 32px;
            font-weight: 700;
            color: #2a5298;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .system-header p {
            font-size: 18px;
            color: #666;
            margin: 0;
        }

        .cards {
            display: flex;
            justify-content: center;
            gap: 40px;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .card {
            background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
            width: 320px;
            padding: 40px 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: all 0.4s ease;
            cursor: pointer;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(42, 82, 152, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .card:hover::before {
            left: 100%;
        }

        .card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            border-color: #2a5298;
        }

        .card i {
            font-size: 64px;
            margin-bottom: 25px;
            color: #2a5298;
            transition: all 0.3s ease;
        }

        .card:hover i {
            transform: scale(1.1);
            color: #1e3c72;
        }

        .card h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 24px;
            font-weight: 600;
        }

        .card p {
            color: #666;
            font-size: 16px;
            line-height: 1.5;
            margin: 0;
        }

        /* Form Styles */
        #login-form,
        #forgot-password-form,
        #register-form,
        #profile-form {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            min-height: calc(100vh - 200px);
        }

        .form-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            max-width: 600px;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            text-align: left;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .form-container h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #2a5298;
            font-size: 28px;
            font-weight: 600;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section h3 {
            color: #2a5298;
            font-size: 20px;
            margin-bottom: 20px;
            border-bottom: 2px solid #2a5298;
            padding-bottom: 8px;
        }

        .form-container input,
        .form-container select,
        select,
        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="password"],
        input[type="number"],
        input[type="date"],
        input[type="time"] {
            width: 100%;
            padding: 15px 20px;
            margin: 10px 0;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            box-sizing: border-box;
            font-size: 16px;
            font-family: 'Sarabun', sans-serif;
            transition: all 0.3s ease;
            background: #fff !important;
            color: #333 !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .form-container input:focus,
        .form-container select:focus {
            border-color: #2a5298;
            outline: none;
            box-shadow: 0 0 15px rgba(42, 82, 152, 0.2);
            transform: translateY(-2px);
        }

        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 16px;
        }

        .password-container {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #666;
            font-size: 20px;
            transition: color 0.3s ease;
        }

        .password-toggle:hover {
            color: #2a5298;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            transition: all 0.3s ease;
            font-family: 'Sarabun', sans-serif;
            min-width: 120px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #2a5298, #1e3c72);
            color: white;
            box-shadow: 0 4px 15px rgba(42, 82, 152, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(42, 82, 152, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #6c757d, #5a6268);
            color: white;
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
        }

        .btn-warning {
            background: linear-gradient(45deg, #ff6b35, #ffa726);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.4);
        }

        .btn-success {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
        }

        .btn-info {
            background: linear-gradient(45deg, #17a2b8, #138496);
            color: white;
            box-shadow: 0 4px 15px rgba(23, 162, 184, 0.3);
        }

        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(23, 162, 184, 0.4);
        }

        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(220, 53, 69, 0.4);
        }

        .error-message {
            color: #dc3545;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        .success-message {
            color: #28a745;
            font-size: 14px;
            margin-top: 10px;
            padding: 15px;
            background-color: rgba(40, 167, 69, 0.1);
            border: 1px solid rgba(40, 167, 69, 0.3);
            border-radius: 10px;
            display: none;
        }

        /* Student Dashboard Styles */
        .dashboard-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            padding: 30px;
            width: 100%;
            max-width: 1400px;
            margin: 20px auto;
        }

        .dashboard-header {
            background: linear-gradient(135deg, #2a5298, #1e3c72);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 10px 30px rgba(42, 82, 152, 0.3);
        }

        .dashboard-nav {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .nav-icon {
            cursor: pointer;
            font-size: 24px;
            padding: 12px;
            border-radius: 50%;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-icon:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .cart-icon {
            position: relative;
            cursor: pointer;
            font-size: 24px;
            padding: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .cart-icon:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(45deg, #ff6b35, #f5515f);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(245, 81, 95, 0.4);
        }

        .logout-btn {
            background: linear-gradient(45deg, #ff6b35, #f5515f);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(245, 81, 95, 0.3);
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 81, 95, 0.4);
        }

        /* Shop Styles */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .product-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
            border-color: #2a5298;
        }

        .product-image {
            width: 100%;
            height: 220px;
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            transition: transform 0.3s ease;
        }

        .product-card:hover .product-image img {
            transform: scale(1.05);
        }

        .product-info {
            padding: 25px;
        }

        .product-name {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .product-description {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .product-price {
            font-size: 22px;
            font-weight: 700;
            color: #2a5298;
            margin-bottom: 20px;
        }

        .product-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 10px 16px;
            font-size: 14px;
            flex: 1;
            border-radius: 8px;
        }

        .category-filter {
            margin-bottom: 25px;
            text-align: center;
        }

        .category-filter select {
            padding: 15px 25px;
            border: 2px solid #2a5298;
            border-radius: 15px;
            font-size: 16px;
            background-color: white;
            font-family: 'Sarabun', sans-serif;
            box-shadow: 0 4px 12px rgba(42, 82, 152, 0.1);
        }

        /* Admin Dashboard Styles */
        .admin-dashboard {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            padding: 30px;
            width: 100%;
            max-width: 1400px;
            margin: 20px auto;
        }

        .admin-header {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 10px 30px rgba(220, 53, 69, 0.3);
        }

        .admin-menu {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .admin-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .admin-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
            border-color: #dc3545;
        }

        .admin-card i {
            font-size: 48px;
            color: #dc3545;
            margin-bottom: 15px;
        }

        .admin-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 20px;
        }

        .admin-card p {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .stat-number {
            font-size: 36px;
            font-weight: 700;
            color: #2a5298;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-size: 16px;
            font-weight: 600;
        }

        /* Table Styles - แก้ไขใหม่ */
        .table-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border: 2px solid #2a5298;
            border-radius: 10px;
            overflow: hidden;
        }

        .table th {
            background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
            color: white;
            font-weight: 600;
            padding: 15px;
            text-align: center;
            border: 1px solid #ffffff;
            font-size: 16px;
        }

        .table td {
            padding: 15px;
            text-align: center;
            vertical-align: middle;
            border: 1px solid #dee2e6;
            background: white;
            transition: background-color 0.2s ease;
        }

        .table tr:nth-child(even) td {
            background: #f8f9fa;
        }

        .table tr:hover td {
            background: #e3f2fd;
        }

        /* ปรับแต่งรูปภาพในตาราง */
        .table td img {
            display: block;
            margin: 0 auto;
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }

        /* ปรับแต่งปุ่มในตาราง */
        .table td .btn {
            margin: 3px;
            white-space: nowrap;
            font-size: 14px;
            padding: 8px 12px;
        }

        /* สีสำหรับสต็อก */
        .stock-high {
            color: #28a745;
            font-weight: 700;
        }

        .stock-medium {
            color: #ffc107;
            font-weight: 700;
        }

        .stock-low {
            color: #dc3545;
            font-weight: 700;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
        }

        .status-pending-payment {
            background: #fff3cd;
            color: #856404;
        }

        .status-pending-confirmation {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-pending-approval {
            background: #e2e3e5;
            color: #383d41;
        }

        .status-preparing {
            background: #cce5ff;
            color: #004085;
        }

        .status-ready {
            background: #d4edda;
            color: #155724;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        /* Order Tracking Styles */
        .order-tracking {
            margin: 20px 0;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 1px solid #dee2e6;
        }

        .tracking-timeline {
            position: relative;
            padding: 20px 0;
        }

        .tracking-step {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            position: relative;
        }

        .tracking-step:last-child {
            margin-bottom: 0;
        }

        .step-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-right: 20px;
            z-index: 2;
            position: relative;
        }

        .step-completed {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
        }

        .step-current {
            background: linear-gradient(45deg, #ffc107, #ffca2c);
            color: #333;
            animation: pulse 2s infinite;
        }

        .step-pending {
            background: #e9ecef;
            color: #6c757d;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .step-description {
            color: #666;
            font-size: 14px;
            margin-bottom: 3px;
        }

        .step-time {
            color: #999;
            font-size: 12px;
        }

        .tracking-line {
            position: absolute;
            left: 25px;
            top: 70px;
            bottom: 25px;
            width: 2px;
            background: #dee2e6;
            z-index: 1;
        }

        .tracking-step:last-child .tracking-line {
            display: none;
        }

        .step-completed+.tracking-step .tracking-line {
            background: linear-gradient(to bottom, #28a745, #dee2e6);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(30, 60, 114, 0.9) 0%, rgba(42, 82, 152, 0.8) 50%, rgba(255, 107, 53, 0.9) 100%);
            backdrop-filter: blur(15px);
            animation: modalOverlayFadeIn 0.3s ease;
        }

        .modal-content {
            background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
            margin: 2% auto;
            padding: 45px;
            border-radius: 25px;
            width: 92%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow:
                0 25px 80px rgba(0, 0, 0, 0.25),
                0 0 0 1px rgba(255, 255, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(42, 82, 152, 0.1);
            position: relative;
            animation: modalContentSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: #aaa;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            background: rgba(220, 53, 69, 0.1);
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .close:hover {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 8px 25px rgba(220, 53, 69, 0.4);
        }

        .footer {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #ffffff;
            text-align: center;
            padding: 20px;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
        }

        .footer p {
            margin: 0;
            font-size: 14px;
            font-weight: 400;
        }

        /* Order Actions */
        .order-actions {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            text-align: center;
        }

        .notification-banner {
            position: fixed;
            top: 20px;
            right: 20px;
            max-width: 400px;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            font-weight: 600;
            animation: slideInRight 0.5s ease;
        }

        .notification-success {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
        }

        .notification-error {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
        }

        .notification-info {
            background: linear-gradient(45deg, #17a2b8, #138496);
            color: white;
        }

        .notification-warning {
            background: linear-gradient(45deg, #ffc107, #ffca2c);
            color: #333;
        }

        /* Profile Management Styles */
        .profile-tabs {
            display: flex;
            gap: 15px;
            border-bottom: 3px solid transparent;
            background: linear-gradient(90deg, #e9ecef, #dee2e6, #e9ecef);
            border-radius: 15px 15px 0 0;
            margin-bottom: 35px;
            padding: 5px;
        }

        .tab-btn {
            padding: 15px 25px;
            border: none;
            background: transparent;
            color: #666;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.4s ease;
            font-family: 'Sarabun', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #2a5298, #1e3c72);
            color: white;
            transform: translateY(-3px) scale(1.05);
            box-shadow:
                0 10px 25px rgba(42, 82, 152, 0.3),
                0 0 0 3px rgba(42, 82, 152, 0.1);
        }

        .tab-btn:hover:not(.active) {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            color: #2a5298;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeInUp 0.3s ease;
        }

        .password-strength {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 15px;
            border: 2px solid #e9ecef;
            box-shadow:
                0 5px 15px rgba(0, 0, 0, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
        }

        .strength-label {
            font-size: 15px;
            font-weight: 700;
            color: #2a5298;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .strength-meter {
            width: 100%;
            height: 12px;
            background: linear-gradient(90deg, #e9ecef, #dee2e6);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 12px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .strength-bar {
            height: 100%;
            width: 0%;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 10px;
            position: relative;
        }

        .strength-text {
            font-size: 14px;
            font-weight: 700;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        #student-profile-modal .modal-content {
            max-width: 800px;
            max-height: 90vh;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .university-header .container {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .university-logo {
                width: 80px;
                height: 80px;
            }

            .university-info h1 {
                font-size: 22px;
            }

            .university-info h2 {
                font-size: 18px;
            }

            .cards {
                flex-direction: column;
                align-items: center;
            }

            .card {
                width: 100%;
                max-width: 400px;
            }

            .container {
                padding: 30px 20px;
                margin: 10px;
            }

            .system-header h1 {
                font-size: 26px;
            }

            .system-header p {
                font-size: 16px;
            }

            .form-container {
                margin: 10px;
                padding: 30px 20px;
            }

            .dashboard-nav {
                gap: 10px;
            }

            .nav-icon {
                font-size: 20px;
                padding: 10px;
            }

            .search-bar input {
                width: 100%;
            }

            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .button-group {
                flex-direction: column;
                align-items: center;
            }

            .btn {
                width: 100%;
                max-width: 250px;
            }

            .admin-menu {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                margin: 5% auto;
                padding: 20px;
            }

            .tracking-step {
                flex-direction: column;
                text-align: center;
            }

            .step-icon {
                margin-right: 0;
                margin-bottom: 10px;
            }

            .tracking-line {
                left: 50%;
                transform: translateX(-50%);
            }
        }

        @media (max-width: 480px) {
            .university-info h1 {
                font-size: 18px;
            }

            .university-info h2 {
                font-size: 16px;
            }

            .system-header h1 {
                font-size: 22px;
            }

            .product-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }

            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        .notification-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }

            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes modalOverlayFadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes modalContentSlideIn {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(-50px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        @keyframes tabContentFadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        .card {
            animation: fadeInUp 0.6s ease-out;
        }

        .card:nth-child(2) {
            animation-delay: 0.2s;
        }
    </style>
</head>

<body>
    <!-- Header ของมหาวิทยาลัย -->
    <div class="university-header">
        <div class="container">
            <div class="university-logo">
                <img src="image/Rhatchamongkon.png" alt="ตราสัญลักษณ์มหาวิทยาลัยเทคโนโลยีราชมงคลอีสาน">
            </div>
            <div class="university-info">
                <h1>มหาวิทยาลัยเทคโนโลยีราชมงคลอีสาน</h1>
                <h2>วิทยาเขตขอนแก่น</h2>
                <p>Rajamangala University of Technology Isan, Khon Kaen Campus</p>
            </div>
        </div>
    </div>

    <!-- หน้าหลัก -->
    <div class="main-wrapper">
        <div class="container" id="main-content">
            <div class="system-header">
                <h1><i class="fas fa-store"></i> RMUTI KKC SHOP</h1>
                <p>เลือกประเภทผู้ใช้เพื่อเข้าสู่ระบบ</p>
            </div>

            <div class="cards">
                <div class="card" onclick="showLoginForm('student')">
                    <i class="fas fa-user-graduate"></i>
                    <h2>สำหรับนักศึกษา</h2>
                    <p>เข้าสู่ระบบสำหรับซื้อสินค้า</p>
                </div>

                <div class="card" onclick="showLoginForm('admin')">
                    <i class="fas fa-user-tie"></i>
                    <h2>สำหรับเจ้าหน้าที่</h2>
                    <p>เข้าสู่ระบบจัดการร้านค้า</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ฟอร์มการเข้าสู่ระบบ -->
    <div id="login-form" style="display: none;">
        <div class="form-container" id="student-login-form" style="display: none;">
            <h2><i class="fas fa-user-graduate"></i> เข้าสู่ระบบนักศึกษา</h2>
            <form id="studentLoginForm">
                <div class="form-group">
                    <label for="student-id"><i class="fas fa-id-card"></i> รหัสนักศึกษา</label>
                    <input type="text" id="student-id" placeholder="กรอกรหัสนักศึกษา" required>
                </div>
                <div class="form-group">
                    <label for="student-password"><i class="fas fa-lock"></i> รหัสผ่าน</label>
                    <div class="password-container">
                        <input type="password" id="student-password" placeholder="กรอกรหัสผ่าน" required>
                        <i class="fas fa-eye password-toggle" onclick="togglePassword('student-password', this)"></i>
                    </div>
                </div>
                <div class="button-group">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt"></i> เข้าสู่ระบบ
                    </button>
                    <a href="javascript:void(0);" class="btn btn-warning" onclick="goBack()">
                        <i class="fas fa-arrow-left"></i> กลับ
                    </a>
                </div>
            </form>
            <p style="text-align: center; margin-top: 20px;">
                ยังไม่มีบัญชี? <a href="javascript:void(0);" onclick="showRegisterForm('student')"
                    style="color: #2a5298; font-weight: 600;">ลงทะเบียนที่นี่</a>
            </p>
            <p style="text-align: center; margin-top: 10px;">
                <a href="javascript:void(0);" onclick="showForgotPasswordForm('student')"
                    style="color: #dc3545; font-weight: 600; text-decoration: underline;">
                    <i class="fas fa-key"></i> ลืมรหัสผ่าน?
                </a>
            </p>
        </div>

        <div class="form-container" id="admin-login-form" style="display: none;">
            <h2><i class="fas fa-user-tie"></i> เข้าสู่ระบบเจ้าหน้าที่</h2>
            <form id="adminLoginForm">
                <div class="form-group">
                    <label for="admin-id"><i class="fas fa-id-badge"></i> รหัสเจ้าหน้าที่</label>
                    <input type="text" id="admin-id" placeholder="กรอกรหัสเจ้าหน้าที่" required>
                </div>
                <div class="form-group">
                    <label for="admin-password"><i class="fas fa-lock"></i> รหัสผ่าน</label>
                    <div class="password-container">
                        <input type="password" id="admin-password" placeholder="กรอกรหัสผ่าน" required>
                        <i class="fas fa-eye password-toggle" onclick="togglePassword('admin-password', this)"></i>
                    </div>
                </div>
                <div class="button-group">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt"></i> เข้าสู่ระบบ
                    </button>
                    <a href="javascript:void(0);" class="btn btn-warning" onclick="goBack()">
                        <i class="fas fa-arrow-left"></i> กลับ
                    </a>
                </div>
            </form>
            <p style="text-align: center; margin-top: 20px;">
                ยังไม่มีบัญชี? <a href="javascript:void(0);" onclick="showRegisterForm('student')"
                    style="color: #2a5298; font-weight: 600;">ลงทะเบียนที่นี่</a>
            </p>
            <p style="text-align: center; margin-top: 10px;">
                <a href="javascript:void(0);" onclick="showForgotPasswordForm('student')"
                    style="color: #dc3545; font-weight: 600; text-decoration: underline;">
                    <i class="fas fa-key"></i> ลืมรหัสผ่าน?
                </a>
            </p>
        </div>
    </div>

    <!-- ฟอร์มการลงทะเบียน -->
    <div id="register-form" style="display: none;">
        <div class="form-container" id="student-register-form" style="display: none;">
            <h2><i class="fas fa-user-plus"></i> ลงทะเบียนนักศึกษา</h2>
            <form id="studentRegForm">
                <div class="form-section">
                    <h3><i class="fas fa-user"></i> ข้อมูลส่วนตัว</h3>
                    <div class="form-group">
                        <label for="new-student-id">รหัสนักศึกษา *</label>
                        <input type="text" id="new-student-id" placeholder="กรอกรหัสนักศึกษา" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="student-firstname">ชื่อ *</label>
                            <input type="text" id="student-firstname" placeholder="กรอกชื่อ" required>
                        </div>
                        <div class="form-group">
                            <label for="student-lastname">นามสกุล *</label>
                            <input type="text" id="student-lastname" placeholder="กรอกนามสกุล" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="student-faculty">คณะ *</label>
                        <select id="student-faculty" required>
                            <option value="">เลือกคณะ</option>
                            <option value="engineering">คณะวิศวกรรมศาสตร์</option>
                            <option value="business">คณะบริหารธุรกิจและเทคโนโลยีสารสนเทศ</option>
                            <option value="education">คณะครุศาสตร์อุตสาหกรรม</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="student-major">สาขาวิชา *</label>
                            <input type="text" id="student-major" placeholder="กรอกสาขาวิชา" required>
                        </div>
                        <div class="form-group">
                            <label for="student-year">ชั้นปี *</label>
                            <select id="student-year" required>
                                <option value="">เลือกชั้นปี</option>
                                <option value="1">ปี 1</option>
                                <option value="2">ปี 2</option>
                                <option value="3">ปี 3</option>
                                <option value="4">ปี 4</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="student-email">อีเมล *</label>
                        <input type="email" id="student-email" placeholder="กรอกที่อยู่อีเมล" required>
                    </div>

                    <div class="form-group">
                        <label for="student-phone">เบอร์โทรศัพท์ *</label>
                        <input type="tel" id="student-phone" placeholder="กรอกเบอร์โทรศัพท์" required>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-lock"></i> ข้อมูลการเข้าสู่ระบบ</h3>
                    <div class="form-group">
                        <label for="new-student-password">รหัสผ่าน *</label>
                        <div class="password-container">
                            <input type="password" id="new-student-password" placeholder="กรอกรหัสผ่าน" required>
                            <i class="fas fa-eye password-toggle"
                                onclick="togglePassword('new-student-password', this)"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="confirm-student-password">ยืนยันรหัสผ่าน *</label>
                        <div class="password-container">
                            <input type="password" id="confirm-student-password" placeholder="ยืนยันรหัสผ่าน" required>
                            <i class="fas fa-eye password-toggle"
                                onclick="togglePassword('confirm-student-password', this)"></i>
                        </div>
                        <div class="error-message" id="password-error">รหัสผ่านไม่ตรงกัน</div>
                    </div>
                </div>

                <div class="button-group">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-user-plus"></i> ลงทะเบียน
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="showLoginForm('student')">
                        <i class="fas fa-arrow-left"></i> กลับไปเข้าสู่ระบบ
                    </button>
                </div>
            </form>
        </div>

        <div class="form-container" id="admin-register-form" style="display: none;">
            <h2><i class="fas fa-user-plus"></i> ลงทะเบียนเจ้าหน้าที่</h2>
            <form id="adminRegForm">
                <div class="form-section">
                    <h3><i class="fas fa-user"></i> ข้อมูลส่วนตัว</h3>
                    <div class="form-group">
                        <label for="new-admin-id">รหัสเจ้าหน้าที่ *</label>
                        <input type="text" id="new-admin-id" placeholder="กรอกรหัสเจ้าหน้าที่" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="admin-firstname">ชื่อ *</label>
                            <input type="text" id="admin-firstname" placeholder="กรอกชื่อ" required>
                        </div>
                        <div class="form-group">
                            <label for="admin-lastname">นามสกุล *</label>
                            <input type="text" id="admin-lastname" placeholder="กรอกนามสกุล" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="admin-department">สาขาวิชา/แผนก *</label>
                        <input type="text" id="admin-department" placeholder="กรอกสาขาวิชาหรือแผนกที่สังกัด" required>
                    </div>

                    <div class="form-group">
                        <label for="admin-email">อีเมล *</label>
                        <input type="email" id="admin-email" placeholder="กรอกที่อยู่อีเมล" required>
                    </div>

                    <div class="form-group">
                        <label for="admin-phone">เบอร์โทรศัพท์ *</label>
                        <input type="tel" id="admin-phone" placeholder="กรอกเบอร์โทรศัพท์" required>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-lock"></i> ข้อมูลการเข้าสู่ระบบ</h3>
                    <div class="form-group">
                        <label for="new-admin-password">รหัสผ่าน *</label>
                        <div class="password-container">
                            <input type="password" id="new-admin-password" placeholder="กรอกรหัสผ่าน" required>
                            <i class="fas fa-eye password-toggle"
                                onclick="togglePassword('new-admin-password', this)"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="confirm-admin-password">ยืนยันรหัสผ่าน *</label>
                        <div class="password-container">
                            <input type="password" id="confirm-admin-password" placeholder="ยืนยันรหัสผ่าน" required>
                            <i class="fas fa-eye password-toggle"
                                onclick="togglePassword('confirm-admin-password', this)"></i>
                        </div>
                        <div class="error-message" id="admin-password-error">รหัสผ่านไม่ตรงกัน</div>
                    </div>
                </div>

                <div class="button-group">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-user-plus"></i> ลงทะเบียน
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="showLoginForm('admin')">
                        <i class="fas fa-arrow-left"></i> กลับไปเข้าสู่ระบบ
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ฟอร์มลืมรหัสผ่าน -->
    <div id="forgot-password-form" style="display: none;">
        <div class="form-container" id="student-forgot-form" style="display: none;">
            <h2><i class="fas fa-key"></i> ลืมรหัสผ่านนักศึกษา</h2>
            <form id="studentForgotForm">
                <div class="form-group">
                    <label for="forgot-student-fullname"><i class="fas fa-user"></i> ชื่อ-นามสกุล</label>
                    <input type="text" id="forgot-student-fullname" placeholder="กรอกชื่อ-นามสกุล" required>
                </div>

                <div class="form-group">
                    <label for="forgot-student-national-id"><i class="fas fa-id-card"></i> รหัสประจำตัวประชาชน</label>
                    <input type="text" id="forgot-student-national-id" placeholder="กรอกรหัสประจำตัวประชาชน 13 หลัก"
                        maxlength="13" required>
                </div>

                <div class="form-group">
                    <label for="forgot-student-id"><i class="fas fa-graduation-cap"></i> รหัสนักศึกษา</label>
                    <input type="text" id="forgot-student-id" placeholder="กรอกรหัสนักศึกษา" required>
                </div>

                <div class="form-group">
                    <label for="forgot-student-new-password"><i class="fas fa-lock"></i> รหัสผ่านใหม่</label>
                    <div class="password-container">
                        <input type="password" id="forgot-student-new-password"
                            placeholder="กรุณาระบุความยาวไม่น้อยกว่า 6 ตัว" minlength="6" required>
                        <i class="fas fa-eye password-toggle"
                            onclick="togglePassword('forgot-student-new-password', this)"></i>
                    </div>
                    <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                        <i class="fas fa-info-circle"></i> รหัสผ่านต้องมีอย่างน้อย 6 ตัวอักษร
                    </small>
                </div>

                <div class="form-group">
                    <label for="forgot-student-confirm-password"><i class="fas fa-lock"></i> ยืนยันรหัสผ่าน</label>
                    <div class="password-container">
                        <input type="password" id="forgot-student-confirm-password" placeholder="ยืนยันรหัสผ่านใหม่"
                            required>
                        <i class="fas fa-eye password-toggle"
                            onclick="togglePassword('forgot-student-confirm-password', this)"></i>
                    </div>
                    <div class="error-message" id="student-forgot-password-error">รหัสผ่านไม่ตรงกัน</div>
                </div>

                <div class="button-group">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Save
                    </button>
                    <a href="javascript:void(0);" class="btn btn-secondary" onclick="showLoginForm('student')">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                </div>
            </form>
        </div>

        <div class="form-container" id="admin-forgot-form" style="display: none;">
            <h2><i class="fas fa-key"></i> ลืมรหัสผ่านเจ้าหน้าที่</h2>
            <form id="adminForgotForm">
                <div class="form-group">
                    <label for="forgot-admin-fullname"><i class="fas fa-user"></i> ชื่อ-นามสกุล</label>
                    <input type="text" id="forgot-admin-fullname" placeholder="กรอกชื่อ-นามสกุล" required>
                </div>

                <div class="form-group">
                    <label for="forgot-admin-national-id"><i class="fas fa-id-card"></i> รหัสประจำตัวประชาชน</label>
                    <input type="text" id="forgot-admin-national-id" placeholder="กรอกรหัสประจำตัวประชาชน 13 หลัก"
                        maxlength="13" required>
                </div>

                <div class="form-group">
                    <label for="forgot-admin-id"><i class="fas fa-id-badge"></i> รหัสเจ้าหน้าที่</label>
                    <input type="text" id="forgot-admin-id" placeholder="กรอกรหัสเจ้าหน้าที่" required>
                </div>

                <div class="form-group">
                    <label for="forgot-admin-new-password"><i class="fas fa-lock"></i> รหัสผ่านใหม่</label>
                    <div class="password-container">
                        <input type="password" id="forgot-admin-new-password"
                            placeholder="กรุณาระบุความยาวไม่น้อยกว่า 6 ตัว" minlength="6" required>
                        <i class="fas fa-eye password-toggle"
                            onclick="togglePassword('forgot-admin-new-password', this)"></i>
                    </div>
                    <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                        <i class="fas fa-info-circle"></i> รหัสผ่านต้องมีอย่างน้อย 6 ตัวอักษร
                    </small>
                </div>

                <div class="form-group">
                    <label for="forgot-admin-confirm-password"><i class="fas fa-lock"></i> ยืนยันรหัสผ่าน</label>
                    <div class="password-container">
                        <input type="password" id="forgot-admin-confirm-password" placeholder="ยืนยันรหัสผ่านใหม่"
                            required>
                        <i class="fas fa-eye password-toggle"
                            onclick="togglePassword('forgot-admin-confirm-password', this)"></i>
                    </div>
                    <div class="error-message" id="admin-forgot-password-error">รหัสผ่านไม่ตรงกัน</div>
                </div>

                <div class="button-group">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Save
                    </button>
                    <a href="javascript:void(0);" class="btn btn-secondary" onclick="showLoginForm('admin')">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Dashboard สำหรับนักศึกษา -->
    <div class="dashboard-container" id="student-dashboard" style="display: none;">
        <div class="dashboard-header">
            <div class="search-bar" style="margin: 20px 0; text-align: center;">
                <div style="position: relative; display: inline-block; width: 100%; max-width: 500px;">
                    <input type="text" id="product-search" placeholder="🔍 ค้นหาสินค้า..." onkeyup="searchProducts()"
                        style="width: 100%; padding: 12px 45px 12px 20px; border-radius: 25px; border: 2px solid #e9ecef; font-size: 16px; transition: all 0.3s ease;">
                    <i class="fas fa-search"
                        style="position: absolute; right: 20px; top: 50%; transform: translateY(-50%); color: #999;"></i>
                </div>
            </div>
            <div>
                <h1><i class="fas fa-store"></i> ร้านค้ามหาวิทยาลัย</h1>
                <p id="student-welcome-message">ยินดีต้อนรับสู่ RMUTI KKC SHOP</p>
            </div>
            <div class="dashboard-nav">
                <div class="nav-icon" onclick="showStudentProfile()" title="แก้ไขโปรไฟล์">
                    <i class="fas fa-user-edit"></i>
                </div>
                <div class="nav-icon" onclick="showOrderHistory()" title="ประวัติการสั่งซื้อ">
                    <i class="fas fa-history"></i>
                </div>
                <div class="nav-icon" onclick="showNotifications()" title="การแจ้งเตือน" style="position: relative;">
                    <i class="fas fa-bell"></i>
                    <span class="notification-count" id="notification-count"
                        style="position: absolute; top: -5px; right: -5px; background: linear-gradient(45deg, #dc3545, #c82333); color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 11px; font-weight: 600; display: none; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(220, 53, 69, 0.4);">0</span>
                </div>
                <div class="cart-icon" onclick="showCart()" title="ตะกร้าสินค้า">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count" id="cart-count">0</span>
                </div>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> ออกจากระบบ
                </button>
            </div>
        </div>
        <div class="category-filter">
            <select id="category-filter" onchange="filterByCategory()">
                <option value="">📋 ทุกหมวดหมู่</option>
                <option value="Learning Supplies">📚 อุปกรณ์การเรียน</option>
                <option value="Student Uniform">👔 เครื่องแบบนักศึกษา</option>
                <option value="Activity">🎽 เสื้อกิจกรรม</option>
                <option value="Souvenirs">🎁 ของที่ระลึก</option>
            </select>
        </div>

        <!-- แสดงสินค้า -->
        <div class="product-grid" id="product-grid">
            <!-- สินค้าจะถูกโหลดที่นี่ -->
        </div>
    </div>

    <!-- Dashboard สำหรับ Admin -->
    <div class="admin-dashboard" id="admin-dashboard" style="display: none;">
        <div class="admin-header">
            <div>
                <h1><i class="fas fa-tachometer-alt"></i> ระบบจัดการ Admin</h1>
                <p id="admin-welcome-message">ยินดีต้อนรับเจ้าหน้าที่</p>
            </div>
            <div class="dashboard-nav">
                <div class="nav-icon" onclick="showAdminProfile()" title="แก้ไขโปรไฟล์">
                    <i class="fas fa-user-edit"></i>
                </div>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> ออกจากระบบ
                </button>
            </div>
        </div>

        <!-- สถิติรวม -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="total-products">4</div>
                <div class="stat-label">สินค้าทั้งหมด</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="total-orders">3</div>
                <div class="stat-label">คำสั่งซื้อ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="pending-orders">1</div>
                <div class="stat-label">รอดำเนินการ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="total-revenue">1,400</div>
                <div class="stat-label">รายได้ (บาท)</div>
            </div>
        </div>

        <!-- เมนู Admin -->
        <div class="admin-menu">
            <div class="admin-card" onclick="showProductManagement()">
                <i class="fas fa-box"></i>
                <h3>จัดการสินค้า</h3>
                <p>เพิ่ม แก้ไข ลบสินค้า และจัดการคลังสินค้า</p>
            </div>

            <div class="admin-card" onclick="showOrderManagement()">
                <i class="fas fa-shopping-cart"></i>
                <h3>จัดการคำสั่งซื้อ</h3>
                <p>ตรวจสอบและยืนยันคำสั่งซื้อจากนักศึกษา</p>
            </div>

            <div class="admin-card" onclick="showPaymentManagement()">
                <i class="fas fa-credit-card"></i>
                <h3>จัดการการชำระเงิน</h3>
                <p>ตรวจสอบและอนุมัติการชำระเงินจากนักศึกษา</p>
            </div>

            <div class="admin-card" onclick="showUserManagement()">
                <i class="fas fa-users"></i>
                <h3>จัดการผู้ใช้</h3>
                <p>จัดการข้อมูลนักศึกษาและเจ้าหน้าที่</p>
            </div>

            <div class="admin-card" onclick="showReports()">
                <i class="fas fa-chart-bar"></i>
                <h3>รายงาน</h3>
                <p>ดูรายงานการขาย สถิติ และข้อมูลต่างๆ</p>
            </div>

            <div class="admin-card" onclick="showInventoryManagement()">
                <i class="fas fa-warehouse"></i>
                <h3>จัดการคลัง</h3>
                <p>ตรวจสอบสต็อก รับสินค้า และจ่ายสินค้า</p>
            </div>

            <div class="admin-card" onclick="showQRScanner()">
                <i class="fas fa-qrcode"></i>
                <h3>รับสินค้า (QR Code)</h3>
                <p>สแกน QR Code หรือกรอกรหัสเพื่อยืนยันการรับสินค้า</p>
            </div>

            <div class="admin-card" onclick="showSettings()">
                <i class="fas fa-cog"></i>
                <h3>ตั้งค่าระบบ</h3>
                <p>จัดการข้อมูลพื้นฐาน คณะ สาขา และการตั้งค่า</p>
            </div>
        </div>

        <!-- ตารางคำสั่งซื้อล่าสุด -->
        <div class="table-container">
            <h3><i class="fas fa-clock"></i> คำสั่งซื้อล่าสุด</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>รหัสคำสั่งซื้อ</th>
                        <th>รหัสนักศึกษา</th>
                        <th>ชื่อ-สกุล</th>
                        <th>ระดับ</th>
                        <th>รายการสั่งซื้อ</th>
                        <th>ราคา</th>
                        <th>สถานะ</th>
                        <th>การชำระเงิน</th>
                        <th>การจัดการ</th>
                    </tr>
                </thead>
                <tbody id="recent-orders">
                    <!-- ข้อมูลจะถูกโหลดที่นี่ -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal จัดการผู้ใช้ (Admin) -->
    <div id="user-management-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeUserManagement()">&times;</span>
            <h2><i class="fas fa-users"></i> จัดการผู้ใช้</h2>

            <!-- เพิ่ม Tabs -->
            <div class="profile-tabs" style="margin-bottom: 25px; justify-content: center;">
                <button class="tab-btn active" onclick="showUserTab('all')" id="tab-all">
                    <i class="fas fa-users"></i> ทั้งหมด (<span id="count-all">0</span>)
                </button>
                <button class="tab-btn" onclick="showUserTab('students')" id="tab-students">
                    <i class="fas fa-user-graduate"></i> นักศึกษา (<span id="count-students">0</span>)
                </button>
                <button class="tab-btn" onclick="showUserTab('admins')" id="tab-admins">
                    <i class="fas fa-user-tie"></i> เจ้าหน้าที่ (<span id="count-admins">0</span>)
                </button>
            </div>

            <!-- เพิ่มปุ่มจัดการ -->
            <div style="margin-bottom: 25px; text-align: center;">
                <div id="management-buttons-all" class="button-group" style="display: inline-flex; gap: 15px;">
                    <button class="btn btn-success" onclick="showAddStudentForm()">
                        <i class="fas fa-user-plus"></i> เพิ่มนักศึกษา
                    </button>
                    <button class="btn btn-primary" onclick="showAddAdminForm()">
                        <i class="fas fa-user-tie"></i> เพิ่มเจ้าหน้าที่
                    </button>
                    <button class="btn btn-info" onclick="showImportStudentsModal()">
                        <i class="fas fa-file-excel"></i> Import นักศึกษา
                    </button>
                </div>

                <div id="management-buttons-students" class="button-group" style="display: none; gap: 15px;">
                    <button class="btn btn-success" onclick="showAddStudentForm()">
                        <i class="fas fa-user-plus"></i> เพิ่มนักศึกษา
                    </button>
                    <button class="btn btn-info" onclick="showImportStudentsModal()">
                        <i class="fas fa-file-excel"></i> Import จาก Excel
                    </button>
                </div>

                <div id="management-buttons-admins" class="button-group" style="display: none; gap: 15px;">
                    <button class="btn btn-primary" onclick="showAddAdminForm()">
                        <i class="fas fa-user-tie"></i> เพิ่มเจ้าหน้าที่
                    </button>
                </div>
            </div>

            <div style="margin-bottom: 20px; text-align: center;">
                <div style="display: inline-flex; gap: 15px; flex-wrap: wrap;">
                    <div
                        style="background: linear-gradient(45deg, #2a5298, #1e3c72); color: white; padding: 15px 25px; border-radius: 10px; text-align: center; min-width: 150px;">
                        <div style="font-size: 24px; font-weight: 700;" id="student-count">0</div>
                        <div style="font-size: 14px; opacity: 0.9;">นักศึกษา</div>
                    </div>
                    <div
                        style="background: linear-gradient(45deg, #dc3545, #c82333); color: white; padding: 15px 25px; border-radius: 10px; text-align: center; min-width: 150px;">
                        <div style="font-size: 24px; font-weight: 700;" id="admin-count">0</div>
                        <div style="font-size: 14px; opacity: 0.9;">เจ้าหน้าที่</div>
                    </div>
                    <div
                        style="background: linear-gradient(45deg, #28a745, #20c997); color: white; padding: 15px 25px; border-radius: 10px; text-align: center; min-width: 150px;">
                        <div style="font-size: 24px; font-weight: 700;" id="total-users">0</div>
                        <div style="font-size: 14px; opacity: 0.9;">รวมทั้งหมด</div>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>ประเภท</th>
                            <th>รหัส</th>
                            <th>ชื่อ-นามสกุล</th>
                            <th>อีเมล</th>
                            <th>เบอร์โทร</th>
                            <th>หน่วยงาน/คณะ</th>
                            <th>จัดการ</th>
                        </tr>
                    </thead>
                    <tbody id="user-management-table">
                        <!-- ข้อมูลผู้ใช้จะถูกโหลดที่นี่ -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal จัดการการชำระเงิน (Admin) -->
    <div id="payment-management-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePaymentManagement()">&times;</span>
            <h2><i class="fas fa-credit-card"></i> จัดการการชำระเงิน</h2>

            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>รหัสคำสั่งซื้อ</th>
                            <th>นักศึกษา</th>
                            <th>ยอดชำระ</th>
                            <th>ยอดโอน</th>
                            <th>วันที่โอน</th>
                            <th>สถานะ</th>
                            <th>การชำระเงิน</th>
                            <th>จัดการ</th>
                        </tr>
                    </thead>
                    <tbody id="payment-management-table">
                        <!-- ข้อมูลการชำระเงินจะถูกโหลดที่นี่ -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal รับสินค้า (นักศึกษา) -->
    <div id="pickup-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePickupModal()">&times;</span>
            <div id="pickup-content">
                <!-- เนื้อหาการรับสินค้าจะถูกโหลดที่นี่ -->
            </div>
        </div>
    </div>

    <!-- Modal หน้าชำระเงิน -->
    <div id="payment-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePaymentPage()">&times;</span>
            <div id="payment-content">
                <!-- เนื้อหาการชำระเงินจะถูกโหลดที่นี่ -->
            </div>
        </div>
    </div>

    <!-- Modal จัดการการชำระเงิน (Admin) -->
    <div id="payment-management-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePaymentManagement()">&times;</span>
            <h2><i class="fas fa-credit-card"></i> จัดการการชำระเงิน</h2>

            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>รหัสคำสั่งซื้อ</th>
                            <th>นักศึกษา</th>
                            <th>ยอดชำระ</th>
                            <th>ยอดโอน</th>
                            <th>วันที่โอน</th>
                            <th>สถานะ</th>
                            <th>การชำระเงิน</th>
                            <th>จัดการ</th>
                        </tr>
                    </thead>
                    <tbody id="payment-management-table">
                        <!-- ข้อมูลการชำระเงินจะถูกโหลดที่นี่ -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal รายละเอียดสินค้า -->
    <div id="product-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="modal-product-content">
                <!-- เนื้อหาสินค้าจะถูกโหลดที่นี่ -->
            </div>
        </div>
    </div>

    <!-- Modal ตะกร้าสินค้า -->
    <div id="cart-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCart()">&times;</span>
            <h2><i class="fas fa-shopping-cart"></i> ตะกร้าสินค้า</h2>
            <div id="cart-items">
                <p style="text-align: center; color: #666; padding: 40px;">
                    <i class="fas fa-shopping-cart" style="font-size: 48px; margin-bottom: 15px; display: block;"></i>
                    ยังไม่มีสินค้าในตะกร้า
                </p>
            </div>
            <div class="cart-total" id="cart-total" style="display: none;">
                <h3 style="text-align: center; color: #2a5298; margin: 20px 0;">
                    <i class="fas fa-calculator"></i> รวมทั้งหมด: <span id="total-price">0</span> บาท
                </h3>
            </div>
            <div class="button-group" style="margin-top: 25px;">
                <button class="btn btn-success" onclick="checkout()" id="checkout-btn" style="display: none;">
                    <i class="fas fa-credit-card"></i> สั่งซื้อ
                </button>
                <button class="btn btn-secondary" onclick="closeCart()">
                    <i class="fas fa-times"></i> ปิด
                </button>
            </div>
        </div>
    </div>

    <!-- Modal ติดตามสถานะคำสั่งซื้อ -->
    <div id="order-tracking-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeOrderTracking()">&times;</span>
            <div id="order-tracking-content">
                <!-- เนื้อหาติดตามสถานะจะถูกโหลดที่นี่ -->
            </div>
        </div>
    </div>

    <!-- Modal จัดการสินค้า (Admin) -->
    <div id="product-management-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeProductManagement()">&times;</span>
            <h2><i class="fas fa-box"></i> จัดการสินค้า</h2>

            <div class="button-group" style="margin-bottom: 25px;">
                <button class="btn btn-success" onclick="showAddProductForm()">
                    <i class="fas fa-plus"></i> เพิ่มสินค้าใหม่
                </button>
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>รูปภาพ</th>
                            <th>ชื่อสินค้า</th>
                            <th>หมวดหมู่</th>
                            <th>ราคา</th>
                            <th>สต็อก</th>
                            <th>จัดการ</th>
                        </tr>
                    </thead>
                    <tbody id="product-management-table">
                        <!-- ข้อมูลสินค้าจะถูกโหลดที่นี่ -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal จัดการคำสั่งซื้อ (Admin) -->
    <div id="order-management-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeOrderManagement()">&times;</span>
            <h2><i class="fas fa-shopping-cart"></i> จัดการคำสั่งซื้อ</h2>

            <!-- สถิติรวม -->
            <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <div style="background: #28a745; color: white; padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="font-size: 24px; font-weight: 700;" id="success-payment-count">0</div>
                    <div style="font-size: 12px; opacity: 0.9;">การชำระเงินสำเร็จ</div>
                </div>
                <div style="background: #ffc107; color: #333; padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="font-size: 24px; font-weight: 700;" id="pending-delivery-count">0</div>
                    <div style="font-size: 12px; opacity: 0.8;">ค้างจ่ายสินค้า</div>
                </div>
                <div style="background: #dc3545; color: white; padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="font-size: 24px; font-weight: 700;" id="pending-payment-count">0</div>
                    <div style="font-size: 12px; opacity: 0.9;">รอการชำระ</div>
                </div>
                <div style="background: #17a2b8; color: white; padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="font-size: 24px; font-weight: 700;" id="completed-count">0</div>
                    <div style="font-size: 12px; opacity: 0.9;">รับสินค้าแล้ว</div>
                </div>
            </div>

            <!-- ตัวกรองและค้นหา -->
            <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">กรองตามสถานะ:</label>
                    <select id="order-status-filter" onchange="filterOrders()"
                        style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ddd;">
                        <option value="">ทุกสถานะ</option>
                        <option value="pending-payment">รอการชำระ</option>
                        <option value="pending-confirmation">รอตรวจสอบการชำระ</option>
                        <option value="pending-approval">รอการอนุมัติ</option>
                        <option value="preparing">กำลังเตรียมสินค้า</option>
                        <option value="ready">พร้อมรับสินค้า</option>
                        <option value="completed">เสร็จสิ้น</option>
                    </select>
                </div>

                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">ค้นหาชื่อ-สกุล:</label>
                    <input type="text" id="order-search-name" placeholder="กรอกชื่อหรือนามสกุล" onkeyup="filterOrders()"
                        style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ddd;">
                </div>

                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">ค้นหารหัสคำสั่งซื้อ:</label>
                    <input type="text" id="order-search-id" placeholder="กรอกรหัสคำสั่งซื้อ" onkeyup="filterOrders()"
                        style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ddd;">
                </div>

                <div style="display: flex; align-items: end; gap: 10px;">
                    <button class="btn btn-success" onclick="exportOrdersToExcel()" style="padding: 8px 15px;">
                        <i class="fas fa-file-excel"></i> Export Excel
                    </button>
                    <button class="btn btn-secondary" onclick="resetOrderFilters()" style="padding: 8px 15px;">
                        <i class="fas fa-undo"></i> รีเซ็ต
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>รหัสคำสั่งซื้อ</th>
                            <th>รหัสนักศึกษา</th>
                            <th>ชื่อ-สกุล</th>
                            <th>ระดับ</th>
                            <th>รายการสั่งซื้อ</th>
                            <th>ราคา</th>
                            <th>สถานะ</th>
                            <th>การชำระเงิน</th>
                            <th>การจัดการ</th>
                        </tr>
                    </thead>
                    <tbody id="order-management-table">
                        <!-- ข้อมูลคำสั่งซื้อจะถูกโหลดที่นี่ -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal การแจ้งเตือน -->
    <div id="notification-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeNotifications()">&times;</span>
            <h2><i class="fas fa-bell"></i> การแจ้งเตือน</h2>

            <div style="margin-bottom: 20px; text-align: right;">
                <button class="btn btn-secondary btn-small" onclick="markAllAsRead()">
                    <i class="fas fa-check-double"></i> อ่านทั้งหมด
                </button>
                <button class="btn btn-danger btn-small" onclick="clearAllNotifications()" style="margin-left: 10px;">
                    <i class="fas fa-trash"></i> ลบทั้งหมด
                </button>
            </div>

            <div id="notification-list">
                <div style="text-align: center; color: #666; padding: 40px;">
                    <i class="fas fa-bell-slash"
                        style="font-size: 48px; margin-bottom: 15px; display: block; color: #ccc;"></i>
                    <h3>ไม่มีการแจ้งเตือน</h3>
                    <p>เมื่อมีการอัพเดทสถานะคำสั่งซื้อ คุณจะได้รับการแจ้งเตือนที่นี่</p>
                </div>
            </div>

            <div class="button-group" style="margin-top: 30px;">
                <button class="btn btn-secondary" onclick="closeNotifications()">
                    <i class="fas fa-times"></i> ปิด
                </button>
            </div>
        </div>
    </div>

    <!-- Modal รับสินค้า (นักศึกษา) -->
    <div id="pickup-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePickupModal()">&times;</span>
            <div id="pickup-content">
                <!-- เนื้อหาการรับสินค้าจะถูกโหลดที่นี่ -->
            </div>
        </div>
    </div>

    <!-- Modal สแกน QR Code (Admin) -->
    <div id="qr-scanner-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeQRScanner()">&times;</span>
            <h2><i class="fas fa-qrcode"></i> สแกน QR Code รับสินค้า</h2>

            <div style="text-align: center; padding: 30px;">
                <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                    <h3 style="color: #2a5298; margin-bottom: 15px;">กรอกรหัสคำสั่งซื้อ</h3>
                    <input type="text" id="manual-order-id" placeholder="กรอกรหัสคำสั่งซื้อ เช่น ORD-123456"
                        style="width: 300px; padding: 12px; border: 2px solid #2a5298; border-radius: 8px; font-size: 16px; text-align: center;">
                    <br><br>
                    <button class="btn btn-primary" onclick="confirmPickup()">
                        <i class="fas fa-check-circle"></i> ยืนยันการรับสินค้า
                    </button>
                </div>

                <div style="color: #666; font-size: 14px;">
                    <i class="fas fa-info-circle"></i> ในอนาคตจะมีระบบสแกน QR Code แทนการกรอกด้วยมือ
                </div>
            </div>
        </div>
    </div>

    <!-- Modal แก้ไขโปรไฟล์นักศึกษา -->
    <div id="student-profile-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeStudentProfile()">&times;</span>
            <div id="student-profile-content">
                <!-- เนื้อหาโปรไฟล์จะถูกโหลดที่นี่ -->
            </div>
        </div>
    </div>

    <!-- Modal รายงาน (Admin) -->
    <div id="reports-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeReports()">&times;</span>
            <h2><i class="fas fa-chart-bar"></i> รายงานและสถิติ</h2>

            <!-- เมนูเลือกประเภทรายงาน -->
            <div style="margin-bottom: 30px;">
                <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                    <button class="btn btn-info" onclick="showSalesReport()">
                        <i class="fas fa-chart-line"></i> รายงานการขาย
                    </button>
                    <button class="btn btn-success" onclick="showProductReport()">
                        <i class="fas fa-box"></i> รายงานสินค้า
                    </button>
                    <button class="btn btn-warning" onclick="showUserReport()">
                        <i class="fas fa-users"></i> รายงานผู้ใช้
                    </button>
                    <button class="btn btn-primary" onclick="showOrderReport()">
                        <i class="fas fa-shopping-cart"></i> รายงานคำสั่งซื้อ
                    </button>
                </div>
            </div>

            <!-- พื้นที่แสดงรายงาน -->
            <div id="report-content">
                <div style="text-align: center; color: #666; padding: 40px;">
                    <i class="fas fa-chart-bar"
                        style="font-size: 64px; margin-bottom: 20px; display: block; color: #ccc;"></i>
                    <h3>เลือกประเภทรายงานที่ต้องการดู</h3>
                    <p>คลิกปุ่มด้านบนเพื่อดูรายงานแต่ละประเภท</p>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal จัดการคลัง (Admin) -->
    <div id="inventory-management-modal" class="modal">
        <div class="modal-content" style="max-width: 1200px;">
            <span class="close" onclick="closeInventoryManagement()">&times;</span>
            <h2><i class="fas fa-warehouse"></i> จัดการคลังสินค้า</h2>

            <!-- สถิติคลัง -->
            <div class="stats-grid" style="margin-bottom: 30px;">
                <div class="stat-card" style="background: linear-gradient(45deg, #28a745, #20c997); color: white;">
                    <div class="stat-number" id="inventory-total-items" style="color: white; font-weight: 700;">0</div>
                    <div class="stat-label" style="color: white; opacity: 0.9;">รายการสินค้า</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(45deg, #2a5298, #1e3c72); color: white;">
                    <div class="stat-number" id="inventory-total-stock" style="color: white; font-weight: 700;">0</div>
                    <div class="stat-label" style="color: white; opacity: 0.9;">สต็อกรวม</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(45deg, #ffc107, #ffca2c); color: white;">
                    <div class="stat-number" id="inventory-low-stock" style="color: white; font-weight: 700;">0</div>
                    <div class="stat-label" style="color: white; opacity: 0.9;">สต็อกต่ำ</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(45deg, #dc3545, #c82333); color: white;">
                    <div class="stat-number" id="inventory-out-stock" style="color: white; font-weight: 700;">0</div>
                    <div class="stat-label" style="color: white; opacity: 0.9;">สินค้าหมด</div>
                </div>
            </div>

            <!-- เมนูการจัดการ -->
            <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <button class="btn btn-success" onclick="showStockInForm()" style="padding: 15px;">
                    <i class="fas fa-plus-circle"></i><br>รับสินค้าเข้าคลัง
                </button>
                <button class="btn btn-warning" onclick="showStockOutForm()" style="padding: 15px;">
                    <i class="fas fa-minus-circle"></i><br>จ่ายสินค้าออกคลัง
                </button>
                <button class="btn btn-info" onclick="showStockAdjustForm()" style="padding: 15px;">
                    <i class="fas fa-edit"></i><br>ปรับปรุงสต็อก
                </button>
                <button class="btn btn-primary" onclick="showStockHistory()" style="padding: 15px;">
                    <i class="fas fa-history"></i><br>ประวัติการเคลื่อนไหว
                </button>
            </div>

            <!-- ตารางสินค้าในคลัง -->
            <div class="table-container">
                <h3><i class="fas fa-boxes"></i> รายการสินค้าในคลัง</h3>

                <!-- ตัวกรอง -->
                <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
                    <select id="inventory-category-filter" onchange="filterInventory()"
                        style="padding: 10px; border-radius: 8px;">
                        <option value="">ทุกหมวดหมู่</option>
                        <option value="Learning Supplies">📚 อุปกรณ์การเรียน</option>
                        <option value="Student Uniform">👔 เครื่องแบบนักศึกษา</option>
                        <option value="Activity">🎽 เสื้อกิจกรรม</option>
                        <option value="Souvenirs">🎁 ของที่ระลึก</option>
                    </select>

                    <select id="inventory-stock-filter" onchange="filterInventory()"
                        style="padding: 10px; border-radius: 8px;">
                        <option value="">ทุกสถานะ</option>
                        <option value="in-stock">มีสต็อก (>10)</option>
                        <option value="low-stock">สต็อกต่ำ (1-10)</option>
                        <option value="out-stock">สินค้าหมด (0)</option>
                    </select>

                    <input type="text" id="inventory-search" placeholder="🔍 ค้นหาสินค้า..." onkeyup="filterInventory()"
                        style="padding: 10px; border-radius: 8px; flex: 1; min-width: 200px;">
                </div>

                <table class="table">
                    <thead>
                        <tr>
                            <th>รูปภาพ</th>
                            <th>ชื่อสินค้า</th>
                            <th>หมวดหมู่</th>
                            <th>ราคา</th>
                            <th>สต็อกปัจจุบัน</th>
                            <th>สถานะ</th>
                            <th>การจัดการ</th>
                        </tr>
                    </thead>
                    <tbody id="inventory-table-body">
                        <!-- ข้อมูลสินค้าจะถูกโหลดที่นี่ -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal แก้ไขโปรไฟล์เจ้าหน้าที่ -->
    <div id="admin-profile-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAdminProfile()">&times;</span>
            <div id="admin-profile-content">
                <!-- เนื้อหาโปรไฟล์เจ้าหน้าที่จะถูกโหลดที่นี่ -->
            </div>
        </div>
    </div>

    <div class="footer">
        <p><i class="fas fa-university"></i> &copy; 2025 มหาวิทยาลัยเทคโนโลยีราชมงคลอีสาน วิทยาเขตขอนแก่น.
            สงวนลิขสิทธิ์.</p>
    </div>
    <script>
        // ข้อมูลสินค้า
        const products = [
            {
                id: 1,
                name: "เสื้อที่ระลึกครบรอบ 60 ปี RMUTI",
                description: "เสื้อที่ระลึกในโอกาสครบรอบ 60 ปี มหาวิทยาลัยเทคโนโลยีราชมงคลอีสาน สีแสด คุณภาพพรีเมียม",
                price: 350,
                category: "Souvenirs",
                image: "image/shirts 60Y.png",
                stock: 15
            },
            {
                id: 2,
                name: "เสื้อช็อปมหาวิทยาลัย",
                description: "เสื้อยูนิฟอร์มนักศึกษา RMUTI วิทยาเขตขอนแก่น คุณภาพดี ผ้าใส่สบาย ทนทาน",
                price: 350,
                category: "Activity",
                image: "image/shop shirts.jpg",
                stock: 50
            },
            {
                id: 3,
                name: "สมุดบันทึกมหาวิทยาลัย",
                description: "สมุดบันทึกสำหรับการเรียน มีตราสัญลักษณ์มหาวิทยาลัย กระดาษคุณภาพดี",
                price: 10,
                category: "Learning Supplies",
                image: "image/notebook.jpg",
                stock: 100
            },
            {
                id: 4,
                name: "เนคไทนักศึกษาชาย",
                description: "เนคไทสำหรับนักศึกษาชาย สีน้ำเงินเข้ม ตราสัญลักษณ์มหาวิทยาลัย คุณภาพพรีเมียม",
                price: 150,
                category: "Student Uniform",
                image: "image/necktie.jpg",
                stock: 75
            }
        ];

        // สถานะคำสั่งซื้อและข้อมูลการติดตาม
        const orderStatuses = {
            'pending-payment': {
                name: 'รอชำระเงิน',
                icon: 'fas fa-credit-card',
                color: '#ffc107',
                description: 'รอการชำระเงินจากลูกค้า'
            },
            'pending-verification': {
                name: 'รอตรวจสอบการชำระ',
                icon: 'fas fa-search',
                color: '#17a2b8',
                description: 'ระบบกำลังตรวจสอบการชำระเงินอัตโนมัติ'
            },
            'pending-confirmation': {
                name: 'รอยืนยันการชำระ',
                icon: 'fas fa-clock',
                color: '#17a2b8',
                description: 'รอเจ้าหน้าที่ยืนยันการชำระเงิน'
            },
            'pending-approval': {
                name: 'รออนุมัติ',
                icon: 'fas fa-check-circle',
                color: '#6c757d',
                description: 'รอการอนุมัติจากเจ้าหน้าที่'
            },
            'preparing': {
                name: 'กำลังเตรียมสินค้า',
                icon: 'fas fa-box-open',
                color: '#007bff',
                description: 'เตรียมสินค้าสำหรับการรับ'
            },
            'ready': {
                name: 'พร้อมรับสินค้า',
                icon: 'fas fa-hand-holding',
                color: '#28a745',
                description: 'สินค้าพร้อมสำหรับรับ'
            },
            'completed': {
                name: 'เสร็จสิ้น',
                icon: 'fas fa-check-double',
                color: '#28a745',
                description: 'รับสินค้าเรียบร้อยแล้ว'
            },
            'cancelled': {
                name: 'ยกเลิก',
                icon: 'fas fa-times-circle',
                color: '#dc3545',
                description: 'คำสั่งซื้อถูกยกเลิก'
            }
        };

        // ตัวแปรสำหรับเก็บข้อมูลผู้ใช้และตะกร้าสินค้า
        let currentUser = null;
        let cart = [];
        let filteredProducts = [...products];
        let orders = [];
        let notifications = [];
        let notificationIdCounter = 1;
        let paymentData = [];

        // ข้อมูลผู้ใช้ตัวอย่าง (จำลองฐานข้อมูล)
        const users = {
            'students': {
                '641234567': {
                    id: '641234567',
                    type: 'student',
                    firstname: 'สมชาย',
                    lastname: 'ใจดี',
                    nationalId: '1234567890123',
                    faculty: 'engineering',
                    major: 'วิศวกรรมคอมพิวเตอร์',
                    year: '3',
                    email: 'somchai.jaidee@rmuti.ac.th',
                    phone: '0812345678',
                    password: '123456'
                },
                '642345678': {
                    id: '642345678',
                    type: 'student',
                    firstname: 'สุดา',
                    lastname: 'มีสุข',
                    nationalId: '9876543210987',
                    faculty: 'business',
                    major: 'การจัดการธุรกิจ',
                    year: '2',
                    email: 'suda.meesuk@rmuti.ac.th',
                    phone: '0823456789',
                    password: '123456'
                }
            },
            'admins': {
                'A001': {
                    id: 'A001',
                    type: 'admin',
                    firstname: 'อรุณ',
                    lastname: 'ศรีสุข',
                    nationalId: '5555566666777',
                    department: 'งานบริการการศึกษา',
                    email: 'arun.srisuk@rmuti.ac.th',
                    phone: '0856789012',
                    password: 'admin123'
                }
            }
        };

        // ===== ฟังก์ชันทั่วไป =====

        // ฟังก์ชันสลับแสดง/ซ่อนรหัสผ่าน
        function togglePassword(inputId, iconElement) {
            const input = document.getElementById(inputId);
            const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
            input.setAttribute('type', type);

            if (type === 'text') {
                iconElement.classList.remove('fa-eye');
                iconElement.classList.add('fa-eye-slash');
            } else {
                iconElement.classList.remove('fa-eye-slash');
                iconElement.classList.add('fa-eye');
            }
        }

        // ฟังก์ชันซ่อนทุกหน้า
        function hideAllPages() {
            const pages = ['main-content', 'login-form', 'register-form', 'forgot-password-form', 'student-dashboard', 'admin-dashboard'];
            pages.forEach(pageId => {
                const element = document.getElementById(pageId);
                if (element) element.style.display = 'none';
            });
        }

        // ฟังก์ชันกลับไปหน้าหลัก
        function goBack() {
            if (currentUser) {
                if (currentUser.type === 'student') {
                    showStudentDashboard();
                } else {
                    showAdminDashboard();
                }
            } else {
                hideAllPages();
                document.getElementById('main-content').style.display = 'block';
            }
        }

        // ฟังก์ชันแสดงการแจ้งเตือน
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification-banner notification-${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.5s ease';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 500);
            }, 3000);
        }

        // ประเภทการแจ้งเตือน
        const notificationTypes = {
            'payment-received': {
                icon: 'fas fa-credit-card',
                color: '#ffc107',
                title: 'ได้รับข้อมูลการชำระเงิน'
            },
            'payment-approved': {
                icon: 'fas fa-check-circle',
                color: '#28a745',
                title: 'การชำระเงินได้รับการยืนยัน'
            },
            'payment-rejected': {
                icon: 'fas fa-times-circle',
                color: '#dc3545',
                title: 'การชำระเงินถูกปฏิเสธ'
            },
            'order-approved': {
                icon: 'fas fa-thumbs-up',
                color: '#17a2b8',
                title: 'คำสั่งซื้อได้รับการอนุมัติ'
            },
            'order-preparing': {
                icon: 'fas fa-box-open',
                color: '#007bff',
                title: 'กำลังเตรียมสินค้า'
            },
            'order-ready': {
                icon: 'fas fa-hand-holding',
                color: '#28a745',
                title: 'สินค้าพร้อมรับ'
            },
            'order-completed': {
                icon: 'fas fa-check-double',
                color: '#28a745',
                title: 'การสั่งซื้อเสร็จสิ้น'
            },
            'order-cancelled': {
                icon: 'fas fa-ban',
                color: '#6c757d',
                title: 'คำสั่งซื้อถูกยกเลิก'
            }
        };

        // ข้อมูลบัญชีธนาคารของร้าน
        const shopBankAccount = {
            bank: 'ธนาคารกรุงไทย',
            accountName: 'มหาวิทยาลัยเทคโนโลยีราชมงคลอีสาน วิทยาเขตขอนแก่น',
            accountNumber: '123-4-56789-0',
            promptPayId: '0123456789'
        };

        // ===== ฟังก์ชันทั่วไป =====

        // ฟังก์ชันสลับแสดง/ซ่อนรหัสผ่าน
        function togglePassword(inputId, iconElement) {
            const input = document.getElementById(inputId);
            const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
            input.setAttribute('type', type);

            if (type === 'text') {
                iconElement.classList.remove('fa-eye');
                iconElement.classList.add('fa-eye-slash');
            } else {
                iconElement.classList.remove('fa-eye-slash');
                iconElement.classList.add('fa-eye');
            }
        }

        // ฟังก์ชันซ่อนทุกหน้า
        function hideAllPages() {
            const pages = ['main-content', 'login-form', 'register-form', 'forgot-password-form', 'student-dashboard', 'admin-dashboard'];
            pages.forEach(pageId => {
                const element = document.getElementById(pageId);
                if (element) element.style.display = 'none';
            });
        }

        // ฟังก์ชันกลับไปหน้าหลัก
        function goBack() {
            // ถ้ามีผู้ใช้ล็อกอินอยู่ ให้กลับไปหน้า Dashboard
            if (currentUser) {
                if (currentUser.type === 'student') {
                    showStudentDashboard();
                } else {
                    showAdminDashboard();
                }
            } else {
                // ถ้าไม่มีผู้ใช้ล็อกอิน ให้ไปหน้าหลัก
                hideAllPages();
                document.getElementById('main-content').style.display = 'block';
            }
        }

        // ฟังก์ชันแสดงการแจ้งเตือน
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification-banner notification-${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.5s ease';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 500);
            }, 3000);
        }

        // ฟังก์ชันสร้างวันเวลา
        function getCurrentDateTime() {
            return new Date().toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function getRandomFutureDateTime(hoursFromNow = 24) {
            const future = new Date();
            future.setHours(future.getHours() + hoursFromNow);
            return future.toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // ===== ฟังก์ชันการจัดการหน้า =====

        // แสดงฟอร์มเข้าสู่ระบบ
        function showLoginForm(userType) {
            hideAllPages();
            document.getElementById('login-form').style.display = 'flex';

            if (userType === 'student') {
                document.getElementById('student-login-form').style.display = 'block';
                document.getElementById('admin-login-form').style.display = 'none';
            } else {
                document.getElementById('admin-login-form').style.display = 'block';
                document.getElementById('student-login-form').style.display = 'none';
            }
        }

        // แสดงฟอร์มลงทะเบียน
        function showRegisterForm(userType) {
            hideAllPages();
            document.getElementById('register-form').style.display = 'flex';

            if (userType === 'student') {
                document.getElementById('student-register-form').style.display = 'block';
                document.getElementById('admin-register-form').style.display = 'none';
            } else {
                document.getElementById('admin-register-form').style.display = 'block';
                document.getElementById('student-register-form').style.display = 'none';
            }
        }

        // แสดงฟอร์มลืมรหัสผ่าน
        function showForgotPasswordForm(userType) {
            hideAllPages();
            document.getElementById('forgot-password-form').style.display = 'flex';

            if (userType === 'student') {
                document.getElementById('student-forgot-form').style.display = 'block';
                document.getElementById('admin-forgot-form').style.display = 'none';
            } else {
                document.getElementById('admin-forgot-form').style.display = 'block';
                document.getElementById('student-forgot-form').style.display = 'none';
            }
        }

        // ===== ฟังก์ชันการเข้าสู่ระบบ =====

        // ฟังก์ชันเข้าสู่ระบบ
        function login(userType, userId, password) {
            const userGroup = userType === 'student' ? 'students' : 'admins';
            const user = users[userGroup][userId];

            if (user && user.password === password) {
                currentUser = user;

                if (userType === 'student') {
                    showStudentDashboard();
                    setTimeout(() => {
                        createNotification(
                            userId,
                            'order-completed', // ใช้ไอคอนเดียวกัน
                            null,
                            `ยินดีต้อนรับกลับ ${user.firstname}! มีการแจ้งเตือนใหม่เมื่อสถานะคำสั่งซื้อเปลี่ยนแปลง`,
                            { isWelcome: true }
                        );
                    }, 1000);
                } else {
                    showAdminDashboard();
                }
                return true;
            }
            return false;
        }

        // แสดง Dashboard นักศึกษา
        function showStudentDashboard() {
            hideAllPages();
            document.getElementById('student-dashboard').style.display = 'block';

            if (currentUser) {
                const displayName = `นักศึกษา ${currentUser.firstname} ${currentUser.lastname} (${currentUser.id})`;
                document.getElementById('student-welcome-message').innerHTML = `<i class="fas fa-hand-holding-heart"></i> ยินดีต้อนรับ ${displayName}`;
            }
            loadProducts();
            updateNotificationDisplay();
        }

        // แสดง Dashboard Admin
        function showAdminDashboard() {
            hideAllPages();
            document.getElementById('admin-dashboard').style.display = 'block';

            if (currentUser) {
                const displayName = `เจ้าหน้าที่ ${currentUser.firstname} ${currentUser.lastname} (${currentUser.id})`;
                document.getElementById('admin-welcome-message').innerHTML = `<i class="fas fa-hand-holding-heart"></i> ยินดีต้อนรับ ${displayName}`;
            }
            updateAdminStats();
            loadRecentOrders();
        }

        // อัพเดทสถิติใน Admin Dashboard (ปรับปรุงใหม่)
        function updateAdminStats() {
            // นับเฉพาะออเดอร์ที่ไม่ใช่สถานะยกเลิก
            const activeOrders = orders.filter(order => order.status !== 'cancelled');

            document.getElementById('total-products').textContent = products.length;
            document.getElementById('total-orders').textContent = activeOrders.length;
            document.getElementById('pending-orders').textContent = activeOrders.filter(order =>
                ['pending-payment', 'pending-confirmation', 'pending-approval'].includes(order.status)
            ).length;

            const totalRevenue = activeOrders.filter(order => order.status === 'completed')
                .reduce((sum, order) => sum + order.total, 0);
            document.getElementById('total-revenue').textContent = totalRevenue.toLocaleString();

        }

        // โหลดคำสั่งซื้อล่าสุดใน Admin Dashboard
        function loadRecentOrders() {
            const tbody = document.getElementById('recent-orders');
            tbody.innerHTML = '';

            const recentOrders = orders.filter(order => order.status !== 'cancelled').slice(-5).reverse();// แสดง 5 คำสั่งซื้อล่าสุด (ไม่รวมที่ยกเลิก)

            if (recentOrders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #666; padding: 30px;">ยังไม่มีคำสั่งซื้อ</td></tr>';
                return;
            }

            recentOrders.forEach(order => {
                const status = orderStatuses[order.status];
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${order.id}</td>
                    <td>${order.studentId}</td>
                    <td>${order.studentName}</td>
                    <td>ปริญญาตรี</td>
                    <td>
                        <button class="btn btn-info btn-small" onclick="viewOrderItems('${order.id}')" title="ดูรายการสินค้า">
                            <i class="fas fa-shopping-cart"></i>
                        </button>
                    </td>
                    <td>${(order.total || 0).toLocaleString()}</td>
                    <td>การชำระเงินสำเร็จ</td>
                    <td>
                        <button class="btn btn-info btn-small" onclick="viewPaymentSlip('${order.id}')" title="ดูสลิป">
                            <i class="fas fa-receipt"></i>
                        </button>
                    </td>
                    <td>
                        <button class="btn btn-warning btn-small" onclick="editOrder('${order.id}')" title="แก้ไข">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger btn-small" onclick="deleteOrder('${order.id}')" title="ลบ">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // ออกจากระบบ
        function logout() {
            if (confirm('🚪 ต้องการออกจากระบบหรือไม่?')) {
                currentUser = null;
                cart = [];
                updateCartDisplay();
                goBack();
                showNotification('👋 ออกจากระบบเรียบร้อยแล้ว', 'info');
            }
        }

        // ===== ฟังก์ชันจัดการสินค้า (สำหรับนักศึกษา) =====

        // โหลดสินค้า
        function loadProducts() {
            const productGrid = document.getElementById('product-grid');
            productGrid.innerHTML = '';

            if (filteredProducts.length === 0) {
                productGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; color: #666; padding: 60px 20px;">
                        <i class="fas fa-search" style="font-size: 48px; margin-bottom: 20px; display: block; color: #ccc;"></i>
                        <h3>ไม่พบสินค้าที่ค้นหา</h3>
                        <p>ลองใช้คำค้นหาอื่น หรือเลือกหมวดหมู่ที่แตกต่างกัน</p>
                    </div>
                `;
                return;
            }

            filteredProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';

                const stockStatus = product.stock > 10 ? 'มีสินค้า' :
                    product.stock > 0 ? `เหลือ ${product.stock} ชิ้น` : 'สินค้าหมด';
                const stockColor = product.stock > 10 ? '#28a745' :
                    product.stock > 0 ? '#ffc107' : '#dc3545';

                productCard.innerHTML = `
                    <div class="product-image">
                        <img src="${product.image}" alt="${product.name}" loading="lazy">
                    </div>
                    <div class="product-info">
                        <div class="product-name">${product.name}</div>
                        <div class="product-description">${product.description}</div>
                        <div class="product-price">${product.price.toLocaleString()} บาท</div>
                        <div style="color: ${stockColor}; font-size: 14px; font-weight: 600; margin-bottom: 15px;">
                            <i class="fas fa-box"></i> ${stockStatus}
                        </div>
                        <div class="product-actions">
                            <button class="btn btn-info btn-small" onclick="showProductDetails(${product.id})">
                                <i class="fas fa-info-circle"></i> รายละเอียด
                            </button>
                            <button class="btn btn-success btn-small" onclick="addToCart(${product.id})" 
                                    ${product.stock === 0 ? 'disabled style="opacity: 0.5; cursor: not-allowed;"' : ''}>
                                <i class="fas fa-cart-plus"></i> ${product.stock === 0 ? 'สินค้าหมด' : 'เพิ่มลงตะกร้า'}
                            </button>
                        </div>
                    </div>
                `;
                productGrid.appendChild(productCard);
            });
        }

        function filterByCategory() {
            searchProducts();
        }

        // แสดงรายละเอียดสินค้า
        function showProductDetails(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                const stockStatus = product.stock > 10 ? 'มีสินค้า' :
                    product.stock > 0 ? `เหลือ ${product.stock} ชิ้น` : 'สินค้าหมด';
                const stockColor = product.stock > 10 ? '#28a745' :
                    product.stock > 0 ? '#ffc107' : '#dc3545';

                const modalContent = document.getElementById('modal-product-content');
                modalContent.innerHTML = `
                    <div style="width: 100%; height: 350px; background: linear-gradient(45deg, #f8f9fa, #e9ecef); display: flex; align-items: center; justify-content: center; border-radius: 15px; margin-bottom: 25px; position: relative; overflow: hidden;">
                        <img src="${product.image}" alt="${product.name}" loading="lazy" style="width: 100%; height: 100%; object-fit: contain; border-radius: 15px;">
                    </div>
                    <h2><i class="fas fa-tag"></i> ${product.name}</h2>
                    <p><strong><i class="fas fa-info-circle"></i> รายละเอียด:</strong></p>
                    <p style="line-height: 1.6; margin-bottom: 20px;">${product.description}</p>
                    <p><strong><i class="fas fa-money-bill-wave"></i> ราคา:</strong> <span style="color: #2a5298; font-size: 24px; font-weight: 700;">${product.price.toLocaleString()} บาท</span></p>
                    <p><strong><i class="fas fa-box"></i> สถานะสินค้า:</strong> <span style="color: ${stockColor}; font-weight: 600;">${stockStatus}</span></p>
                    <div class="button-group" style="margin-top: 30px;">
                        <button class="btn btn-success" onclick="addToCart(${product.id}); closeModal();" 
                                ${product.stock === 0 ? 'disabled style="opacity: 0.5; cursor: not-allowed;"' : ''}>
                            <i class="fas fa-cart-plus"></i> ${product.stock === 0 ? 'สินค้าหมด' : 'เพิ่มลงตะกร้า'}
                        </button>
                        <button class="btn btn-secondary" onclick="closeModal()">
                            <i class="fas fa-times"></i> ปิด
                        </button>
                    </div>
                `;
                document.getElementById('product-modal').style.display = 'block';
            }
        }

        // ปิด Modal
        function closeModal() {
            document.getElementById('product-modal').style.display = 'none';
        }

        // ===== ฟังก์ชันตะกร้าสินค้า =====

        // เพิ่มสินค้าลงตะกร้า
        function addToCart(productId) {
            if (!currentUser || currentUser.type !== 'student') {
                showNotification('⚠️ เฉพาะนักศึกษาเท่านั้นที่สามารถสั่งซื้อสินค้าได้', 'error');
                return;
            }

            const product = products.find(p => p.id === productId);
            if (product && product.stock > 0) {
                const existingItem = cart.find(item => item.id === productId);
                if (existingItem) {
                    if (existingItem.quantity < product.stock) {
                        existingItem.quantity += 1;
                        updateCartDisplay();
                        showNotification(`✅ เพิ่ม "${product.name}" ลงตะกร้าเรียบร้อยแล้ว!`, 'success');
                    } else {
                        showNotification(`⚠️ ไม่สามารถเพิ่มสินค้าได้ มีสินค้าเหลือเพียง ${product.stock} ชิ้น`, 'error');
                    }
                } else {
                    cart.push({ ...product, quantity: 1 });
                    updateCartDisplay();
                    showNotification(`✅ เพิ่ม "${product.name}" ลงตะกร้าเรียบร้อยแล้ว!`, 'success');
                }
            } else {
                showNotification('❌ สินค้าหมดแล้ว', 'error');
            }
        }

        // อัพเดทการแสดงผลตะกร้า
        function updateCartDisplay() {
            const cartCount = document.getElementById('cart-count');
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = totalItems;

            cartCount.style.transform = 'scale(1.2)';
            setTimeout(() => {
                cartCount.style.transform = 'scale(1)';
            }, 200);
        }

        // แสดงตะกร้าสินค้า
        function showCart() {
            const cartItems = document.getElementById('cart-items');
            const cartTotal = document.getElementById('cart-total');
            const checkoutBtn = document.getElementById('checkout-btn');

            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div style="text-align: center; color: #666; padding: 60px 20px;">
                        <i class="fas fa-shopping-cart" style="font-size: 64px; margin-bottom: 20px; display: block; color: #ccc;"></i>
                        <h3>ตะกร้าสินค้าว่างเปล่า</h3>
                        <p>เลือกสินค้าที่ต้องการแล้วเพิ่มลงในตะกร้า</p>
                    </div>
                `;
                cartTotal.style.display = 'none';
                checkoutBtn.style.display = 'none';
            } else {
                let cartHTML = '';
                let total = 0;

                cart.forEach((item, index) => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;
                    cartHTML += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #eee; border-radius: 10px; margin-bottom: 10px; background: #f8f9fa;">
                            <div style="display: flex; align-items: center; gap: 15px; flex: 1;">
                                <img src="${item.image}" alt="${item.name}" 
                                     style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px; border: 2px solid #e9ecef;">
                                <div>
                                    <div style="font-weight: 600; color: #333; margin-bottom: 5px;">${item.name}</div>
                                    <div style="color: #666; font-size: 14px;">
                                        <i class="fas fa-tag"></i> ${item.price.toLocaleString()} บาท × ${item.quantity} = 
                                        <span style="font-weight: 600; color: #2a5298;">${itemTotal.toLocaleString()} บาท</span>
                                    </div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 14px;" onclick="changeQuantity(${index}, -1)">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <span style="min-width: 30px; text-align: center; font-weight: 600; font-size: 16px;">${item.quantity}</span>
                                <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 14px;" onclick="changeQuantity(${index}, 1)">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <button onclick="removeFromCart(${index})" 
                                        style="color: #dc3545; background: none; border: none; cursor: pointer; padding: 5px; font-size: 18px;"
                                        title="ลบสินค้า">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </div>
                    `;
                });

                cartItems.innerHTML = cartHTML;
                document.getElementById('total-price').textContent = total.toLocaleString();
                cartTotal.style.display = 'block';
                checkoutBtn.style.display = 'inline-block';
            }

            document.getElementById('cart-modal').style.display = 'block';
        }

        // ปิดตะกร้าสินค้า
        function closeCart() {
            document.getElementById('cart-modal').style.display = 'none';
        }

        // เปลี่ยนจำนวนสินค้า
        function changeQuantity(index, change) {
            const item = cart[index];
            const product = products.find(p => p.id === item.id);

            if (change > 0 && item.quantity >= product.stock) {
                showNotification(`⚠️ ไม่สามารถเพิ่มได้ มีสินค้าเหลือเพียง ${product.stock} ชิ้น`, 'error');
                return;
            }

            cart[index].quantity += change;
            if (cart[index].quantity <= 0) {
                cart.splice(index, 1);
            }
            updateCartDisplay();
            showCart();
        }

        // ลบสินค้าออกจากตะกร้า
        function removeFromCart(index) {
            const item = cart[index];
            if (confirm(`ต้องการลบ "${item.name}" ออกจากตะกร้าหรือไม่?`)) {
                cart.splice(index, 1);
                updateCartDisplay();
                showCart();
                showNotification(`🗑️ ลบ "${item.name}" ออกจากตะกร้าแล้ว`, 'info');
            }
        }

        // สั่งซื้อ (อัพเดทใหม่ - ไปหน้าชำระเงิน)
        function checkout() {
            if (cart.length === 0) {
                showNotification('❌ ไม่มีสินค้าในตะกร้า', 'error');
                return;
            }

            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const orderDetails = cart.map(item => `• ${item.name} × ${item.quantity} = ${(item.price * item.quantity).toLocaleString()} บาท`).join('\n');
            const orderSummary = `📋 สรุปคำสั่งซื้อ:\n\n${orderDetails}\n\n💰 รวมทั้งหมด: ${total.toLocaleString()} บาท\n\n👤 สั่งโดย: ${currentUser.firstname} ${currentUser.lastname} (${currentUser.id})`;

            if (confirm(`${orderSummary}\n\n✅ ยืนยันการสั่งซื้อหรือไม่?`)) {
                // สร้างคำสั่งซื้อ
                const orderId = 'ORD-' + Date.now().toString().slice(-6);
                const orderDate = getCurrentDateTime();

                const newOrder = {
                    id: orderId,
                    studentId: currentUser.id,
                    studentName: `${currentUser.firstname} ${currentUser.lastname}`,
                    items: [...cart],
                    total: total,
                    date: orderDate,
                    status: 'pending-payment', // เริ่มต้นที่รอชำระเงิน
                    tracking: [
                        {
                            status: 'pending-payment',
                            timestamp: orderDate,
                            description: 'สร้างคำสั่งซื้อเรียบร้อยแล้ว รอการชำระเงิน'
                        }
                    ],
                    paymentData: null // เก็บข้อมูลการชำระเงิน
                };

                orders.push(newOrder);

                // อัพเดทสต็อกสินค้า
                cart.forEach(cartItem => {
                    const product = products.find(p => p.id === cartItem.id);
                    if (product) {
                        product.stock -= cartItem.quantity;
                    }
                });

                // ล้างตะกร้า
                cart = [];
                updateCartDisplay();
                closeCart();
                loadProducts();

                showNotification(`🎉 สั่งซื้อเรียบร้อยแล้ว!\n\n📄 รหัสคำสั่งซื้อ: ${orderId}\n💳 กำลังพาไปหน้าชำระเงิน...`, 'success');

                // พาไปหน้าชำระเงิน
                setTimeout(() => {
                    showPaymentPage(orderId);
                }, 1500);
            }
        }

        // ===== ฟังก์ชันระบบชำระเงิน =====

        // แสดงหน้าชำระเงิน (แก้ไขใหม่ - แก้ปัญหาซ้อนทับ)
        function showPaymentPage(orderId) {
            // ปิด modal อื่นๆ ทั้งหมดก่อน
            document.getElementById('order-tracking-modal').style.display = 'none';
            document.getElementById('cart-modal').style.display = 'none';
            document.getElementById('product-modal').style.display = 'none';
            document.getElementById('product-management-modal').style.display = 'none';
            document.getElementById('order-management-modal').style.display = 'none';
            document.getElementById('payment-management-modal').style.display = 'none';
            document.getElementById('student-profile-modal').style.display = 'none';

            // ลบ overlay ประวัติการสั่งซื้อ (ถ้ามี)
            const overlays = document.querySelectorAll('[style*="position: fixed"][style*="z-index"]');
            overlays.forEach(overlay => {
                if (overlay.id !== 'payment-modal' && overlay.parentNode) {
                    overlay.parentNode.removeChild(overlay);
                }
            });

            const order = orders.find(o => o.id === orderId);
            if (!order) {
                showNotification('❌ ไม่พบคำสั่งซื้อ', 'error');
                return;
            }

            const content = document.getElementById('payment-content');
            content.innerHTML = `
                <h2 style="text-align: center; color: #2a5298; margin-bottom: 30px;">
                    <i class="fas fa-credit-card"></i> ชำระเงิน
                </h2>

                <!-- ข้อมูลคำสั่งซื้อ -->
                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 25px; border-radius: 15px; margin-bottom: 25px; border: 2px solid #e9ecef;">
                    <h3 style="color: #2a5298; margin-bottom: 20px; text-align: center;">
                        <i class="fas fa-receipt"></i> รายละเอียดคำสั่งซื้อ
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div><strong>รหัสคำสั่งซื้อ:</strong> ${order.id}</div>
                        <div><strong>ลูกค้า:</strong> ${order.studentName}</div>
                        <div><strong>วันที่สั่ง:</strong> ${order.date}</div>
                        <div style="grid-column: 1 / -1;"><strong>ยอดรวมที่ต้องชำระ:</strong> <span style="font-size: 24px; color: #dc3545; font-weight: 700;">${order.total.toLocaleString()} บาท</span></div>
                    </div>
                    
                    <div style="background: white; padding: 15px; border-radius: 10px; border: 1px solid #dee2e6;">
                        <strong>รายการสินค้า:</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            ${order.items.map(item => `<li>${item.name} × ${item.quantity} = ${(item.price * item.quantity).toLocaleString()} บาท</li>`).join('')}
                        </ul>
                    </div>
                </div>

                <!-- ข้อมูลบัญชีธนาคาร -->
                <div style="background: linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 100%); padding: 25px; border-radius: 15px; margin-bottom: 25px; border: 2px solid #28a745;">
                    <h3 style="color: #28a745; margin-bottom: 20px; text-align: center;">
                        <i class="fas fa-university"></i> ข้อมูลบัญชีสำหรับโอนเงิน
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div>
                            <strong><i class="fas fa-building"></i> ธนาคาร:</strong><br>
                            <span style="font-size: 18px; color: #28a745;">${shopBankAccount.bank}</span>
                        </div>
                        <div>
                            <strong><i class="fas fa-credit-card"></i> เลขที่บัญชี:</strong><br>
                            <span style="font-size: 18px; color: #28a745; font-family: monospace;">${shopBankAccount.accountNumber}</span>
                            <button onclick="copyToClipboard('${shopBankAccount.accountNumber}')" 
                                    style="margin-left: 10px; padding: 5px 10px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <div style="grid-column: 1 / -1;">
                            <strong><i class="fas fa-user"></i> ชื่อบัญชี:</strong><br>
                            <span style="font-size: 16px; color: #28a745;">${shopBankAccount.accountName}</span>
                        </div>
                        <div>
                            <strong><i class="fas fa-qrcode"></i> พร้อมเพย์:</strong><br>
                            <span style="font-size: 18px; color: #28a745; font-family: monospace;">${shopBankAccount.promptPayId}</span>
                            <button onclick="copyToClipboard('${shopBankAccount.promptPayId}')" 
                                    style="margin-left: 10px; padding: 5px 10px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ฟอร์มแจ้งการชำระเงิน -->
                <div style="background: white; padding: 25px; border-radius: 15px; border: 2px solid #2a5298;">
                    <h3 style="color: #2a5298; margin-bottom: 20px; text-align: center;">
                        <i class="fas fa-file-upload"></i> แจ้งการชำระเงิน
                    </h3>
                    
                    <form id="payment-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="payment-amount">จำนวนเงินที่โอน (บาท) *</label>
                                <input type="number" id="payment-amount" value="${order.total}" min="0" step="0.01" required 
                                       style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 18px; text-align: right;">
                            </div>
                            <div class="form-group">
                                <label for="payment-channel">ช่องทางการโอน *</label>
                                <select id="payment-channel" required style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                                    <option value="">เลือกช่องทางการโอน</option>
                                    <option value="bank-transfer">โอนผ่านธนาคาร</option>
                                    <option value="promptpay">พร้อมเพย์</option>
                                    <option value="mobile-banking">Mobile Banking</option>
                                    <option value="atm">ATM</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="payment-date">วันที่โอน *</label>
                                <input type="date" id="payment-date" required 
                                       style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                            </div>
                            <div class="form-group">
                                <label for="payment-time">เวลาโอน *</label>
                                <input type="time" id="payment-time" required 
                                       style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="payment-slip">อัปโหลดสลิปโอนเงิน *</label>
                            <input type="file" id="payment-slip" accept="image/*,.pdf" required 
                                   style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                            <small style="color: #666; display: block; margin-top: 5px;">
                                <i class="fas fa-info-circle"></i> รองรับไฟล์ JPG, PNG หรือ PDF ขนาดไม่เกิน 5MB
                            </small>
                        </div>

                        <div class="form-group">
                            <label for="payment-note">หมายเหตุเพิ่มเติม</label>
                            <textarea id="payment-note" rows="3" placeholder="ระบุหมายเหตุเพิ่มเติม (ถ้ามี)" 
                                      style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; resize: vertical;"></textarea>
                        </div>

                        <div class="button-group" style="margin-top: 25px;">
                            <button type="submit" class="btn btn-success" style="font-size: 18px; padding: 15px 30px;">
                                <i class="fas fa-paper-plane"></i> ส่งข้อมูลการชำระเงิน
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="closePaymentPage()">
                                <i class="fas fa-times"></i> ยกเลิก
                            </button>
                        </div>
                    </form>
                </div>

                <div style="text-align: center; margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 10px; border: 1px solid #ffeaa7;">
                    <i class="fas fa-exclamation-triangle" style="color: #856404; margin-right: 8px;"></i>
                    <strong style="color: #856404;">หมายเหตุ:</strong> 
                    <span style="color: #856404;">กรุณาชำระเงินภายใน 24 ชั่วโมง หากเกินเวลาคำสั่งซื้อจะถูกยกเลิกอัตโนมัติ</span>
                </div>
            `;

            // ตั้งค่าวันที่และเวลาปัจจุบัน
            const now = new Date();
            document.getElementById('payment-date').value = now.toISOString().split('T')[0];
            document.getElementById('payment-time').value = now.toTimeString().slice(0, 5);

            // เพิ่ม Event Listener สำหรับฟอร์ม
            document.getElementById('payment-form').addEventListener('submit', function (e) {
                e.preventDefault();
                submitPayment(orderId);
            });

            document.getElementById('payment-modal').style.display = 'block';
        }

        function closePaymentPage() {
            const modal = document.getElementById('payment-modal');
            if (modal) {
                modal.style.display = 'none';
                // ล้าง content
                const content = document.getElementById('payment-content');
                if (content) {
                    content.innerHTML = '';
                }
            }
        }

        // คัดลอกข้อความ
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification(`📋 คัดลอก "${text}" แล้ว!`, 'success');
            }).catch(() => {
                showNotification('❌ ไม่สามารถคัดลอกได้', 'error');
            });
        }

        // ส่งข้อมูลการชำระเงิน
        function submitPayment(orderId) {
            const form = document.getElementById('payment-form');

            const paymentInfo = {
                orderId: orderId,
                studentId: currentUser.id,
                amount: parseFloat(document.getElementById('payment-amount').value),
                channel: document.getElementById('payment-channel').value,
                date: document.getElementById('payment-date').value,
                time: document.getElementById('payment-time').value,
                slip: document.getElementById('payment-slip').files[0],
                note: document.getElementById('payment-note').value.trim(),
                submittedAt: getCurrentDateTime(),
                status: 'pending-verification',
                verificationResult: null
            };

            // ตรวจสอบข้อมูลพื้นฐาน
            if (!paymentInfo.amount || !paymentInfo.channel || !paymentInfo.date || !paymentInfo.time || !paymentInfo.slip) {
                showNotification('⚠️ กรุณากรอกข้อมูลให้ครบถ้วน', 'error');
                return;
            }

            // ตรวจสอบขนาดไฟล์
            if (paymentInfo.slip.size > 5 * 1024 * 1024) { // 5MB
                showNotification('❌ ขนาดไฟล์ใหญ่เกินไป (เกิน 5MB)', 'error');
                return;
            }

            showNotification('🔄 กำลังตรวจสอบข้อมูลการชำระเงิน...', 'info');

            // จำลองการอ่านไฟล์
            const reader = new FileReader();
            reader.onload = function (e) {
                paymentInfo.slipData = e.target.result;

                // ทำการตรวจสอบอัตโนมัติ
                setTimeout(() => {
                    try {
                        processAutoVerification(paymentInfo);
                    } catch (error) {
                        console.error('Error in processAutoVerification:', error);
                        showNotification('❌ เกิดข้อผิดพลาดในการตรวจสอบ กรุณาลองใหม่อีกครั้ง', 'error');
                    }
                }, 2000);
            };
            reader.readAsDataURL(paymentInfo.slip);
        }

        // ระบบตรวจสอบอัตโนมัติ
        function processAutoVerification(paymentInfo) {
            const order = orders.find(o => o.id === paymentInfo.orderId);
            let verificationResult = {
                passed: true,
                checks: {},
                errors: [],
                warnings: []
            };

            // 1. ตรวจสอบยอดเงิน
            verificationResult.checks.amount = {
                expected: order.total,
                actual: paymentInfo.amount,
                passed: Math.abs(paymentInfo.amount - order.total) < 0.01
            };
            if (!verificationResult.checks.amount.passed) {
                verificationResult.errors.push(`ยอดเงินไม่ตรงกัน (ต้องการ ${order.total} บาท แต่โอน ${paymentInfo.amount} บาท)`);
                verificationResult.passed = false;
            }

            // 2. ตรวจสอบเวลาโอน (ไม่เกิน 24 ชั่วโมง)
            const paymentDateTime = new Date(`${paymentInfo.date}T${paymentInfo.time}`);
            const orderDateTime = new Date(order.date);
            const timeDiff = paymentDateTime - orderDateTime;
            const hoursDiff = timeDiff / (1000 * 60 * 60);

            verificationResult.checks.timing = {
                orderTime: order.date,
                paymentTime: `${paymentInfo.date} ${paymentInfo.time}`,
                hoursDiff: hoursDiff,
                passed: hoursDiff >= 0 && hoursDiff <= 24
            };
            if (!verificationResult.checks.timing.passed) {
                if (hoursDiff < 0) {
                    verificationResult.errors.push('เวลาโอนเงินก่อนเวลาสั่งซื้อ');
                } else {
                    verificationResult.errors.push('เกินเวลาชำระเงิน (เกิน 24 ชั่วโมง)');
                }
                verificationResult.passed = false;
            }

            // 3. ตรวจสอบช่องทางการโอน
            verificationResult.checks.channel = {
                method: paymentInfo.channel,
                passed: ['bank-transfer', 'promptpay', 'mobile-banking', 'atm'].includes(paymentInfo.channel)
            };

            // 4. จำลองการตรวจสอบ QR Code/สลิป (AI-based)
            verificationResult.checks.slip = simulateSlipVerification(paymentInfo);
            if (!verificationResult.checks.slip.passed) {
                verificationResult.errors.push('ตรวจสอบสลิปไม่ผ่าน: ' + verificationResult.checks.slip.reason);
                verificationResult.passed = false;
            }

            // บันทึกข้อมูลการชำระเงิน
            paymentInfo.verificationResult = verificationResult;
            paymentData.push(paymentInfo);

            // อัพเดทสถานะคำสั่งซื้อ
            if (verificationResult.passed) {
                updateOrderStatus(paymentInfo.orderId, 'pending-confirmation', 'ระบบตรวจสอบอัตโนมัติผ่าน รอเจ้าหน้าที่ตรวจสอบครั้งสุดท้าย');
                order.paymentData = paymentInfo;

                closePaymentPage();
                showNotification('✅ ตรวจสอบการชำระเงินผ่าน!\n\n🎉 ข้อมูลถูกต้องครบถ้วน\n⏳ รอเจ้าหน้าที่ตรวจสอบขั้นสุดท้าย', 'success');

                setTimeout(() => {
                    console.log('Trying to show tracking (success):', paymentInfo.orderId);
                    try {
                        showOrderTracking(paymentInfo.orderId);
                    } catch (trackingError) {
                        console.error('Error showing order tracking:', trackingError);
                        showNotification('การชำระเงินสำเร็จแล้ว กรุณาดูในประวัติการสั่งซื้อ', 'info');
                    }
                }, 1500);
            } else {
                updateOrderStatus(paymentInfo.orderId, 'pending-manual-verification', 'ตรวจสอบอัตโนมัติไม่ผ่าน รอเจ้าหน้าที่ตรวจสอบด้วยตนเอง');
                order.paymentData = paymentInfo;

                closePaymentPage();
                showNotification(`⚠️ ตรวจสอบการชำระเงินไม่ผ่าน\n\n❌ ปัญหาที่พบ:\n• ${verificationResult.errors.join('\n• ')}\n\n👨‍💼 รอเจ้าหน้าที่ตรวจสอบด้วยตนเอง`, 'warning');

                setTimeout(() => {
                    console.log('Trying to show tracking (failed):', paymentInfo.orderId);
                    try {
                        showOrderTracking(paymentInfo.orderId);
                    } catch (trackingError) {
                        console.error('Error showing order tracking:', trackingError);
                        showNotification('ส่งข้อมูลการชำระเงินแล้ว กรุณาดูในประวัติการสั่งซื้อ', 'info');
                    }
                }, 2000);
            }
        }

        // จำลองการตรวจสอบสลิป
        function simulateSlipVerification(paymentInfo) {
            // จำลองการตรวจสอบสลิปด้วย AI
            const random = Math.random();

            // 85% โอกาสผ่าน
            if (random > 0.15) {
                return {
                    passed: true,
                    confidence: Math.floor(85 + Math.random() * 15),
                    detectedAmount: paymentInfo.amount,
                    detectedAccount: shopBankAccount.accountNumber,
                    reason: 'ตรวจสอบสลิปผ่าน ข้อมูลตรงกับระบบ'
                };
            } else {
                const issues = [
                    'ไม่สามารถอ่าน QR Code ได้',
                    'ยอดเงินในสลิปไม่ชัดเจน',
                    'เลขบัญชีปลายทางไม่ตรงกัน',
                    'สลิปอาจถูกแก้ไข',
                    'รูปแบบสลิปไม่ได้มาตรฐาน'
                ];
                return {
                    passed: false,
                    confidence: Math.floor(Math.random() * 50),
                    reason: issues[Math.floor(Math.random() * issues.length)]
                };
            }
        }

        // แสดงการจัดการการชำระเงิน (Admin)
        function showPaymentManagement() {
            loadPaymentManagementTable();
            document.getElementById('payment-management-modal').style.display = 'block';
        }

        function closePaymentManagement() {
            document.getElementById('payment-management-modal').style.display = 'none';
        }

        function loadPaymentManagementTable() {
            const tbody = document.getElementById('payment-management-table');
            tbody.innerHTML = '';

            const pendingPayments = paymentData.filter(payment =>
                ['pending-verification', 'pending-manual-verification'].includes(payment.status)
            );

            if (pendingPayments.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #666; padding: 30px;">ไม่มีการชำระเงินที่รอตรวจสอบ</td></tr>';
                return;
            }

            pendingPayments.forEach(payment => {
                const order = orders.find(o => o.id === payment.orderId);
                const statusColor = payment.status === 'pending-verification' ? '#17a2b8' : '#ffc107';
                const statusText = payment.status === 'pending-verification' ? 'รอตรวจสอบ' : 'รอตรวจสอบแมนนวล';

                const row = document.createElement('tr');
                row.innerHTML = `
            <td>${payment.orderId}</td>
            <td>${order ? order.studentName : 'N/A'}</td>
            <td style="font-weight: 600; color: #2a5298;">${order ? order.total.toLocaleString() : 'N/A'} บาท</td>
            <td style="font-weight: 600; color: ${payment.amount === order?.total ? '#28a745' : '#dc3545'};">
                ${payment.amount.toLocaleString()} บาท
            </td>
            <td>${payment.date} ${payment.time}</td>
            <td>
                <span class="status-badge" style="background: ${statusColor}; color: white; padding: 5px 10px; border-radius: 12px; white-space: nowrap;">${statusText}</span>
            </td>
            <td>
                <button class="btn btn-info btn-small" onclick="viewPaymentSlip('${payment.orderId}')" title="ดูสลิป">
                    <i class="fas fa-receipt"></i> ดูสลิป
                </button>
            </td>
            <td>
                <button class="btn btn-success btn-small" onclick="approvePayment('${payment.orderId}')" style="margin-right: 5px;">
                    <i class="fas fa-check"></i> อนุมัติ
                </button>
                <button class="btn btn-danger btn-small" onclick="rejectPayment('${payment.orderId}')">
                    <i class="fas fa-times"></i> ปฏิเสธ
                </button>
            </td>
        `;
                tbody.appendChild(row);
            });
        }

        // อนุมัติการชำระเงิน
        function approvePayment(orderId) {
            if (confirm('✅ ยืนยันการอนุมัติการชำระเงินนี้หรือไม่?')) {
                const payment = paymentData.find(p => p.orderId === orderId);
                if (payment) {
                    payment.status = 'approved';
                    payment.approvedAt = getCurrentDateTime();
                    payment.approvedBy = currentUser.id;

                    updateOrderStatus(orderId, 'pending-approval', 'เจ้าหน้าที่อนุมัติการชำระเงินแล้ว รอการอนุมัติคำสั่งซื้อ');

                    loadPaymentManagementTable();
                    updateAdminStats();
                    loadRecentOrders();

                    showNotification(`✅ อนุมัติการชำระเงินสำหรับคำสั่งซื้อ ${orderId} เรียบร้อยแล้ว`, 'success');
                }
            }
        }

        // ปฏิเสธการชำระเงิน
        function rejectPayment(orderId) {
            const reason = prompt('❌ เหตุผลในการปฏิเสธ (จำเป็น):');
            if (reason && reason.trim()) {
                const payment = paymentData.find(p => p.orderId === orderId);
                if (payment) {
                    payment.status = 'rejected';
                    payment.rejectedAt = getCurrentDateTime();
                    payment.rejectedBy = currentUser.id;
                    payment.rejectionReason = reason.trim();

                    updateOrderStatus(orderId, 'payment-failed', `การชำระเงินถูกปฏิเสธ: ${reason.trim()}`);

                    loadPaymentManagementTable();
                    updateAdminStats();
                    loadRecentOrders();

                    showNotification(`❌ ปฏิเสธการชำระเงินสำหรับคำสั่งซื้อ ${orderId}\n\nเหตุผล: ${reason.trim()}`, 'warning');
                }
            }
        }

        // ===== ฟังก์ชันติดตามสถานะคำสั่งซื้อ =====

        // แสดงหน้าติดตามสถานะ 
        function showOrderTracking(orderId) {
            console.log('showOrderTracking called with orderId:', orderId);

            if (!orderId) {
                console.error('No orderId provided');
                showNotification('❌ ไม่พบรหัสคำสั่งซื้อ', 'error');
                return;
            }

            // ปิด modal อื่นๆ ทั้งหมดก่อน
            document.getElementById('payment-modal').style.display = 'none';
            document.getElementById('cart-modal').style.display = 'none';
            document.getElementById('product-modal').style.display = 'none';
            document.getElementById('product-management-modal').style.display = 'none';
            document.getElementById('order-management-modal').style.display = 'none';
            document.getElementById('payment-management-modal').style.display = 'none';
            document.getElementById('student-profile-modal').style.display = 'none';

            // ลบ overlay ประวัติการสั่งซื้อ (ถ้ามี)
            const overlays = document.querySelectorAll('[style*="position: fixed"][style*="z-index"]');
            overlays.forEach(overlay => {
                if (overlay.id !== 'order-tracking-modal' && overlay.parentNode) {
                    overlay.parentNode.removeChild(overlay);
                }
            });

            const order = orders.find(o => o.id === orderId);
            if (!order) {
                showNotification('❌ ไม่พบคำสั่งซื้อ', 'error');
                return;
            }

            const content = document.getElementById('order-tracking-content');
            content.innerHTML = createOrderTrackingHTML(order);
            document.getElementById('order-tracking-modal').style.display = 'block';
        }

        // สร้าง HTML สำหรับติดตามสถานะ
        function createOrderTrackingHTML(order) {
            const statusList = ['pending-payment', 'pending-confirmation', 'pending-approval', 'preparing', 'ready', 'completed'];
            const currentStatusIndex = statusList.indexOf(order.status);
            const isCompleted = order.status === 'completed';
            const isCancelled = order.status === 'cancelled';

            let timelineHTML = '';

            statusList.forEach((statusKey, index) => {
                const status = orderStatuses[statusKey];
                let stepClass = 'step-pending';
                let stepContent = '';

                if (isCancelled && statusKey === 'cancelled') {
                    stepClass = 'step-current';
                    stepContent = `
                        <div class="step-title">${orderStatuses['cancelled'].name}</div>
                        <div class="step-description">คำสั่งซื้อถูกยกเลิก</div>
                        <div class="step-time">${getCurrentDateTime()}</div>
                    `;
                } else if (isCancelled) {
                    stepClass = 'step-pending';
                    stepContent = `
                        <div class="step-title">${status.name}</div>
                        <div class="step-description">${status.description}</div>
                        <div class="step-time">-</div>
                    `;
                } else if (index < currentStatusIndex) {
                    stepClass = 'step-completed';
                    const trackingInfo = order.tracking.find(t => t.status === statusKey);
                    stepContent = `
                        <div class="step-title">${status.name}</div>
                        <div class="step-description">${trackingInfo ? trackingInfo.description : status.description}</div>
                        <div class="step-time">${trackingInfo ? trackingInfo.timestamp : '-'}</div>
                    `;
                } else if (index === currentStatusIndex) {
                    stepClass = 'step-current';
                    const trackingInfo = order.tracking.find(t => t.status === statusKey);
                    stepContent = `
                        <div class="step-title">${status.name}</div>
                        <div class="step-description">${trackingInfo ? trackingInfo.description : status.description}</div>
                        <div class="step-time">${trackingInfo ? trackingInfo.timestamp : getCurrentDateTime()}</div>
                    `;
                } else {
                    stepClass = 'step-pending';
                    stepContent = `
                        <div class="step-title">${status.name}</div>
                        <div class="step-description">${status.description}</div>
                        <div class="step-time">-</div>
                    `;
                }

                timelineHTML += `
                    <div class="tracking-step">
                        <div class="step-icon ${stepClass}">
                            <i class="${status.icon}"></i>
                        </div>
                        <div class="step-content">
                            ${stepContent}
                        </div>
                        ${index < statusList.length - 1 ? '<div class="tracking-line"></div>' : ''}
                    </div>
                `;
            });

            // เพิ่มสถานะยกเลิกถ้าจำเป็น
            if (isCancelled) {
                timelineHTML += `
                    <div class="tracking-step">
                        <div class="step-icon step-current" style="background: #dc3545;">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <div class="step-content">
                            <div class="step-title">ยกเลิก</div>
                            <div class="step-description">คำสั่งซื้อถูกยกเลิก</div>
                            <div class="step-time">${getCurrentDateTime()}</div>
                        </div>
                    </div>
                `;
            }

            return `
                <h2><i class="fas fa-truck"></i> ติดตามสถานะคำสั่งซื้อ</h2>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <h3 style="color: #2a5298; margin-bottom: 15px;">รายละเอียดคำสั่งซื้อ</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div><strong>รหัสคำสั่งซื้อ:</strong> ${order.id}</div>
                        <div><strong>ลูกค้า:</strong> ${order.studentName}</div>
                        <div><strong>วันที่สั่ง:</strong> ${order.date}</div>
                        <div><strong>ยอดรวม:</strong> ${order.total.toLocaleString()} บาท</div>
                    </div>
                </div>

                <div style="background: #fff; padding: 20px; border-radius: 10px; margin: 20px 0; border: 1px solid #dee2e6;">
                    <h3 style="color: #2a5298; margin-bottom: 15px;">รายการสินค้า</h3>
                    ${order.items.map(item => `
                        <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee;">
                            <span>${item.name} × ${item.quantity}</span>
                            <span style="font-weight: 600;">${(item.price * item.quantity).toLocaleString()} บาท</span>
                        </div>
                    `).join('')}
                    <div style="display: flex; justify-content: space-between; padding: 15px 0; font-weight: 700; font-size: 18px; color: #2a5298;">
                        <span>รวมทั้งหมด</span>
                        <span>${order.total.toLocaleString()} บาท</span>
                    </div>
                </div>

                <div class="order-tracking">
                    <h3 style="color: #2a5298; margin-bottom: 20px;"><i class="fas fa-route"></i> สถานะการดำเนินการ</h3>
                    <div class="tracking-timeline">
                        ${timelineHTML}
                    </div>
                </div>

                ${order.status === 'ready' ? `
                    <div class="order-actions">
                        <h4 style="color: #28a745; margin-bottom: 15px;"><i class="fas fa-info-circle"></i> สินค้าพร้อมรับแล้ว!</h4>
                        <p style="margin-bottom: 20px;">กรุณามารับสินค้าที่ร้านค้ามหาวิทยาลัย พร้อมรหัสคำสั่งซื้อ <strong>${order.id}</strong></p>
                        
                        <button class="btn btn-warning" onclick="showPickupPage('${order.id}')" style="margin-right: 10px;">
                            <i class="fas fa-qrcode"></i> ดู QR Code รับสินค้า
                        </button>
                        
                        <button class="btn btn-success" onclick="confirmReceived('${order.id}')">
                            <i class="fas fa-check-circle"></i> ยืนยันการรับสินค้า
                        </button>
                    </div>
                ` : ''}

                ${order.status === 'pending-payment' ? `
                    <div class="order-actions">
                        <h4 style="color: #ffc107; margin-bottom: 15px;"><i class="fas fa-credit-card"></i> การชำระเงิน</h4>
                        <p style="margin-bottom: 20px;">กรุณาชำระเงินจำนวน <strong>${order.total.toLocaleString()} บาท</strong></p>
                        
                        <button class="btn btn-success" onclick="showPaymentPage('${order.id}')" style="margin-right: 10px;">
                            <i class="fas fa-credit-card"></i> ไปหน้าชำระเงิน
                        </button>
                        
                        <button class="btn btn-warning" onclick="markAsPaid('${order.id}')" style="margin-right: 10px;">
                            <i class="fas fa-money-bill-wave"></i> ชำระเงินแล้ว
                        </button>
                        
                        <button class="btn btn-danger" onclick="cancelOrder('${order.id}')">
                            <i class="fas fa-times"></i> ยกเลิกคำสั่งซื้อ
                        </button>
                    </div>
                ` : ''} 
                
                ${['pending-verification', 'pending-manual-verification', 'pending-confirmation'].includes(order.status) ? `
                    <div class="order-actions">
                        <h4 style="color: #17a2b8; margin-bottom: 15px;"><i class="fas fa-clock"></i> รอตรวจสอบการชำระเงิน</h4>
                        <p style="margin-bottom: 20px;">ระบบกำลังตรวจสอบข้อมูลการชำระเงินของคุณ กรุณารอสักครู่</p>
                        
                        ${order.status === 'pending-manual-verification' ? `
                            <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #ffc107;">
                                <i class="fas fa-exclamation-triangle" style="color: #856404; margin-right: 8px;"></i>
                                <strong style="color: #856404;">ระบบตรวจสอบอัตโนมัติไม่ผ่าน</strong><br>
                                <span style="color: #856404;">รอเจ้าหน้าที่ตรวจสอบด้วยตนเอง</span>
                            </div>
                        ` : ''}
                        
                        ${order.status === 'pending-verification' ? `
                            <div style="background: #d1ecf1; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #17a2b8;">
                                <i class="fas fa-search" style="color: #0c5460; margin-right: 8px;"></i>
                                <span style="color: #0c5460;">ระบบกำลังตรวจสอบข้อมูลอัตโนมัติ...</span>
                            </div>
                        ` : ''}
                        
                        ${order.status === 'pending-confirmation' ? `
                            <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #28a745;">
                                <i class="fas fa-check-circle" style="color: #155724; margin-right: 8px;"></i>
                                <span style="color: #155724;">ระบบตรวจสอบผ่าน รอเจ้าหน้าที่อนุมัติ</span>
                            </div>
                        ` : ''}
                    </div>
                ` : ''}
                
                ${order.status === 'payment-failed' ? `
                    <div class="order-actions">
                        <h4 style="color: #dc3545; margin-bottom: 15px;"><i class="fas fa-times-circle"></i> การชำระเงินไม่สำเร็จ</h4>
                        <div style="background: #f8d7da; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #dc3545;">
                            <p style="color: #721c24; margin: 0;">การชำระเงินของคุณถูกปฏิเสธ กรุณาตรวจสอบข้อมูลและชำระเงินใหม่อีกครั้ง</p>
                        </div>
                        
                        <button class="btn btn-success" onclick="showPaymentPage('${order.id}')" style="margin-right: 10px;">
                            <i class="fas fa-credit-card"></i> ชำระเงินใหม่
                        </button>
                        
                        <button class="btn btn-danger" onclick="cancelOrder('${order.id}')">
                            <i class="fas fa-times"></i> ยกเลิกคำสั่งซื้อ
                        </button>
                    </div>
                ` : ''}

                <div class="button-group" style="margin-top: 30px;">
                    <button class="btn btn-info" onclick="refreshOrderStatus('${order.id}')">
                        <i class="fas fa-sync-alt"></i> รีเฟรชสถานะ
                    </button>
                    <button class="btn btn-secondary" onclick="closeOrderTracking()">
                        <i class="fas fa-times"></i> ปิด
                    </button>
                </div>
            `;
        }

        // ปิดหน้าติดตามสถานะ
        function closeOrderTracking() {
            const modal = document.getElementById('order-tracking-modal');
            if (modal) {
                modal.style.display = 'none';
                // ล้างเนื้อหา modal เพื่อป้องกันปัญหา
                const content = document.getElementById('order-tracking-content');
                if (content) {
                    content.innerHTML = '';
                }
            }
        }

        // รีเฟรชสถานะคำสั่งซื้อ
        function refreshOrderStatus(orderId) {
            showNotification('🔄 กำลังอัพเดทสถานะ...', 'info');
            setTimeout(() => {
                showOrderTracking(orderId);
                showNotification('✅ อัพเดทสถานะเรียบร้อยแล้ว', 'success');
            }, 1000);
        }

        // อัพเดทสถานะคำสั่งซื้อ
        function updateOrderStatus(orderId, newStatus, description = '') {
            console.log('updateOrderStatus called:', orderId, newStatus);

            if (!orderId) {
                console.error('No orderId provided to updateOrderStatus');
                return;
            }

            const order = orders.find(o => o.id === orderId);
            if (!order) {
                console.error('Order not found:', orderId);
                return;
            }

            if (!orderStatuses[newStatus]) {
                console.error('Invalid status:', newStatus);
                return;
            }

            try {
                const oldStatus = order.status;
                order.status = newStatus;

                // เพิ่มข้อมูลการติดตาม
                const statusInfo = orderStatuses[newStatus];
                order.tracking.push({
                    status: newStatus,
                    timestamp: getCurrentDateTime(),
                    description: description || statusInfo.description
                });

                // ส่งการแจ้งเตือนให้นักศึกษา
                sendStatusChangeNotification(order, oldStatus, newStatus, description);

                showNotification(`✅ อัพเดทสถานะคำสั่งซื้อ ${orderId} เป็น "${statusInfo.name}" เรียบร้อยแล้ว`, 'success');

                if (currentUser && currentUser.type === 'admin') {
                    updateAdminStats();
                    loadRecentOrders();
                }
            } catch (error) {
                console.error('Error in updateOrderStatus:', error);
                showNotification('❌ เกิดข้อผิดพลาดในการอัพเดทสถานะ', 'error');
            }
        }

        // ส่งการแจ้งเตือนเมื่อสถานะเปลี่ยนแปลง
        function sendStatusChangeNotification(order, oldStatus, newStatus, description) {
            let notificationType = '';
            let message = '';

            switch (newStatus) {
                case 'pending-verification':
                    notificationType = 'payment-received';
                    message = `ได้รับข้อมูลการชำระเงินสำหรับคำสั่งซื้อ ${order.id} แล้ว ระบบกำลังตรวจสอบ`;
                    break;

                case 'pending-confirmation':
                    notificationType = 'payment-approved';
                    message = `การชำระเงินสำหรับคำสั่งซื้อ ${order.id} ผ่านการตรวจสอบแล้ว รอเจ้าหน้าที่ยืนยัน`;
                    break;

                case 'payment-failed':
                    notificationType = 'payment-rejected';
                    message = `การชำระเงินสำหรับคำสั่งซื้อ ${order.id} ถูกปฏิเสธ กรุณาตรวจสอบและชำระใหม่`;
                    break;

                case 'pending-approval':
                    notificationType = 'payment-approved';
                    message = `การชำระเงินสำหรับคำสั่งซื้อ ${order.id} ได้รับการยืนยันแล้ว รอการอนุมัติคำสั่งซื้อ`;
                    break;

                case 'preparing':
                    notificationType = 'order-approved';
                    message = `คำสั่งซื้อ ${order.id} ได้รับการอนุมัติแล้ว กำลังเตรียมสินค้าให้ท่าน`;
                    break;

                case 'ready':
                    notificationType = 'order-ready';
                    message = `สินค้าสำหรับคำสั่งซื้อ ${order.id} พร้อมรับแล้ว! กรุณามารับที่ร้านค้ามหาวิทยาลัย`;
                    break;

                case 'completed':
                    notificationType = 'order-completed';
                    message = `คำสั่งซื้อ ${order.id} เสร็จสิ้นแล้ว ขอบคุณที่ใช้บริการ`;
                    break;

                case 'cancelled':
                    notificationType = 'order-cancelled';
                    message = `คำสั่งซื้อ ${order.id} ถูกยกเลิกแล้ว`;
                    break;

                default:
                    return; // ไม่ส่งการแจ้งเตือนสำหรับสถานะอื่นๆ
            }

            if (notificationType) {
                createNotification(
                    order.studentId,
                    notificationType,
                    order.id,
                    message,
                    {
                        oldStatus: oldStatus,
                        newStatus: newStatus,
                        orderTotal: order.total,
                        studentName: order.studentName
                    }
                );
            }
        }

        // ยืนยันการชำระเงิน (สำหรับนักศึกษา)
        function markAsPaid(orderId) {
            const order = orders.find(o => o.id === orderId);

            // ตรวจสอบว่ามีข้อมูลการชำระเงินหรือไม่
            if (!order.paymentData) {
                showNotification('⚠️ ยังไม่ได้ส่งข้อมูลการชำระเงิน!\n\n📋 กรุณาไปหน้าชำระเงินเพื่อส่งข้อมูลการชำระก่อน\n\n💡 หากชำระเงินแล้ว ให้อัปโหลดสลิปการโอนเงิน', 'error');
                return;
            }

            // ถ้ามีข้อมูลการชำระแล้ว แสดงว่าอยู่ในขั้นตอนการตรวจสอบ
            if (order.paymentData && order.status !== 'pending-payment') {
                showNotification('ℹ️ ข้อมูลการชำระเงินถูกส่งแล้ว\n\n🔍 ระบบกำลังตรวจสอบข้อมูลของคุณ\n⏳ กรุณารอผลการตรวจสอบ', 'info');
                return;
            }

            // หากยังไม่ได้ชำระเงิน
            showNotification('❌ ยังไม่สามารถยืนยันได้!\n\n📝 กรุณาดำเนินการดังนี้:\n1. ไปหน้าชำระเงิน\n2. โอนเงินตามข้อมูลบัญชี\n3. อัปโหลดสลิปการโอน\n4. ส่งข้อมูลเพื่อตรวจสอบ', 'warning');
        }

        // ยืนยันการรับสินค้า
        function confirmReceived(orderId) {
            const order = orders.find(o => o.id === orderId);

            if (confirm(`📦 ยืนยันว่าได้รับสินค้าแล้ว?\n\nรหัสคำสั่งซื้อ: ${orderId}\nรายการสินค้า: ${order.items.length} รายการ\nยอดรวม: ${order.total.toLocaleString()} บาท\n\n⚠️ เมื่อยืนยันแล้วจะไม่สามารถแก้ไขได้`)) {

                // บันทึกข้อมูลการรับสินค้าโดยนักศึกษา
                if (!order.pickupData) {
                    order.pickupData = {
                        pickupTime: getCurrentDateTime(),
                        pickupBy: 'student-self-confirm',
                        studentConfirmed: true
                    };
                } else {
                    order.pickupData.studentConfirmed = true;
                    order.pickupData.studentConfirmTime = getCurrentDateTime();
                }

                try {
                    updateOrderStatus(orderId, 'completed', 'นักศึกษายืนยันการรับสินค้าเรียบร้อยแล้ว');

                    setTimeout(() => {
                        try {
                            showOrderTracking(orderId);
                        } catch (trackingError) {
                            console.error('Error showing tracking after completion:', trackingError);
                        }
                    }, 500);

                    showNotification(`🎉 ยืนยันการรับสินค้าเรียบร้อยแล้ว!\n\n📦 คำสั่งซื้อ ${orderId} เสร็จสิ้นแล้ว\n⭐ ขอบคุณที่ใช้บริการ`, 'success');
                } catch (error) {
                    console.error('Error in confirmReceived:', error);
                    showNotification('❌ เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง', 'error');
                }
            }
        }
        // ยกเลิกคำสั่งซื้อ
        function cancelOrder(orderId) {
            if (confirm('❌ ต้องการยกเลิกคำสั่งซื้อนี้หรือไม่?')) {
                const order = orders.find(o => o.id === orderId);
                if (order) {
                    // คืนสต็อกสินค้า
                    order.items.forEach(item => {
                        const product = products.find(p => p.id === item.id);
                        if (product) {
                            product.stock += item.quantity;
                        }
                    });

                    updateOrderStatus(orderId, 'cancelled', 'คำสั่งซื้อถูกยกเลิกโดยลูกค้า');
                    showOrderTracking(orderId);
                    loadProducts(); // อัพเดทการแสดงสินค้า
                }
            }
        }

        // ===== ฟังก์ชันระบบแจ้งเตือน =====

        // สร้างการแจ้งเตือนใหม่
        function createNotification(userId, type, orderId, message, additionalData = {}) {
            const notification = {
                id: notificationIdCounter++,
                userId: userId,
                type: type,
                orderId: orderId,
                message: message,
                timestamp: getCurrentDateTime(),
                isRead: false,
                additionalData: additionalData
            };

            notifications.push(notification);
            updateNotificationDisplay();

            // แสดง popup notification ถ้าเป็นผู้ใช้ปัจจุบัน
            if (currentUser && currentUser.id === userId) {
                showPopupNotification(notification);
            }

            return notification;
        }

        // แสดง popup notification
        function showPopupNotification(notification) {
            const typeInfo = notificationTypes[notification.type];
            const popup = document.createElement('div');
            popup.className = 'notification-popup';
            popup.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                max-width: 350px;
                padding: 15px 20px;
                background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
                border-radius: 12px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.15);
                border-left: 4px solid ${typeInfo.color};
                z-index: 10001;
                font-family: 'Sarabun', sans-serif;
                animation: slideInRight 0.5s ease;
                cursor: pointer;
                transition: all 0.3s ease;
            `;

            popup.innerHTML = `
                <div style="display: flex; align-items: center; margin-bottom: 8px;">
                    <i class="${typeInfo.icon}" style="color: ${typeInfo.color}; margin-right: 10px; font-size: 18px;"></i>
                    <strong style="color: #333; font-size: 16px;">${typeInfo.title}</strong>
                </div>
                <div style="color: #666; font-size: 14px; line-height: 1.4; margin-bottom: 8px;">
                    ${notification.message}
                </div>
                <div style="color: #999; font-size: 12px;">
                    <i class="fas fa-clock"></i> ${notification.timestamp}
                </div>
            `;

            // เพิ่ม hover effect
            popup.addEventListener('mouseenter', () => {
                popup.style.transform = 'translateY(-2px)';
                popup.style.boxShadow = '0 15px 40px rgba(0,0,0,0.2)';
            });

            popup.addEventListener('mouseleave', () => {
                popup.style.transform = 'translateY(0)';
                popup.style.boxShadow = '0 10px 30px rgba(0,0,0,0.15)';
            });

            // คลิกเพื่อเปิดรายละเอียด
            popup.addEventListener('click', () => {
                if (notification.orderId) {
                    showOrderTracking(notification.orderId);
                }
                document.body.removeChild(popup);
            });

            document.body.appendChild(popup);

            // ลบ popup หลังจาก 5 วินาที
            setTimeout(() => {
                if (document.body.contains(popup)) {
                    popup.style.animation = 'slideOutRight 0.5s ease';
                    setTimeout(() => {
                        if (document.body.contains(popup)) {
                            document.body.removeChild(popup);
                        }
                    }, 500);
                }
            }, 5000);
        }

        // อัพเดทการแสดงผลแจ้งเตือน
        function updateNotificationDisplay() {
            if (!currentUser || currentUser.type !== 'student') return;

            const userNotifications = notifications.filter(n => n.userId === currentUser.id);
            const unreadCount = userNotifications.filter(n => !n.isRead).length;

            const countElement = document.getElementById('notification-count');
            if (countElement) {
                if (unreadCount > 0) {
                    countElement.textContent = unreadCount > 99 ? '99+' : unreadCount;
                    countElement.style.display = 'flex';
                } else {
                    countElement.style.display = 'none';
                }
            }
        }

        // แสดงรายการแจ้งเตือน
        function showNotifications() {
            if (!currentUser || currentUser.type !== 'student') {
                showNotification('❌ เฉพาะนักศึกษาเท่านั้นที่สามารถดูการแจ้งเตือนได้', 'error');
                return;
            }

            // ปิด modal อื่นๆ ทั้งหมดก่อน
            document.getElementById('order-tracking-modal').style.display = 'none';
            document.getElementById('payment-modal').style.display = 'none';
            document.getElementById('cart-modal').style.display = 'none';
            document.getElementById('pickup-modal').style.display = 'none';

            loadNotificationList();
            document.getElementById('notification-modal').style.display = 'block';
        }

        // โหลดรายการแจ้งเตือน
        function loadNotificationList() {
            const userNotifications = notifications
                .filter(n => n.userId === currentUser.id)
                .sort((a, b) => b.id - a.id); // เรียงจากใหม่ไปเก่า

            const listElement = document.getElementById('notification-list');

            if (userNotifications.length === 0) {
                listElement.innerHTML = `
                    <div style="text-align: center; color: #666; padding: 40px;">
                        <i class="fas fa-bell-slash" style="font-size: 48px; margin-bottom: 15px; display: block; color: #ccc;"></i>
                        <h3>ไม่มีการแจ้งเตือน</h3>
                        <p>เมื่อมีการอัพเดทสถานะคำสั่งซื้อ คุณจะได้รับการแจ้งเตือนที่นี่</p>
                    </div>
                `;
                return;
            }

            let listHTML = '';
            userNotifications.forEach(notification => {
                const typeInfo = notificationTypes[notification.type];
                const isUnread = !notification.isRead;

                listHTML += `
                    <div class="notification-item" style="
                        border: 1px solid ${isUnread ? typeInfo.color : '#dee2e6'};
                        border-radius: 10px;
                        padding: 15px;
                        margin-bottom: 10px;
                        background: ${isUnread ? 'linear-gradient(135deg, ' + typeInfo.color + '0a 0%, #ffffff 100%)' : '#f8f9fa'};
                        cursor: pointer;
                        transition: all 0.3s ease;
                        ${isUnread ? 'border-left: 4px solid ' + typeInfo.color + ';' : ''}
                    " onclick="openNotification(${notification.id})">
                        <div style="display: flex; align-items: flex-start; justify-content: space-between;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                    <i class="${typeInfo.icon}" style="color: ${typeInfo.color}; margin-right: 10px; font-size: 16px;"></i>
                                    <strong style="color: #333; font-size: 16px;">${typeInfo.title}</strong>
                                    ${isUnread ? '<span style="background: ' + typeInfo.color + '; color: white; font-size: 10px; padding: 2px 6px; border-radius: 10px; margin-left: 8px;">ใหม่</span>' : ''}
                                </div>
                                <div style="color: #666; font-size: 14px; line-height: 1.4; margin-bottom: 8px;">
                                    ${notification.message}
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="color: #999; font-size: 12px;">
                                        <i class="fas fa-clock"></i> ${notification.timestamp}
                                    </span>
                                    ${notification.orderId ? '<span style="color: #2a5298; font-size: 12px; font-weight: 600;">' + notification.orderId + '</span>' : ''}
                                </div>
                            </div>
                            <div style="margin-left: 15px;">
                                <button onclick="event.stopPropagation(); markAsRead(${notification.id})" 
                                        style="background: none; border: none; color: #666; cursor: pointer; padding: 5px;"
                                        title="${isUnread ? 'ทำเครื่องหมายว่าอ่านแล้ว' : 'อ่านแล้ว'}">
                                    <i class="fas fa-${isUnread ? 'eye' : 'eye-slash'}"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });

            listElement.innerHTML = listHTML;
        }

        // เปิดการแจ้งเตือน
        function openNotification(notificationId) {
            const notification = notifications.find(n => n.id === notificationId);
            if (notification) {
                markAsRead(notificationId);
                if (notification.orderId) {
                    closeNotifications();
                    setTimeout(() => {
                        showOrderTracking(notification.orderId);
                    }, 300);
                }
            }
        }

        // ทำเครื่องหมายว่าอ่านแล้ว
        function markAsRead(notificationId) {
            const notification = notifications.find(n => n.id === notificationId);
            if (notification) {
                notification.isRead = true;
                updateNotificationDisplay();
                loadNotificationList();
            }
        }

        // ทำเครื่องหมายอ่านทั้งหมด
        function markAllAsRead() {
            notifications.forEach(notification => {
                if (notification.userId === currentUser.id) {
                    notification.isRead = true;
                }
            });
            updateNotificationDisplay();
            loadNotificationList();
            showNotification('✅ ทำเครื่องหมายอ่านทั้งหมดแล้ว', 'success');
        }

        // ลบการแจ้งเตือนทั้งหมด
        function clearAllNotifications() {
            if (confirm('🗑️ ต้องการลบการแจ้งเตือนทั้งหมดหรือไม่?')) {
                notifications = notifications.filter(n => n.userId !== currentUser.id);
                updateNotificationDisplay();
                loadNotificationList();
                showNotification('🗑️ ลบการแจ้งเตือนทั้งหมดแล้ว', 'info');
            }
        }

        // ปิด Modal แจ้งเตือน
        function closeNotifications() {
            document.getElementById('notification-modal').style.display = 'none';
        }

        // ===== ฟังก์ชันระบบรับสินค้า =====

        // สร้าง QR Code สำหรับคำสั่งซื้อ
        function generateQRCode(orderId) {
            const qrData = {
                orderId: orderId,
                type: 'pickup',
                timestamp: Date.now()
            };

            const canvas = document.createElement('canvas');
            const qr = new QRious({
                element: canvas,
                value: JSON.stringify(qrData),
                size: 200,
                background: 'white',
                foreground: '#2a5298'
            });

            return canvas.toDataURL();
        }

        // แสดงหน้ารับสินค้าสำหรับนักศึกษา
        function showPickupPage(orderId) {
            // ปิด modal อื่นๆ ทั้งหมดก่อน
            document.getElementById('order-tracking-modal').style.display = 'none';
            document.getElementById('payment-modal').style.display = 'none';
            document.getElementById('cart-modal').style.display = 'none';
            document.getElementById('product-modal').style.display = 'none';

            const order = orders.find(o => o.id === orderId);
            if (!order) {
                showNotification('❌ ไม่พบคำสั่งซื้อ', 'error');
                return;
            }

            if (order.status !== 'ready') {
                showNotification('⚠️ สินค้ายังไม่พร้อมรับ\n\nสถานะปัจจุบัน: ' + orderStatuses[order.status].name, 'warning');
                return;
            }

            const qrCodeData = generateQRCode(orderId);
            const pickupDate = new Date();
            pickupDate.setHours(pickupDate.getHours() + 24); // วันรับสินค้า (24 ชั่วโมงจากตอนนี้)

            const content = document.getElementById('pickup-content');
            content.innerHTML = `
                <h2 style="text-align: center; color: #28a745; margin-bottom: 30px;">
                    <i class="fas fa-hand-holding"></i> รับสินค้า
                </h2>

                <!-- ข้อมูลคำสั่งซื้อ -->
                <div style="background: linear-gradient(135deg, #d4edda 0%, #ffffff 100%); padding: 25px; border-radius: 15px; margin-bottom: 25px; border: 2px solid #28a745;">
                    <h3 style="color: #28a745; margin-bottom: 20px; text-align: center;">
                        <i class="fas fa-check-circle"></i> สินค้าพร้อมรับแล้ว!
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div><strong>รหัสคำสั่งซื้อ:</strong> ${order.id}</div>
                        <div><strong>ลูกค้า:</strong> ${order.studentName}</div>
                        <div><strong>ยอดรวม:</strong> ${order.total.toLocaleString()} บาท</div>
                        <div><strong>วันที่สั่ง:</strong> ${order.date}</div>
                    </div>
                    
                    <div style="background: white; padding: 15px; border-radius: 10px; border: 1px solid #28a745;">
                        <strong>รายการสินค้า:</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            ${order.items.map(item => `<li>${item.name} × ${item.quantity}</li>`).join('')}
                        </ul>
                    </div>
                </div>

                <!-- QR Code -->
                <div style="background: white; padding: 30px; border-radius: 15px; margin-bottom: 25px; border: 2px solid #ffc107; text-align: center;">
                    <h3 style="color: #856404; margin-bottom: 20px;">
                        <i class="fas fa-qrcode"></i> QR Code สำหรับรับสินค้า
                    </h3>
                    
                    <div style="display: inline-block; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                        <img src="${qrCodeData}" alt="QR Code" style="display: block; margin: 0 auto;">
                        <div style="margin-top: 15px; font-family: monospace; font-size: 18px; font-weight: 600; color: #2a5298;">
                            ${order.id}
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; color: #856404;">
                        <p><strong>วิธีใช้:</strong></p>
                        <p>1. นำ QR Code นี้ไปที่เคาน์เตอร์ร้านค้า</p>
                        <p>2. ให้เจ้าหน้าที่สแกนเพื่อยืนยันการรับสินค้า</p>
                        <p>3. ตรวจสอบสินค้าให้ครบถ้วนถูกต้อง</p>
                    </div>
                </div>

                <!-- ข้อมูลการรับสินค้า -->
                <div style="background: #fff3cd; padding: 20px; border-radius: 15px; margin-bottom: 25px; border: 2px solid #ffc107;">
                    <h3 style="color: #856404; margin-bottom: 15px;">
                        <i class="fas fa-info-circle"></i> ข้อมูลการรับสินค้า
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div><strong>สถานที่รับ:</strong> ร้านค้ามหาวิทยาลัย อาคาร 1 ชั้น 1</div>
                        <div><strong>เวลาเปิด-ปิด:</strong> จันทร์-ศุกร์ 8:00-16:00</div>
                        <div><strong>ติดต่อ:</strong> 043-336-000 ต่อ 1234</div>
                        <div><strong>กำหนดรับภายใน:</strong> ${pickupDate.toLocaleDateString('th-TH')}</div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 20px; padding: 15px; background: #d1ecf1; border-radius: 10px; border: 1px solid #17a2b8;">
                    <i class="fas fa-clock" style="color: #0c5460; margin-right: 8px;"></i>
                    <strong style="color: #0c5460;">หมายเหตุ:</strong> 
                    <span style="color: #0c5460;">กรุณานำบัตรนักศึกษามาแสดงด้วยเพื่อยืนยันตัวตน</span>
                </div>

                <div class="button-group" style="margin-top: 30px;">
                    <button class="btn btn-success" onclick="downloadQRCode('${order.id}')">
                        <i class="fas fa-download"></i> ดาวน์โหลด QR Code
                    </button>
                    <button class="btn btn-secondary" onclick="closePickupModal()">
                        <i class="fas fa-times"></i> ปิด
                    </button>
                </div>
            `;

            document.getElementById('pickup-modal').style.display = 'block';
        }

        // ปิด Modal รับสินค้า
        function closePickupModal() {
            document.getElementById('pickup-modal').style.display = 'none';
        }

        // ดาวน์โหลด QR Code
        function downloadQRCode(orderId) {
            const qrCodeData = generateQRCode(orderId);
            const link = document.createElement('a');
            link.download = `QR-Code-${orderId}.png`;
            link.href = qrCodeData;
            link.click();
            showNotification('📥 ดาวน์โหลด QR Code เรียบร้อยแล้ว!', 'success');
        }

        // แสดงหน้าสแกน QR Code (Admin)
        function showQRScanner() {
            // ปิด modal อื่นๆ ทั้งหมดก่อน
            document.getElementById('order-tracking-modal').style.display = 'none';
            document.getElementById('payment-modal').style.display = 'none';
            document.getElementById('product-management-modal').style.display = 'none';
            document.getElementById('order-management-modal').style.display = 'none';
            document.getElementById('payment-management-modal').style.display = 'none';

            document.getElementById('qr-scanner-modal').style.display = 'block';
        }

        // ปิดหน้าสแกน QR Code
        function closeQRScanner() {
            document.getElementById('qr-scanner-modal').style.display = 'none';
        }

        // ยืนยันการรับสินค้า (Admin)
        function confirmPickup() {
            const orderId = document.getElementById('manual-order-id').value.trim();

            if (!orderId) {
                showNotification('⚠️ กรุณากรอกรหัสคำสั่งซื้อ', 'error');
                return;
            }

            const order = orders.find(o => o.id === orderId);
            if (!order) {
                showNotification('❌ ไม่พบคำสั่งซื้อ: ' + orderId, 'error');
                return;
            }

            if (order.status !== 'ready') {
                showNotification(`⚠️ สถานะคำสั่งซื้อไม่ถูกต้อง\n\nสถานะปัจจุบัน: ${orderStatuses[order.status].name}\nต้องเป็นสถานะ "พร้อมรับสินค้า" เท่านั้น`, 'warning');
                return;
            }

            if (confirm(`📦 ยืนยันการรับสินค้า?\n\nรหัสคำสั่งซื้อ: ${orderId}\nลูกค้า: ${order.studentName}\nยอดรวม: ${order.total.toLocaleString()} บาท`)) {
                // บันทึกข้อมูลการรับสินค้า
                order.pickupData = {
                    pickupTime: getCurrentDateTime(),
                    pickupBy: currentUser.id,
                    adminName: `${currentUser.firstname} ${currentUser.lastname}`
                };

                updateOrderStatus(orderId, 'completed', `การรับสินค้าเสร็จสิ้น รับโดย ${order.studentName} ยืนยันโดย ${order.pickupData.adminName}`);

                document.getElementById('manual-order-id').value = '';
                closeQRScanner();

                showNotification(`✅ ยืนยันการรับสินค้าเรียบร้อยแล้ว!\n\n📦 คำสั่งซื้อ: ${orderId}\n👤 ลูกค้า: ${order.studentName}\n⏰ เวลา: ${order.pickupData.pickupTime}`, 'success');

                updateAdminStats();
                loadRecentOrders();
            }
        }

        // ===== ฟังก์ชัน Admin =====

        // แสดงจัดการสินค้า (Admin)
        function showProductManagement() {
            loadProductManagementTable();
            document.getElementById('product-management-modal').style.display = 'block';
        }

        function closeProductManagement() {
            document.getElementById('product-management-modal').style.display = 'none';
        }

        function loadProductManagementTable() {
            const tbody = document.getElementById('product-management-table');
            tbody.innerHTML = '';

            products.forEach(product => {
                const row = document.createElement('tr');

                // กำหนดสีของสต็อก
                let stockClass = 'stock-high';
                if (product.stock <= 5) stockClass = 'stock-low';
                else if (product.stock <= 15) stockClass = 'stock-medium';

                row.innerHTML = `
                <td>
                    <img src="${product.image}" alt="${product.name}" 
                         style="width: 60px; height: 60px; object-fit: cover;">
                </td>
                <td style="text-align: left; font-weight: 600;">${product.name}</td>
                <td>${{
                        'Learning Supplies': '📚 อุปกรณ์การเรียน',
                        'Student Uniform': '👔 เครื่องแบบนักศึกษา',
                        'Activity': '🎽 เสื้อกิจกรรม',
                        'Souvenirs': '🎁 ของที่ระลึก'
                    }[product.category] || product.category}</td>
                <td style="font-weight: 600; color: #2a5298;">${product.price.toLocaleString()} บาท</td>
                <td><span class="${stockClass}">${product.stock}</span></td>
                <td>
                    <button class="btn btn-info btn-small" onclick="editProduct(${product.id})" style="margin: 2px;">
                        <i class="fas fa-edit"></i> แก้ไข
                    </button>
                    <button class="btn btn-danger btn-small" onclick="deleteProduct(${product.id})" style="margin: 2px;">
                        <i class="fas fa-trash"></i> ลบ
                    </button>
                </td>
            `;
                tbody.appendChild(row);
            });
        }

        function displayUserTable(filterType = 'all') {
            const tbody = document.getElementById('user-management-table');
            if (!tbody) return;

            // อัปเดตสถิติ
            const studentCount = Object.keys(users.students).length;
            const adminCount = Object.keys(users.admins).length;
            const studentCountEl = document.getElementById('student-count');
            const adminCountEl = document.getElementById('admin-count');
            const totalUsersEl = document.getElementById('total-users');

            if (studentCountEl) studentCountEl.textContent = studentCount;
            if (adminCountEl) adminCountEl.textContent = adminCount;
            if (totalUsersEl) totalUsersEl.textContent = studentCount + adminCount;

            tbody.innerHTML = '';

            // รวมข้อมูลผู้ใช้ตามการกรอง
            let allUsers = [];

            // กรองเฉพาะนักศึกษา
            if (filterType === 'students') {
                Object.values(users.students).forEach(user => {
                    allUsers.push({
                        ...user,
                        type: 'student',
                        typeName: 'นักศึกษา',
                        typeIcon: 'fas fa-user-graduate',
                        typeColor: '#2a5298'
                    });
                });
            }
            // กรองเฉพาะเจ้าหน้าที่
            else if (filterType === 'admins') {
                Object.values(users.admins).forEach(user => {
                    allUsers.push({
                        ...user,
                        type: 'admin',
                        typeName: 'เจ้าหน้าที่',
                        typeIcon: 'fas fa-user-tie',
                        typeColor: '#dc3545'
                    });
                });
            }
            // แสดงทั้งหมด
            else {
                Object.values(users.students).forEach(user => {
                    allUsers.push({
                        ...user,
                        type: 'student',
                        typeName: 'นักศึกษา',
                        typeIcon: 'fas fa-user-graduate',
                        typeColor: '#2a5298'
                    });
                });

                Object.values(users.admins).forEach(user => {
                    allUsers.push({
                        ...user,
                        type: 'admin',
                        typeName: 'เจ้าหน้าที่',
                        typeIcon: 'fas fa-user-tie',
                        typeColor: '#dc3545'
                    });
                });
            }

            if (allUsers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #666; padding: 30px;">ไม่มีข้อมูลผู้ใช้</td></tr>';
                return;
            }

            allUsers.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
            <td>
                <i class="${user.typeIcon}" style="color: ${user.typeColor}; margin-right: 8px;"></i>
                ${user.typeName}
            </td>
            <td style="font-weight: 600; color: #2a5298;">${user.id}</td>
            <td>${user.firstname} ${user.lastname}</td>
            <td>${user.email}</td>
            <td>${user.phone}</td>
            <td>
                ${user.type === 'student' ?
                        `${user.faculty === 'engineering' ? 'คณะวิศวกรรมศาสตร์' :
                            user.faculty === 'business' ? 'คณะบริหารธุรกิจและเทคโนโลยีสารสนเทศ' :
                                user.faculty === 'education' ? 'คณะครุศาสตร์อุตสาหกรรม' : user.faculty}<br>
                 <small style="color: #666;">${user.major} ปี ${user.year}</small>` :
                        `<span style="color: #666;">${user.department}</span>`
                    }
            </td>
            <td>
                <button class="btn btn-info btn-small" onclick="showUserDetails('${user.type}', '${user.id}')" style="margin-right: 5px;">
                    <i class="fas fa-eye"></i> ดู
                </button>
            </td>
        `;
                tbody.appendChild(row);
            });
        }

        // แสดงจัดการคำสั่งซื้อ (Admin)
        // แสดงจัดการผู้ใช้ (Admin)
        function showUserManagement() {
            // ปิด modal อื่นๆ ทั้งหมดก่อน
            document.getElementById('product-management-modal').style.display = 'none';
            document.getElementById('order-management-modal').style.display = 'none';
            document.getElementById('payment-management-modal').style.display = 'none';
            document.getElementById('inventory-management-modal').style.display = 'none';
            document.getElementById('reports-modal').style.display = 'none';

            showUserTab('all'); // เริ่มต้นแสดงทั้งหมด
            document.getElementById('user-management-modal').style.display = 'block';
        }

        // แสดงจัดการคำสั่งซื้อ (Admin)
        function showOrderManagement() {
            // ปิด modal อื่นๆ ทั้งหมดก่อน
            document.getElementById('product-management-modal').style.display = 'none';
            document.getElementById('payment-management-modal').style.display = 'none';
            document.getElementById('user-management-modal').style.display = 'none';
            document.getElementById('inventory-management-modal').style.display = 'none';
            document.getElementById('reports-modal').style.display = 'none';

            displayOrdersTable(orders);
            document.getElementById('order-management-modal').style.display = 'block';
        }

        function closeOrderManagement() {
            document.getElementById('order-management-modal').style.display = 'none';
        }

        function closeUserManagement() {
            document.getElementById('user-management-modal').style.display = 'none';
        }

        function showUserTab(tabType) {
            // ซ่อน/แสดงปุ่มจัดการ
            document.getElementById('management-buttons-all').style.display = tabType === 'all' ? 'inline-flex' : 'none';
            document.getElementById('management-buttons-students').style.display = tabType === 'students' ? 'inline-flex' : 'none';
            document.getElementById('management-buttons-admins').style.display = tabType === 'admins' ? 'inline-flex' : 'none';

            // อัพเดท tab active
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`tab-${tabType}`).classList.add('active');

            // กรองและแสดงข้อมูล
            let filteredUsers = [];

            if (tabType === 'students') {
                Object.values(users.students).forEach(user => {
                    filteredUsers.push({
                        ...user,
                        type: 'student',
                        typeName: 'นักศึกษา',
                        typeIcon: 'fas fa-user-graduate',
                        typeColor: '#2a5298'
                    });
                });
            } else if (tabType === 'admins') {
                Object.values(users.admins).forEach(user => {
                    filteredUsers.push({
                        ...user,
                        type: 'admin',
                        typeName: 'เจ้าหน้าที่',
                        typeIcon: 'fas fa-user-tie',
                        typeColor: '#dc3545'
                    });
                });
            } else {
                // ทั้งหมด
                Object.values(users.students).forEach(user => {
                    filteredUsers.push({
                        ...user,
                        type: 'student',
                        typeName: 'นักศึกษา',
                        typeIcon: 'fas fa-user-graduate',
                        typeColor: '#2a5298'
                    });
                });

                Object.values(users.admins).forEach(user => {
                    filteredUsers.push({
                        ...user,
                        type: 'admin',
                        typeName: 'เจ้าหน้าที่',
                        typeIcon: 'fas fa-user-tie',
                        typeColor: '#dc3545'
                    });
                });
            }

            displayUserTable(filteredUsers);
        }

        function displayOrdersTable(ordersToShow) {
            const tbody = document.getElementById('order-management-table');
            if (!tbody) return;

            tbody.innerHTML = '';

            if (ordersToShow.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #666; padding: 30px;">ไม่พบคำสั่งซื้อที่ตรงกับเงื่อนไข</td></tr>';
                return;
            }

            ordersToShow.reverse().forEach(order => {
                const student = getStudentInfo(order.studentId);

                // กำหนดระดับการศึกษา
                let educationLevel = 'ไม่ระบุ';
                if (student) {
                    switch (student.year) {
                        case '1':
                        case '2':
                            educationLevel = 'ปวช.';
                            break;
                        case '3':
                            educationLevel = 'ปวส.';
                            break;
                        case '4':
                            educationLevel = 'ปริญญาตรี';
                            break;
                        default:
                            educationLevel = `ปี ${student.year}`;
                    }
                }

                // สถานะตามหมวดหมู่
                let orderStatusCategory = '';
                let statusBadgeColor = '';

                if (['pending-approval', 'preparing', 'ready', 'completed'].includes(order.status)) {
                    orderStatusCategory = 'การชำระเงินสำเร็จ';
                    statusBadgeColor = '#28a745';
                } else if (['preparing', 'ready'].includes(order.status)) {
                    orderStatusCategory = 'ค้างจ่ายสินค้า';
                    statusBadgeColor = '#ffc107';
                } else if (['pending-payment', 'pending-verification', 'pending-confirmation'].includes(order.status)) {
                    orderStatusCategory = 'รอการชำระ';
                    statusBadgeColor = '#dc3545';
                } else if (order.status === 'completed') {
                    orderStatusCategory = 'รับสินค้าแล้ว';
                    statusBadgeColor = '#17a2b8';
                }

                // สร้างรายการสินค้าพร้อมไอคอนรถเข็น
                const itemsCount = order.items.length;
                const totalQuantity = order.items.reduce((sum, item) => sum + item.quantity, 0);

                // สถานะการชำระเงิน
                let paymentStatus = '';
                if (order.paymentData) {
                    if (order.paymentData.status === 'approved') {
                        paymentStatus = `
                    <div style="color: #28a745; font-weight: 600; margin-bottom: 5px;">
                        <i class="fas fa-check-circle"></i> ชำระแล้ว
                    </div>
                `;
                    } else if (order.paymentData.status === 'rejected') {
                        paymentStatus = `
                    <div style="color: #dc3545; font-weight: 600; margin-bottom: 5px;">
                        <i class="fas fa-times-circle"></i> ปฏิเสธ
                    </div>
                `;
                    } else {
                        paymentStatus = `
                    <div style="color: #ffc107; font-weight: 600; margin-bottom: 5px;">
                        <i class="fas fa-clock"></i> รอตรวจสอบ
                    </div>
                `;
                    }

                    if (order.paymentData.slipData) {
                        paymentStatus += `
                    <button class="btn btn-info btn-small" onclick="viewPaymentSlip('${order.id}')" style="padding: 4px 8px; font-size: 11px;">
                        <i class="fas fa-receipt"></i> ดูสลิป
                    </button>
                `;
                    }
                } else {
                    paymentStatus = '<span style="color: #6c757d;"><i class="fas fa-minus"></i> ยังไม่ชำระ</span>';
                }

                const row = document.createElement('tr');
                row.innerHTML = `
            <td style="font-weight: 600; color: #2a5298;">${order.id}</td>
            <td style="font-weight: 500;">${order.studentId}</td>
            <td>${order.studentName}</td>
            <td>
                <span style="background: linear-gradient(45deg, #2a5298, #1e3c72); color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                    ${educationLevel}
                </span>
            </td>
            <td style="text-align: center;">
                <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <button class="btn btn-info btn-small" onclick="viewOrderItems('${order.id}')" 
                            title="ดูรายการสินค้า" style="padding: 6px 8px;">
                        <i class="fas fa-shopping-cart"></i>
                    </button>
                    <div style="font-size: 12px; color: #666;">
                        ${itemsCount} รายการ<br>
                        ${totalQuantity} ชิ้น
                    </div>
                </div>
            </td>
            <td style="text-align: right; font-weight: 600; color: #28a745;">${order.total.toLocaleString()} บาท</td>
            <td style="text-align: center;">
                <div style="margin-bottom: 8px;">
                    <span style="background: ${statusBadgeColor}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600;">
                        ${orderStatusCategory}
                    </span>
                </div>
                <div style="font-size: 11px; color: #666;">
                    ${orderStatuses[order.status].name}
                </div>
            </td>
            <td style="text-align: center; min-width: 120px;">
                ${paymentStatus}
            </td>
            <td>
                <div style="display: flex; gap: 4px; flex-wrap: wrap; justify-content: center;">
                    <button class="btn btn-info btn-small" onclick="showOrderDetails('${order.id}')" 
                            title="ดูรายละเอียด" style="padding: 4px 6px;">
                        <i class="fas fa-eye"></i>
                    </button>
                    ${getOrderActionButtons(order)}
                </div>
            </td>
        `;
                tbody.appendChild(row);
            });
        }

        function getOrderActionButtons(order) {
            let actionButtons = '';

            // ปุ่มการจัดการตามสถานะ
            switch (order.status) {
                case 'pending-confirmation':
                    actionButtons += `
                <button class="btn btn-success btn-small" onclick="updateOrderStatus('${order.id}', 'pending-approval', 'เจ้าหน้าที่ยืนยันการชำระเงินแล้ว')" 
                        title="ยืนยันการชำระ" style="padding: 4px 6px;">
                    <i class="fas fa-check"></i>
                </button>
            `;
                    break;
                case 'pending-approval':
                    actionButtons += `
                <button class="btn btn-success btn-small" onclick="updateOrderStatus('${order.id}', 'preparing', 'เจ้าหน้าที่อนุมัติคำสั่งซื้อแล้ว กำลังเตรียมสินค้า')" 
                        title="อนุมัติ" style="padding: 4px 6px;">
                    <i class="fas fa-thumbs-up"></i>
                </button>
            `;
                    break;
                case 'preparing':
                    actionButtons += `
                <button class="btn btn-warning btn-small" onclick="updateOrderStatus('${order.id}', 'ready', 'สินค้าเตรียมเรียบร้อยแล้ว พร้อมสำหรับการรับ')" 
                        title="เตรียมสินค้าเสร็จ" style="padding: 4px 6px;">
                    <i class="fas fa-box"></i>
                </button>
            `;
                    break;
            }

            // ปุ่มแก้ไขและลบ (สำหรับคำสั่งซื้อที่ยังไม่เสร็จสิ้น)
            if (!['completed', 'cancelled'].includes(order.status)) {
                actionButtons += `
            <button class="btn btn-warning btn-small" onclick="editOrderDetails('${order.id}')" 
                    title="แก้ไข" style="padding: 4px 6px;">
                <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-danger btn-small" onclick="deleteOrder('${order.id}')" 
                    title="ยกเลิก/ลบ" style="padding: 4px 6px;">
                <i class="fas fa-trash"></i>
            </button>
        `;
            }

            return actionButtons;
        }

        function viewOrderItems(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) {
                showNotification('❌ ไม่พบคำสั่งซื้อ', 'error');
                return;
            }

            let itemsHTML = `
        <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 600px; margin: 20px auto;">
            <h3 style="color: #2a5298; margin-bottom: 20px; text-align: center;">
                <i class="fas fa-shopping-cart"></i> รายการสินค้า
            </h3>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center;">
                <strong>รหัสคำสั่งซื้อ:</strong> ${order.id}<br>
                <strong>ลูกค้า:</strong> ${order.studentName}<br>
                <strong>วันที่สั่ง:</strong> ${order.date}
            </div>
            
            <div style="max-height: 300px; overflow-y: auto;">
    `;

            order.items.forEach((item, index) => {
                itemsHTML += `
            <div style="display: flex; align-items: center; padding: 12px; margin-bottom: 10px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #2a5298;">
                <div style="width: 50px; height: 50px; background: #e9ecef; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                    <i class="fas fa-cube" style="color: #666; font-size: 20px;"></i>
                </div>
                <div style="flex: 1;">
                    <div style="font-weight: 600; color: #333; margin-bottom: 5px;">${item.name}</div>
                    <div style="color: #666; font-size: 14px;">
                        ราคา: ${item.price.toLocaleString()} บาท × ${item.quantity} ชิ้น
                    </div>
                </div>
                <div style="text-align: right; font-weight: 600; color: #28a745;">
                    ${(item.price * item.quantity).toLocaleString()} บาท
                </div>
            </div>
        `;
            });

            itemsHTML += `
            </div>
            
            <div style="border-top: 2px solid #dee2e6; padding-top: 15px; margin-top: 20px; text-align: right;">
                <div style="font-size: 18px; font-weight: 700; color: #2a5298;">
                    รวมทั้งหมด: ${order.total.toLocaleString()} บาท
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="this.parentElement.parentElement.parentElement.remove()">
                    <i class="fas fa-times"></i> ปิด
                </button>
            </div>
        </div>
    `;

            // สร้าง overlay
            const overlay = document.createElement('div');
            overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.6);
        backdrop-filter: blur(5px);
        z-index: 1001;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        overflow-y: auto;
    `;
            overlay.innerHTML = itemsHTML;
            document.body.appendChild(overlay);

            // ปิดเมื่อคลิกข้างนอก
            overlay.addEventListener('click', function (e) {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            });
        }

        function editOrderDetails(orderId) {
            showNotification('🚧 ฟีเจอร์แก้ไขรายละเอียดคำสั่งซื้อ กำลังพัฒนา', 'info');
            // TODO: สร้างฟอร์มแก้ไขคำสั่งซื้อ
        }

        function deleteOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;

            if (confirm(`🗑️ ต้องการยกเลิก/ลบคำสั่งซื้อ ${orderId} หรือไม่?\n\n👤 ลูกค้า: ${order.studentName}\n💰 ยอดรวม: ${order.total.toLocaleString()} บาท\n📅 วันที่สั่ง: ${order.date}\n\n⚠️ การดำเนินการนี้จะ:\n• ยกเลิกคำสั่งซื้อ\n• คืนสต็อกสินค้า\n• ไม่สามารถยกเลิกได้`)) {

                // คืนสต็อกสินค้า
                order.items.forEach(item => {
                    const product = products.find(p => p.id === item.id);
                    if (product) {
                        product.stock += item.quantity;
                    }
                });

                // อัพเดทสถานะเป็นยกเลิก
                updateOrderStatus(orderId, 'cancelled', 'เจ้าหน้าที่ยกเลิกคำสั่งซื้อ - คืนสต็อกแล้ว');

                // รีเฟรชหน้าจอ
                filterOrders();
                updateAdminStats();
                loadProducts();

                showNotification(`✅ ยกเลิกคำสั่งซื้อ ${orderId} เรียบร้อยแล้ว!\n\n📦 คืนสต็อกสินค้าแล้ว\n📊 อัพเดทสถิติแล้ว`, 'success');
            }
        }

        function filterOrders() {
            const statusFilter = document.getElementById('order-status-filter')?.value || '';
            const nameFilter = document.getElementById('order-search-name')?.value.toLowerCase() || '';
            const idFilter = document.getElementById('order-search-id')?.value.toLowerCase() || '';

            let filteredOrders = orders.filter(order => order.status !== 'cancelled');

            // กรองตามสถานะ
            if (statusFilter) {
                filteredOrders = filteredOrders.filter(order => order.status === statusFilter);
            }

            // กรองตามชื่อ-สกุล
            if (nameFilter) {
                filteredOrders = filteredOrders.filter(order =>
                    order.studentName.toLowerCase().includes(nameFilter)
                );
            }

            // กรองตามรหัสคำสั่งซื้อ
            if (idFilter) {
                filteredOrders = filteredOrders.filter(order =>
                    order.id.toLowerCase().includes(idFilter)
                );
            }

            displayOrdersTable(filteredOrders);
        }

        function displayOrdersTable(ordersToShow) {
            const tbody = document.getElementById('order-management-table');
            if (!tbody) return;

            tbody.innerHTML = '';

            if (ordersToShow.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #666; padding: 30px;">ไม่พบคำสั่งซื้อที่ตรงกับเงื่อนไข</td></tr>';
                return;
            }

            ordersToShow.reverse().forEach(order => {
                const status = orderStatuses[order.status];
                const student = getStudentInfo(order.studentId);
                const studentLevel = student ? `${student.faculty} ปี ${student.year}` : 'ไม่พบข้อมูล';

                // สร้างรายการสินค้า
                const itemsList = order.items?.map(item =>
                    `${item.name} × ${item.quantity}`
                )?.join('<br>') || 'ไม่มีสินค้า';

                // สถานะการชำระเงิน
                let paymentStatus = '';
                if (order.paymentData) {
                    if (order.paymentData.status === 'approved') {
                        paymentStatus = '<span style="color: #28a745; font-weight: 600;"><i class="fas fa-check-circle"></i> ชำระแล้ว</span>';
                    } else if (order.paymentData.status === 'rejected') {
                        paymentStatus = '<span style="color: #dc3545; font-weight: 600;"><i class="fas fa-times-circle"></i> ปฏิเสธ</span>';
                    } else {
                        paymentStatus = '<span style="color: #ffc107; font-weight: 600;"><i class="fas fa-clock"></i> รอตรวจสอบ</span>';
                    }
                } else {
                    paymentStatus = '<span style="color: #6c757d;"><i class="fas fa-minus"></i> ยังไม่ชำระ</span>';
                }

                const row = document.createElement('tr');
                row.innerHTML = `
            <td style="font-weight: 600; color: #2a5298;">${order.id}</td>
            <td>${order.studentId}</td>
            <td>${order.studentName}</td>
            <td>${student ? (student.year === '4' ? 'ปริญญาตรี' : student.year === '3' ? 'ปวส.' : 'ปวช.') : 'ไม่ระบุ'}</td>
            <td>
                <button class="btn btn-info btn-small" onclick="viewOrderItems('${order.id}')" title="ดูรายการสินค้า">
                    <i class="fas fa-shopping-cart"></i>
                </button>
            </td>
            <td style="text-align: right; font-weight: 600; color: #28a745;">${(order.total || 0).toLocaleString()} บาท</td>
            <td>
                ${['pending-approval', 'preparing', 'ready', 'completed'].includes(order.status) ? 'การชำระเงินสำเร็จ' :
                        ['preparing', 'ready'].includes(order.status) ? 'ค้างจ่ายสินค้า' :
                            ['pending-payment', 'pending-verification', 'pending-confirmation'].includes(order.status) ? 'รอการชำระ' :
                                order.status === 'completed' ? 'รับสินค้าแล้ว' : 'อื่นๆ'}
            </td>
            <td style="text-align: center;">
                <button class="btn btn-info btn-small" onclick="viewPaymentSlip('${order.id}')" title="ดูสลิป">
                    <i class="fas fa-receipt"></i>
                </button>
            </td>
            <td>
                <button class="btn btn-warning btn-small" onclick="editOrder('${order.id}')" title="แก้ไข">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-danger btn-small" onclick="deleteOrder('${order.id}')" title="ลบ" style="margin-left: 5px;">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        `;
                tbody.appendChild(row);
            });
        }

        function updateOrderStats() {
            const successPayment = orders.filter(o => ['pending-approval', 'preparing', 'ready', 'completed'].includes(o.status)).length;
            const pendingDelivery = orders.filter(o => ['preparing', 'ready'].includes(o.status)).length;
            const pendingPayment = orders.filter(o => ['pending-payment', 'pending-verification', 'pending-confirmation'].includes(o.status)).length;
            const completed = orders.filter(o => o.status === 'completed').length;

            document.getElementById('success-payment-count').textContent = successPayment;
            document.getElementById('pending-delivery-count').textContent = pendingDelivery;
            document.getElementById('pending-payment-count').textContent = pendingPayment;
            document.getElementById('completed-count').textContent = completed;
        }

        function resetOrderFilters() {
            document.getElementById('order-status-filter').value = '';
            document.getElementById('order-search-name').value = '';
            document.getElementById('order-search-id').value = '';
            filterOrders();
            showNotification('🔄 รีเซ็ตตัวกรองเรียบร้อยแล้ว', 'info');
        }



        function getStudentInfo(studentId) {
            return users.students[studentId] || null;
        }

        function getOrderManagementActions(order) {
            let actions = `
        <button class="btn btn-info btn-small" onclick="showOrderDetails('${order.id}')" title="ดูรายละเอียด">
            <i class="fas fa-eye"></i>
        </button>
    `;

            switch (order.status) {
                case 'pending-confirmation':
                    actions += `
                <button class="btn btn-success btn-small" onclick="updateOrderStatus('${order.id}', 'pending-approval', 'เจ้าหน้าที่ยืนยันการชำระเงินแล้ว')" title="ยืนยันการชำระ">
                    <i class="fas fa-check"></i>
                </button>
            `;
                    break;
                case 'pending-approval':
                    actions += `
                <button class="btn btn-success btn-small" onclick="updateOrderStatus('${order.id}', 'preparing', 'เจ้าหน้าที่อนุมัติคำสั่งซื้อแล้ว กำลังเตรียมสินค้า')" title="อนุมัติ">
                    <i class="fas fa-thumbs-up"></i>
                </button>
            `;
                    break;
                case 'preparing':
                    actions += `
                <button class="btn btn-warning btn-small" onclick="updateOrderStatus('${order.id}', 'ready', 'สินค้าเตรียมเรียบร้อยแล้ว พร้อมสำหรับการรับ')" title="เตรียมสินค้าเสร็จ">
                    <i class="fas fa-box"></i>
                </button>
            `;
                    break;
            }

            // ปุ่มแก้ไขและลบ
            if (!['completed', 'cancelled'].includes(order.status)) {
                actions += `
            <button class="btn btn-warning btn-small" onclick="editOrder('${order.id}')" title="แก้ไข">
                <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-danger btn-small" onclick="cancelOrder('${order.id}')" title="ยกเลิก">
                <i class="fas fa-trash"></i>
            </button>
        `;
            }

            return actions;
        }

        function resetOrderFilters() {
            document.getElementById('order-status-filter').value = '';
            document.getElementById('order-search-name').value = '';
            document.getElementById('order-search-id').value = '';
            filterOrders();
            showNotification('🔄 รีเซ็ตตัวกรองเรียบร้อยแล้ว', 'info');
        }

        function viewPaymentSlip(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order || !order.paymentData || !order.paymentData.slipData) {
                showNotification('❌ ไม่พบข้อมูลสลิปการโอนเงิน', 'error');
                return;
            }

            const slipWindow = window.open('', '_blank', 'width=600,height=800,scrollbars=yes');
            slipWindow.document.write(`
        <html>
            <head>
                <title>สลิปการโอนเงิน - ${orderId}</title>
                <style>
                    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
                    img { max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 8px; }
                    .info { background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0; text-align: left; }
                </style>
            </head>
            <body>
                <h2>สลิปการโอนเงิน</h2>
                <div class="info">
                    <strong>รหัสคำสั่งซื้อ:</strong> ${order.id}<br>
                    <strong>ลูกค้า:</strong> ${order.studentName}<br>
                    <strong>ยอดโอน:</strong> ${order.paymentData.amount.toLocaleString()} บาท<br>
                    <strong>วันที่โอน:</strong> ${order.paymentData.date} ${order.paymentData.time}<br>
                    <strong>ช่องทาง:</strong> ${order.paymentData.channel}
                </div>
                <img src="${order.paymentData.slipData}" alt="สลิปการโอนเงิน">
                <br><br>
                <button onclick="window.close()" style="padding: 10px 20px; background: #2a5298; color: white; border: none; border-radius: 5px; cursor: pointer;">ปิด</button>
            </body>
        </html>
    `);
        }

        function editOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) {
                showNotification('ไม่พบคำสั่งซื้อ', 'error');
                return;
            }

            // ตรวจสอบสถานะที่สามารถแก้ไขได้
            const editableStatuses = ['pending-payment', 'pending-confirmation', 'pending-approval'];
            if (!editableStatuses.includes(order.status)) {
                showNotification('ไม่สามารถแก้ไขได้ในสถานะนี้', 'error');
                return;
            }

            // ปิด modal อื่นๆ
            document.getElementById('order-management-modal').style.display = 'none';

            const modalContent = document.getElementById('modal-product-content');
            modalContent.innerHTML = `
        <h2><i class="fas fa-edit"></i> แก้ไขคำสั่งซื้อ ${order.id}</h2>
    
        <!-- ข้อมูลลูกค้า -->
        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
            <h3 style="color: #2a5298; margin-bottom: 15px;">
                <i class="fas fa-user"></i> ข้อมูลลูกค้า
            </h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div><strong>รหัสนักศึกษา:</strong> ${order.studentId}</div>
                <div><strong>ชื่อ-สกุล:</strong> ${order.studentName}</div>
                <div><strong>วันที่สั่ง:</strong> ${order.date}</div>
                <div><strong>สถานะ:</strong> <span class="status-badge status-${order.status.replace('-', '-')}">${orderStatuses[order.status].name}</span></div>
            </div>
        </div>
        <!-- รายการสินค้า -->
    <div style="background: #fff; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #dee2e6;">
        <h3 style="color: #2a5298; margin-bottom: 15px;">
            <i class="fas fa-shopping-cart"></i> รายการสินค้า
        </h3>
        <div id="edit-order-items">
            ${order.items.map((item, index) => `
                <div class="order-item" data-index="${index}" style="border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin-bottom: 10px; background: #f8f9fa;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <img src="${item.image}" alt="${item.name}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px;">
                        <div style="flex: 1;">
                            <div style="font-weight: 600; margin-bottom: 5px;">${item.name}</div>
                            <div style="color: #666; font-size: 14px;">ราคา: ${item.price.toLocaleString()} บาท</div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <button class="btn btn-secondary" onclick="changeOrderItemQuantity(${index}, -1)" style="padding: 5px 10px; font-size: 14px;">
                                <i class="fas fa-minus"></i>
                            </button>
                            <span id="item-quantity-${index}" style="min-width: 30px; text-align: center; font-weight: 600;">${item.quantity}</span>
                            <button class="btn btn-secondary" onclick="changeOrderItemQuantity(${index}, 1)" style="padding: 5px 10px; font-size: 14px;">
                                <i class="fas fa-plus"></i>
                            </button>
                            <button class="btn btn-danger" onclick="removeOrderItem(${index})" style="padding: 5px 10px; margin-left: 10px;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div style="text-align: right; margin-top: 10px;">
                        <strong id="item-total-${index}" style="color: #28a745;">รวม: ${(item.price * item.quantity).toLocaleString()} บาท</strong>
                    </div>
                </div>
            `).join('')}
        </div>
    </div>
    <!-- สรุปยอดรวม -->
        <div style="background: linear-gradient(135deg, #d4edda 0%, #ffffff 100%); padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 2px solid #28a745;">
            <h3 style="color: #28a745; text-align: center; margin-bottom: 15px;">
                <i class="fas fa-calculator"></i> ยอดรวมทั้งหมด
            </h3>
            <div id="order-total-display" style="text-align: center; font-size: 28px; font-weight: 700; color: #28a745;">
                ${order.total.toLocaleString()} บาท
            </div>
        </div>

        <div class="button-group">
            <button class="btn btn-success" onclick="saveOrderChanges('${order.id}')">
                <i class="fas fa-save"></i> บันทึกการแก้ไข
            </button>
            <button class="btn btn-secondary" onclick="showOrderManagement()">
                <i class="fas fa-arrow-left"></i> ยกเลิก
            </button>
        </div>
    `;

            document.getElementById('product-modal').style.display = 'block';
        }
        // ตัวแปรสำหรับเก็บข้อมูลการแก้ไข
        let editingOrder = null;

        function changeOrderItemQuantity(itemIndex, change) {
            const order = editingOrder || orders.find(o => document.getElementById('modal-product-content').innerHTML.includes(o.id));
            if (!order) return;

            editingOrder = JSON.parse(JSON.stringify(order)); // Deep copy

            const item = editingOrder.items[itemIndex];
            const product = products.find(p => p.id === item.id);

            if (change > 0 && item.quantity >= product.stock) {
                showNotification('สินค้าเหลือในสต็อกไม่เพียงพอ', 'error');
                return;
            }

            item.quantity += change;
            if (item.quantity <= 0) {
                editingOrder.items.splice(itemIndex, 1);
                editOrder(editingOrder.id);
                return;
            }

            updateOrderDisplay();
        }

        function updateOrderDisplay() {
            if (!editingOrder) return;

            editingOrder.items.forEach((item, index) => {
                const quantityElement = document.getElementById(`item-quantity-${index}`);
                const totalElement = document.getElementById(`item-total-${index}`);

                if (quantityElement) quantityElement.textContent = item.quantity;
                if (totalElement) totalElement.innerHTML = `รวม: ${(item.price * item.quantity).toLocaleString()} บาท`;
            });

            const newTotal = editingOrder.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const totalDisplay = document.getElementById('order-total-display');
            if (totalDisplay) {
                totalDisplay.textContent = `${newTotal.toLocaleString()} บาท`;
            }
        }
        function removeOrderItem(itemIndex) {
            const order = editingOrder || orders.find(o => document.getElementById('modal-product-content').innerHTML.includes(o.id));
            if (!order) return;

            editingOrder = JSON.parse(JSON.stringify(order));

            if (editingOrder.items.length <= 1) {
                showNotification('ไม่สามารถลบได้ คำสั่งซื้อต้องมีสินค้าอย่างน้อย 1 รายการ', 'error');
                return;
            }

            const itemName = editingOrder.items[itemIndex].name;
            if (confirm('ต้องการลบ "' + itemName + '" ออกจากคำสั่งซื้อหรือไม่?')) {
                editingOrder.items.splice(itemIndex, 1);
                editOrder(editingOrder.id);
                showNotification('ลบ "' + itemName + '" ออกจากคำสั่งซื้อแล้ว', 'info');
            }
        }

        function saveOrderChanges(orderId) {
            if (!editingOrder) {
                showNotification('ไม่มีการเปลี่ยนแปลงที่จะบันทึก', 'error');
                return;
            }

            if (editingOrder.items.length === 0) {
                showNotification('คำสั่งซื้อต้องมีสินค้าอย่างน้อย 1 รายการ', 'error');
                return;
            }

            const newTotal = editingOrder.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const originalOrder = orders.find(o => o.id === orderId);
            const oldTotal = originalOrder.total;

            if (confirm('บันทึกการแก้ไขคำสั่งซื้อ ' + orderId + '?\n\nยอดเดิม: ' + oldTotal.toLocaleString() + ' บาท\nยอดใหม่: ' + newTotal.toLocaleString() + ' บาท')) {

                // อัพเดทคำสั่งซื้อ
                originalOrder.items = [...editingOrder.items];
                originalOrder.total = newTotal;

                // เพิ่มประวัติการแก้ไข
                originalOrder.tracking.push({
                    status: originalOrder.status,
                    timestamp: getCurrentDateTime(),
                    description: 'เจ้าหน้าที่แก้ไขคำสั่งซื้อ (เปลี่ยนจาก ' + oldTotal.toLocaleString() + ' เป็น ' + newTotal.toLocaleString() + ' บาท)'
                });

                // รีเซ็ตตัวแปร
                editingOrder = null;

                // ปิด modal และรีเฟรช
                closeModal();
                showOrderManagement();

                showNotification('บันทึกการแก้ไขคำสั่งซื้อ ' + orderId + ' เรียบร้อยแล้ว!', 'success');
            }
        }

        function cancelOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;

            if (confirm(`❌ ต้องการยกเลิกคำสั่งซื้อ ${orderId} หรือไม่?\n\nลูกค้า: ${order.studentName}\nยอดรวม: ${order.total.toLocaleString()} บาท\n\n⚠️ การดำเนินการนี้ไม่สามารถยกเลิกได้`)) {
                // คืนสต็อกสินค้า
                order.items.forEach(item => {
                    const product = products.find(p => p.id === item.id);
                    if (product) {
                        product.stock += item.quantity;
                    }
                });

                updateOrderStatus(orderId, 'cancelled', 'เจ้าหน้าที่ยกเลิกคำสั่งซื้อ');
                filterOrders(); // รีเฟรชตาราง
                updateAdminStats(); // อัพเดทสถิติ
                showNotification(`🗑️ ยกเลิกคำสั่งซื้อ ${orderId} เรียบร้อยแล้ว`, 'success');
            }
        }

        function exportOrdersToExcel() {
            const statusFilter = document.getElementById('order-status-filter')?.value || '';
            const nameFilter = document.getElementById('order-search-name')?.value.toLowerCase() || '';
            const idFilter = document.getElementById('order-search-id')?.value.toLowerCase() || '';

            let filteredOrders = orders.filter(order => order.status !== 'cancelled');

            // ใช้ตัวกรองเดียวกับตาราง
            if (statusFilter) {
                filteredOrders = filteredOrders.filter(order => order.status === statusFilter);
            }
            if (nameFilter) {
                filteredOrders = filteredOrders.filter(order =>
                    order.studentName.toLowerCase().includes(nameFilter)
                );
            }
            if (idFilter) {
                filteredOrders = filteredOrders.filter(order =>
                    order.id.toLowerCase().includes(idFilter)
                );
            }

            if (filteredOrders.length === 0) {
                showNotification('❌ ไม่มีข้อมูลที่จะ Export', 'error');
                return;
            }

            // สร้างข้อมูล CSV
            let csvContent = '\uFEFF'; // BOM for UTF-8
            csvContent += 'รหัสคำสั่งซื้อ,รหัสนักศึกษา,ชื่อ-สกุล,ระดับ,รายการสินค้า,ราคารวม,สถานะ,วันที่สั่ง\n';

            filteredOrders.reverse().forEach(order => {
                const student = getStudentInfo(order.studentId);
                const studentLevel = student ? `${student.faculty} ปี ${student.year}` : 'ไม่พบข้อมูล';
                const itemsList = order.items.map(item => `${item.name} × ${item.quantity}`).join('; ');
                const status = orderStatuses[order.status];

                csvContent += `${order.id},${order.studentId},"${order.studentName}","${studentLevel}","${itemsList}",${order.total},"${status.name}","${order.date}"\n`;
            });

            // ดาวน์โหลดไฟล์
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `คำสั่งซื้อ_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();

            showNotification(`📊 Export ข้อมูล ${filteredOrders.length} รายการเรียบร้อยแล้ว!`, 'success');
        }

        function showUserDetails(userType, userId) {
            const userGroup = userType === 'student' ? 'students' : 'admins';
            const user = users[userGroup][userId];

            if (!user) {
                showNotification('❌ ไม่พบข้อมูลผู้ใช้', 'error');
                return;
            }

            const modalContent = document.getElementById('modal-product-content');
            modalContent.innerHTML = `
                <h2><i class="${userType === 'student' ? 'fas fa-user-graduate' : 'fas fa-user-tie'}"></i> ข้อมูล${userType === 'student' ? 'นักศึกษา' : 'เจ้าหน้าที่'}</h2>
                
                <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 25px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div>
                            <strong><i class="fas fa-id-card"></i> รหัส${userType === 'student' ? 'นักศึกษา' : 'เจ้าหน้าที่'}:</strong><br>
                            <span style="font-size: 18px; color: #2a5298; font-weight: 600;">${user.id}</span>
                        </div>
                        <div>
                            <strong><i class="fas fa-user"></i> ชื่อ-นามสกุล:</strong><br>
                            <span style="font-size: 18px;">${user.firstname} ${user.lastname}</span>
                        </div>
                        <div>
                            <strong><i class="fas fa-envelope"></i> อีเมล:</strong><br>
                            <span style="font-size: 16px; color: #666;">${user.email}</span>
                        </div>
                        <div>
                            <strong><i class="fas fa-phone"></i> เบอร์โทรศัพท์:</strong><br>
                            <span style="font-size: 16px; color: #666;">${user.phone}</span>
                        </div>
                        ${userType === 'student' ? `
                        <div>
                            <strong><i class="fas fa-university"></i> คณะ:</strong><br>
                            <span style="font-size: 16px;">${user.faculty === 'engineering' ? 'คณะวิศวกรรมศาสตร์' :
                        user.faculty === 'business' ? 'คณะบริหารธุรกิจและเทคโนโลยีสารสนเทศ' :
                            user.faculty === 'education' ? 'คณะครุศาสตร์อุตสาหกรรม' : user.faculty
                    }</span>
                        </div>
                        <div>
                            <strong><i class="fas fa-graduation-cap"></i> สาขาวิชา:</strong><br>
                            <span style="font-size: 16px;">${user.major}</span>
                        </div>
                        <div>
                            <strong><i class="fas fa-calendar-alt"></i> ชั้นปี:</strong><br>
                            <span style="font-size: 16px;">ปี ${user.year}</span>
                        </div>` : `
                        <div>
                            <strong><i class="fas fa-building"></i> แผนก/สาขา:</strong><br>
                            <span style="font-size: 16px;">${user.department}</span>
                        </div>`}
                    </div>
                </div>

                ${userType === 'student' ? `
                <div style="background: #e8f5e8; padding: 20px; border-radius: 15px; margin-bottom: 25px;">
                    <h3 style="color: #28a745; margin-bottom: 15px;">
                        <i class="fas fa-shopping-cart"></i> สถิติการสั่งซื้อ
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        ${getStudentOrderStats(user.id)}
                    </div>
                </div>` : ''}

                <div class="button-group">
                    <button class="btn btn-warning" onclick="editUser('${userType}', '${userId}')">
                        <i class="fas fa-edit"></i> แก้ไขข้อมูล
                    </button>
                    <button class="btn btn-secondary" onclick="closeModal()">
                        <i class="fas fa-times"></i> ปิด
                    </button>
                </div>
            `;

            document.getElementById('product-modal').style.display = 'block';
        }

        function getStudentOrderStats(studentId) {
            const studentOrders = orders.filter(order => order.studentId === studentId);
            const completedOrders = studentOrders.filter(order => order.status === 'completed');
            const totalSpent = completedOrders.reduce((sum, order) => sum + order.total, 0);
            const pendingOrders = studentOrders.filter(order =>
                ['pending-payment', 'pending-confirmation', 'pending-approval', 'preparing', 'ready'].includes(order.status)
            );

            return `
                <div style="text-align: center;">
                    <div style="font-size: 24px; font-weight: 700; color: #2a5298;">${studentOrders.length}</div>
                    <div style="font-size: 14px; color: #666;">คำสั่งซื้อทั้งหมด</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 24px; font-weight: 700; color: #28a745;">${completedOrders.length}</div>
                    <div style="font-size: 14px; color: #666;">เสร็จสิ้น</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 24px; font-weight: 700; color: #ffc107;">${pendingOrders.length}</div>
                    <div style="font-size: 14px; color: #666;">กำลังดำเนินการ</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 24px; font-weight: 700; color: #17a2b8;">${totalSpent.toLocaleString()}</div>
                    <div style="font-size: 14px; color: #666;">ยอดซื้อ (บาท)</div>
                </div>
            `;
        }

        function editUser(userType, userId) {
            const userGroup = userType === 'student' ? 'students' : 'admins';
            const user = users[userGroup][userId];

            if (!user) {
                showNotification('❌ ไม่พบข้อมูลผู้ใช้', 'error');
                return;
            }

            const modalContent = document.getElementById('modal-product-content');
            modalContent.innerHTML = `
                <h2><i class="fas fa-user-edit"></i> แก้ไขข้อมูล${userType === 'student' ? 'นักศึกษา' : 'เจ้าหน้าที่'}</h2>
        
                <form id="editUserForm">
                    <div class="form-section">
                        <h3><i class="fas fa-id-card"></i> ข้อมูลพื้นฐาน</h3>
                
                        <div class="form-group">
                            <label for="edit-user-id">รหัส${userType === 'student' ? 'นักศึกษา' : 'เจ้าหน้าที่'}</label>
                            <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: #f8f9fa; transition: all 0.3s ease;" class="input-container readonly">
                                <input type="text" id="edit-user-id" value="${user.id}" readonly 
                                    style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none; cursor: not-allowed;">
                                <i class="fas fa-id-card" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #999; font-size: 16px;"></i>
                            </div>
                            <small style="color: #666; font-size: 12px; display: block; margin-top: 8px;">รหัสไม่สามารถเปลี่ยนแปลงได้</small>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="edit-user-firstname">ชื่อ *</label>
                                <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                                    <input type="text" id="edit-user-firstname" value="${user.firstname}" required 
                                        style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                                    <i class="fas fa-user" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="edit-user-lastname">นามสกุล *</label>
                                <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                                    <input type="text" id="edit-user-lastname" value="${user.lastname}" required 
                                        style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                                    <i class="fas fa-user-tag" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                                </div>
                            </div>
                        </div>

                        ${userType === 'student' ? `
                        <div class="form-group">
                            <label for="edit-user-faculty">คณะ *</label>
                            <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="select-container">
                                <select id="edit-user-faculty" required 
                                    style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none; appearance: none; cursor: pointer;">
                                    <option value="engineering" ${user.faculty === 'engineering' ? 'selected' : ''}>คณะวิศวกรรมศาสตร์</option>
                                    <option value="business" ${user.faculty === 'business' ? 'selected' : ''}>คณะบริหารธุรกิจและเทคโนโลยีสารสนเทศ</option>
                                    <option value="education" ${user.faculty === 'education' ? 'selected' : ''}>คณะครุศาสตร์อุตสาหกรรม</option>
                                </select>
                                <i class="fas fa-university" style="position: absolute; right: 45px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px; pointer-events: none;"></i>
                                <i class="fas fa-chevron-down" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 14px; pointer-events: none;"></i>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="edit-user-major">สาขาวิชา *</label>
                                <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                                    <input type="text" id="edit-user-major" value="${user.major}" required 
                                        style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                                    <i class="fas fa-graduation-cap" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="edit-user-year">ชั้นปี *</label>
                                <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="select-container">
                                    <select id="edit-user-year" required 
                                        style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none; appearance: none; cursor: pointer;">
                                        <option value="1" ${user.year === '1' ? 'selected' : ''}>ปี 1</option>
                                        <option value="2" ${user.year === '2' ? 'selected' : ''}>ปี 2</option>
                                        <option value="3" ${user.year === '3' ? 'selected' : ''}>ปี 3</option>
                                        <option value="4" ${user.year === '4' ? 'selected' : ''}>ปี 4</option>
                                    </select>
                                    <i class="fas fa-calendar-alt" style="position: absolute; right: 45px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px; pointer-events: none;"></i>
                                    <i class="fas fa-chevron-down" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 14px; pointer-events: none;"></i>
                                </div>
                            </div>
                        </div>` : `
                        <div class="form-group">
                            <label for="edit-user-department">แผนก/สาขา *</label>
                            <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                                <input type="text" id="edit-user-department" value="${user.department}" required 
                                    style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                                <i class="fas fa-building" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                            </div>
                        </div>`}
                    </div>

                    <div class="form-section">
                        <h3><i class="fas fa-address-book"></i> ข้อมูลติดต่อ</h3>
                
                        <div class="form-group">
                            <label for="edit-user-email">อีเมล *</label>
                            <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                                <input type="email" id="edit-user-email" value="${user.email}" required 
                                    style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                                <i class="fas fa-envelope" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="edit-user-phone">เบอร์โทรศัพท์ *</label>
                            <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                                <input type="tel" id="edit-user-phone" value="${user.phone}" required 
                                    pattern="[0-9]{10}" title="กรุณากรอกเบอร์โทรศัพท์ 10 หลัก"
                                    style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                                <i class="fas fa-phone" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                            </div>
                            <small style="color: #666; font-size: 12px; display: block; margin-top: 8px;">
                                <i class="fas fa-info-circle"></i> กรอกเบอร์โทรศัพท์ 10 หลัก เช่น 0812345678
                            </small>
                        </div>
                    </div>

                    <div class="button-group">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> บันทึกการแก้ไข
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">
                            <i class="fas fa-times"></i> ยกเลิก
                        </button>
                    </div>
                </form>
            `;

            document.getElementById('product-modal').style.display = 'block';

            // เพิ่ม Event Listeners
            setupEditUserFormEffects();

            // Phone number formatting
            const phoneInput = document.getElementById('edit-user-phone');
            if (phoneInput) {
                phoneInput.addEventListener('input', function () {
                    let value = this.value.replace(/[^0-9]/g, '');
                    if (value.length > 10) value = value.slice(0, 10);
                    this.value = value;
                });
            }

            // Form submission
            document.getElementById('editUserForm').addEventListener('submit', function (e) {
                e.preventDefault();
                saveUserChanges(userType, userId);
            });
        }

        function setupEditUserFormEffects() {
            // เพิ่ม focus effects สำหรับฟอร์มแก้ไขผู้ใช้
            const inputContainers = document.querySelectorAll('#product-modal .input-container');
            const selectContainers = document.querySelectorAll('#product-modal .select-container');

            // Input containers
            inputContainers.forEach(container => {
                const input = container.querySelector('input');
                if (input && !container.classList.contains('readonly')) {
                    input.addEventListener('focus', function () {
                        container.style.borderColor = '#2a5298';
                        container.style.boxShadow = '0 0 15px rgba(42, 82, 152, 0.2)';
                        container.style.transform = 'translateY(-2px)';
                    });

                    input.addEventListener('blur', function () {
                        container.style.borderColor = '#e9ecef';
                        container.style.boxShadow = 'none';
                        container.style.transform = 'translateY(0)';
                    });
                }
            });

            // Select containers
            selectContainers.forEach(container => {
                const select = container.querySelector('select');
                if (select) {
                    select.addEventListener('focus', function () {
                        container.style.borderColor = '#2a5298';
                        container.style.boxShadow = '0 0 15px rgba(42, 82, 152, 0.2)';
                        container.style.transform = 'translateY(-2px)';
                    });

                    select.addEventListener('blur', function () {
                        container.style.borderColor = '#e9ecef';
                        container.style.boxShadow = 'none';
                        container.style.transform = 'translateY(0)';
                    });
                }
            });
        }

        function saveUserChanges(userType, userId) {
            const userGroup = userType === 'student' ? 'students' : 'admins';
            const user = users[userGroup][userId];

            // รวบรวมข้อมูลใหม่
            const updatedData = {
                firstname: document.getElementById('edit-user-firstname').value.trim(),
                lastname: document.getElementById('edit-user-lastname').value.trim(),
                email: document.getElementById('edit-user-email').value.trim(),
                phone: document.getElementById('edit-user-phone').value.trim()
            };

            if (userType === 'student') {
                updatedData.faculty = document.getElementById('edit-user-faculty').value;
                updatedData.major = document.getElementById('edit-user-major').value.trim();
                updatedData.year = document.getElementById('edit-user-year').value;
            } else {
                updatedData.department = document.getElementById('edit-user-department').value.trim();
            }

            // ตรวจสอบข้อมูล
            if (!updatedData.firstname || !updatedData.lastname || !updatedData.email || !updatedData.phone) {
                showNotification('⚠️ กรุณากรอกข้อมูลให้ครบถ้วน', 'error');
                return;
            }

            // ตรวจสอบรูปแบบอีเมล
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(updatedData.email)) {
                showNotification('⚠️ รูปแบบอีเมลไม่ถูกต้อง', 'error');
                return;
            }

            // ตรวจสอบเบอร์โทร
            if (!/^[0-9]{10}$/.test(updatedData.phone)) {
                showNotification('⚠️ เบอร์โทรศัพท์ต้องเป็นตัวเลข 10 หลัก', 'error');
                return;
            }

            if (userType === 'student' && (!updatedData.faculty || !updatedData.major || !updatedData.year)) {
                showNotification('⚠️ กรุณากรอกข้อมูลการศึกษาให้ครบถ้วน', 'error');
                return;
            }

            if (userType === 'admin' && !updatedData.department) {
                showNotification('⚠️ กรุณากรอกข้อมูลแผนก/สาขา', 'error');
                return;
            }

            // อัปเดตข้อมูล
            Object.assign(user, updatedData);
            users[userGroup][userId] = user;

            // อัปเดต currentUser ถ้าเป็นการแก้ไขตัวเอง
            if (currentUser && currentUser.id === userId && currentUser.type === userType) {
                currentUser = user;

                // อัปเดตข้อความต้อนรับ
                if (userType === 'student') {
                    const displayName = `นักศึกษา ${user.firstname} ${user.lastname} (${user.id})`;
                    document.getElementById('student-welcome-message').innerHTML = `<i class="fas fa-hand-holding-heart"></i> ยินดีต้อนรับ ${displayName}`;
                } else {
                    const displayName = `เจ้าหน้าที่ ${user.firstname} ${user.lastname} (${user.id})`;
                    document.getElementById('admin-welcome-message').innerHTML = `<i class="fas fa-hand-holding-heart"></i> ยินดีต้อนรับ ${displayName}`;
                }
            }

            // รีเฟรชตาราง
            loadUserManagementTable();

            // ปิด modal
            closeModal();

            showNotification(`✅ แก้ไขข้อมูล ${updatedData.firstname} ${updatedData.lastname} เรียบร้อยแล้ว!`, 'success');
        }

        function showReports() {
            document.getElementById('reports-modal').style.display = 'block';
            showSalesReport(); // แสดงรายงานการขายเป็นค่าเริ่มต้น
        }

        function closeReports() {
            document.getElementById('reports-modal').style.display = 'none';
        }

        function showSalesReport() {
            const completedOrders = orders.filter(order => order.status === 'completed');
            const totalRevenue = completedOrders.reduce((sum, order) => sum + order.total, 0);
            const totalOrders = completedOrders.length;
            const avgOrderValue = totalOrders > 0 ? totalRevenue / totalOrders : 0;

            // สถิติรายเดือน
            const monthlyStats = {};
            completedOrders.forEach(order => {
                const month = order.date.substring(0, 7); // เอาเฉพาะ YYYY-MM
                if (!monthlyStats[month]) {
                    monthlyStats[month] = { orders: 0, revenue: 0 };
                }
                monthlyStats[month].orders++;
                monthlyStats[month].revenue += order.total;
            });

            // สินค้าขายดี
            const productSales = {};
            completedOrders.forEach(order => {
                order.items.forEach(item => {
                    if (!productSales[item.id]) {
                        productSales[item.id] = { name: item.name, quantity: 0, revenue: 0 };
                    }
                    productSales[item.id].quantity += item.quantity;
                    productSales[item.id].revenue += item.price * item.quantity;
                });
            });

            const topProducts = Object.values(productSales)
                .sort((a, b) => b.quantity - a.quantity)
                .slice(0, 5);

            const content = document.getElementById('report-content');
            content.innerHTML = `
                <h3 style="color: #2a5298; margin-bottom: 25px;">
            <i class="fas fa-chart-line"></i> รายงานการขาย
                </h3>

                <!-- สถิติรวม -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: linear-gradient(45deg, #28a745, #20c997); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700;">${totalRevenue.toLocaleString()}</div>
                        <div style="font-size: 14px; opacity: 0.9;">รายได้รวม (บาท)</div>
                    </div>
                    <div style="background: linear-gradient(45deg, #2a5298, #1e3c72); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700;">${totalOrders}</div>
                        <div style="font-size: 14px; opacity: 0.9;">คำสั่งซื้อเสร็จสิ้น</div>
                    </div>
                    <div style="background: linear-gradient(45deg, #17a2b8, #138496); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700;">${Math.round(avgOrderValue).toLocaleString()}</div>
                        <div style="font-size: 14px; opacity: 0.9;">ค่าเฉลี่ยต่อคำสั่งซื้อ</div>
                    </div>
                </div>

                <!-- กราฟรายได้รายเดือน -->
                <div style="background: #fff; padding: 25px; border-radius: 15px; margin-bottom: 25px; border: 1px solid #dee2e6;">
                    <h4 style="color: #2a5298; margin-bottom: 20px;">
                        <i class="fas fa-chart-area"></i> กราฟรายได้รายเดือน
                    </h4>
                    <div style="position: relative; height: 300px;">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>

                <!-- กราฟสินค้าขายดี -->
                <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 25px;">
                    <h4 style="color: #2a5298; margin-bottom: 20px;">
                        <i class="fas fa-star"></i> กราฟสินค้าขายดี Top 5
                    </h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
                        <!-- กราฟแท่ง (จำนวนขาย) -->
                        <div style="background: white; padding: 20px; border-radius: 10px;">
                            <h5 style="text-align: center; margin-bottom: 15px; color: #666;">จำนวนขาย (ชิ้น)</h5>
                            <div style="position: relative; height: 250px;">
                                <canvas id="productQuantityChart"></canvas>
                            </div>
                        </div>
                
                        <!-- กราฟวงกลม (รายได้) -->
                        <div style="background: white; padding: 20px; border-radius: 10px;">
                            <h5 style="text-align: center; margin-bottom: 15px; color: #666;">สัดส่วนรายได้</h5>
                            <div style="position: relative; height: 250px;">
                                <canvas id="productRevenueChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ตารางสินค้าขายดี -->
                <div style="background: #fff; padding: 25px; border-radius: 15px; margin-bottom: 25px; border: 1px solid #dee2e6;">
                    <h4 style="color: #2a5298; margin-bottom: 20px;">
                        <i class="fas fa-table"></i> ตารางสินค้าขายดี Top 5
                    </h4>
                    ${topProducts.length > 0 ? `
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>อันดับ</th>
                                    <th>ชื่อสินค้า</th>
                                    <th>จำนวนขาย</th>
                                    <th>รายได้</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${topProducts.map((product, index) => `
                                    <tr>
                                        <td style="text-align: center; font-weight: 700; color: ${index === 0 ? '#ffd700' : index === 1 ? '#c0c0c0' : index === 2 ? '#cd7f32' : '#666'};">
                                            ${index === 0 ? '🥇' : index === 1 ? '🥈' : index === 2 ? '🥉' : index + 1}
                                        </td>
                                        <td>${product.name}</td>
                                        <td style="text-align: center; font-weight: 600;">${product.quantity} ชิ้น</td>
                                        <td style="text-align: right; font-weight: 600; color: #28a745;">${product.revenue.toLocaleString()} บาท</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    ` : '<p style="text-align: center; color: #666;">ยังไม่มีข้อมูลการขาย</p>'}
                </div>

                <!-- สถิติรายเดือน (ตาราง) -->
                <div style="background: #fff; padding: 25px; border-radius: 15px; border: 1px solid #dee2e6;">
                    <h4 style="color: #2a5298; margin-bottom: 20px;">
                        <i class="fas fa-calendar-alt"></i> ตารางสถิติรายเดือน
                    </h4>
                    ${Object.keys(monthlyStats).length > 0 ? `
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>เดือน</th>
                                    <th>จำนวนคำสั่งซื้อ</th>
                                    <th>รายได้</th>
                                    <th>เฉลี่ยต่อคำสั่งซื้อ</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${Object.entries(monthlyStats).map(([month, stats]) => `
                                    <tr>
                                        <td style="font-weight: 600;">${month}</td>
                                        <td style="text-align: center;">${stats.orders}</td>
                                        <td style="text-align: right; color: #28a745; font-weight: 600;">${stats.revenue.toLocaleString()} บาท</td>
                                        <td style="text-align: right; color: #17a2b8;">${Math.round(stats.revenue / stats.orders).toLocaleString()} บาท</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    ` : '<p style="text-align: center; color: #666;">ยังไม่มีข้อมูลการขาย</p>'}
                </div>
            `;

            // สร้างกราฟหลังจากแสดง HTML
            setTimeout(() => {
                createRevenueChart(monthlyStats);
                createProductCharts(topProducts);
            }, 100);
        }

        function createRevenueChart(monthlyStats) {
            const ctx = document.getElementById('revenueChart');
            if (!ctx) return;

            const months = Object.keys(monthlyStats).sort();
            const revenues = months.map(month => monthlyStats[month].revenue);
            const orders = months.map(month => monthlyStats[month].orders);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'รายได้ (บาท)',
                        data: revenues,
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        yAxisID: 'y'
                    }, {
                        label: 'จำนวนคำสั่งซื้อ',
                        data: orders,
                        borderColor: '#2a5298',
                        backgroundColor: 'rgba(42, 82, 152, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.4,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'รายได้ (บาท)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'จำนวนคำสั่งซื้อ'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
        }

        function createProductCharts(topProducts) {
            if (topProducts.length === 0) return;

            // กราฟแท่งจำนวนขาย
            const quantityCtx = document.getElementById('productQuantityChart');
            if (quantityCtx) {
                new Chart(quantityCtx, {
                    type: 'bar',
                    data: {
                        labels: topProducts.map(p => p.name.length > 15 ? p.name.substring(0, 15) + '...' : p.name),
                        datasets: [{
                            label: 'จำนวนขาย (ชิ้น)',
                            data: topProducts.map(p => p.quantity),
                            backgroundColor: [
                                '#ffd700',
                                '#c0c0c0',
                                '#cd7f32',
                                '#2a5298',
                                '#17a2b8'
                            ],
                            borderColor: [
                                '#ffb700',
                                '#a0a0a0',
                                '#ad5f12',
                                '#1e3c72',
                                '#138496'
                            ],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            // กราฟวงกลมรายได้
            const revenueCtx = document.getElementById('productRevenueChart');
            if (revenueCtx) {
                new Chart(revenueCtx, {
                    type: 'doughnut',
                    data: {
                        labels: topProducts.map(p => p.name.length > 20 ? p.name.substring(0, 20) + '...' : p.name),
                        datasets: [{
                            data: topProducts.map(p => p.revenue),
                            backgroundColor: [
                                '#ffd700',
                                '#c0c0c0',
                                '#cd7f32',
                                '#2a5298',
                                '#17a2b8'
                            ],
                            borderColor: '#fff',
                            borderWidth: 3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 10,
                                    usePointStyle: true
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        return context.label + ': ' + context.parsed.toLocaleString() + ' บาท';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        function showProductReport() {
            const totalProducts = products.length;
            const outOfStock = products.filter(p => p.stock === 0).length;
            const lowStock = products.filter(p => p.stock > 0 && p.stock <= 10).length;
            const inStock = products.filter(p => p.stock > 10).length;

            // สินค้าแยกตามหมวดหมู่
            const categoryStats = {};
            products.forEach(product => {
                if (!categoryStats[product.category]) {
                    categoryStats[product.category] = { count: 0, totalStock: 0, totalValue: 0 };
                }
                categoryStats[product.category].count++;
                categoryStats[product.category].totalStock += product.stock;
                categoryStats[product.category].totalValue += product.price * product.stock;
            });

            const content = document.getElementById('report-content');
            content.innerHTML = `
                <h3 style="color: #2a5298; margin-bottom: 25px;">
                    <i class="fas fa-box"></i> รายงานสินค้า
                </h3>

                <!-- สถิติสต็อก -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: linear-gradient(45deg, #2a5298, #1e3c72); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700;">${totalProducts}</div>
                        <div style="font-size: 14px; opacity: 0.9;">สินค้าทั้งหมด</div>
                    </div>
                    <div style="background: linear-gradient(45deg, #28a745, #20c997); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700;">${inStock}</div>
                        <div style="font-size: 14px; opacity: 0.9;">สินค้าพร้อมขาย</div>
                    </div>
                    <div style="background: linear-gradient(45deg, #ffc107, #ffca2c); color: #333; padding: 20px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700;">${lowStock}</div>
                        <div style="font-size: 14px; opacity: 0.8;">สต็อกต่ำ (≤10)</div>
                    </div>
                    <div style="background: linear-gradient(45deg, #dc3545, #c82333); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700;">${outOfStock}</div>
                        <div style="font-size: 14px; opacity: 0.9;">สินค้าหมด</div>
                    </div>
                </div>

                <!-- รายงานตามหมวดหมู่ -->
                <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 25px;">
                    <h4 style="color: #2a5298; margin-bottom: 20px;">
                        <i class="fas fa-tags"></i> สินค้าตามหมวดหมู่
                    </h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>หมวดหมู่</th>
                                <th>จำนวนสินค้า</th>
                                <th>สต็อกรวม</th>
                                <th>มูลค่าสต็อก</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(categoryStats).map(([category, stats]) => {
                const categoryName = {
                    'Learning Supplies': '📚 อุปกรณ์การเรียน',
                    'Student Uniform': '👔 เครื่องแบบนักศึกษา',
                    'Activity': '🎽 เสื้อกิจกรรม',
                    'Souvenirs': '🎁 ของที่ระลึก'
                }[category] || category;

                return `
                                    <tr>
                                        <td style="font-weight: 600;">${categoryName}</td>
                                        <td style="text-align: center;">${stats.count} รายการ</td>
                                        <td style="text-align: center;">${stats.totalStock} ชิ้น</td>
                                        <td style="text-align: right; color: #28a745; font-weight: 600;">${stats.totalValue.toLocaleString()} บาท</td>
                                    </tr>
                                `;
            }).join('')}
                        </tbody>
                    </table>
                </div>

                <!-- รายการสินค้าต้องเติม -->
                ${outOfStock + lowStock > 0 ? `
                <div style="background: #fff; padding: 25px; border-radius: 15px; border: 1px solid #dc3545;">
                    <h4 style="color: #dc3545; margin-bottom: 20px;">
                        <i class="fas fa-exclamation-triangle"></i> สินค้าที่ต้องเติมสต็อก
                    </h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ชื่อสินค้า</th>
                                <th>หมวดหมู่</th>
                                <th>สต็อกเหลือ</th>
                                <th>สถานะ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${products.filter(p => p.stock <= 10).map(product => `
                                <tr>
                                    <td>${product.name}</td>
                                    <td>${{
                    'Learning Supplies': '📚 อุปกรณ์การเรียน',
                    'Student Uniform': '👔 เครื่องแบบนักศึกษา',
                    'Activity': '🎽 เสื้อกิจกรรม',
                    'Souvenirs': '🎁 ของที่ระลึก'
                }[product.category] || product.category}</td>
                                <td style="text-align: center; font-weight: 600; color: ${product.stock === 0 ? '#dc3545' : '#ffc107'};">
                                        ${product.stock} ชิ้น
                                    </td>
                                    <td style="text-align: center;">
                                        <span class="status-badge" style="background: ${product.stock === 0 ? '#dc3545' : '#ffc107'}; color: ${product.stock === 0 ? 'white' : '#333'};">
                                            ${product.stock === 0 ? 'หมด' : 'ต่ำ'}
                                        </span>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                ` : ''}
            `;
        }

        function showUserReport() {
            const totalStudents = Object.keys(users.students).length;
            const totalAdmins = Object.keys(users.admins).length;
            const totalUsers = totalStudents + totalAdmins;

            // สถิติคณะ
            const facultyStats = {};
            Object.values(users.students).forEach(student => {
                if (!facultyStats[student.faculty]) {
                    facultyStats[student.faculty] = { count: 0, years: {} };
                }
                facultyStats[student.faculty].count++;

                if (!facultyStats[student.faculty].years[student.year]) {
                    facultyStats[student.faculty].years[student.year] = 0;
                }
                facultyStats[student.faculty].years[student.year]++;
            });

            // นักศึกษาที่มีการสั่งซื้อ
            const studentsWithOrders = new Set(orders.map(order => order.studentId));
            const activeStudents = studentsWithOrders.size;

            const content = document.getElementById('report-content');
            content.innerHTML = `
                <h3 style="color: #2a5298; margin-bottom: 25px;">
                    <i class="fas fa-users"></i> รายงานผู้ใช้
                </h3>

                <!-- สถิติผู้ใช้รวม -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: linear-gradient(45deg, #2a5298, #1e3c72); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700;">${totalUsers}</div>
                        <div style="font-size: 14px; opacity: 0.9;">ผู้ใช้ทั้งหมด</div>
                    </div>
                    <div style="background: linear-gradient(45deg, #28a745, #20c997); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700;">${totalStudents}</div>
                        <div style="font-size: 14px; opacity: 0.9;">นักศึกษา</div>
                    </div>
                    <div style="background: linear-gradient(45deg, #dc3545, #c82333); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700;">${totalAdmins}</div>
                        <div style="font-size: 14px; opacity: 0.9;">เจ้าหน้าที่</div>
                    </div>
                    <div style="background: linear-gradient(45deg, #17a2b8, #138496); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700;">${activeStudents}</div>
                        <div style="font-size: 14px; opacity: 0.9;">มีการสั่งซื้อ</div>
                    </div>
                </div>

                <!-- สถิติตามคณะ -->
                <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 25px;">
                    <h4 style="color: #2a5298; margin-bottom: 20px;">
                        <i class="fas fa-university"></i> นักศึกษาจำแนกตามคณะ
                    </h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>คณะ</th>
                                <th>จำนวนนักศึกษา</th>
                                <th>ปี 1</th>
                                <th>ปี 2</th>
                                <th>ปี 3</th>
                                <th>ปี 4</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(facultyStats).map(([faculty, stats]) => {
                const facultyName = {
                    'engineering': 'คณะวิศวกรรมศาสตร์',
                    'business': 'คณะบริหารธุรกิจและเทคโนโลยีสารสนเทศ',
                    'education': 'คณะครุศาสตร์อุตสาหกรรม'
                }[faculty] || faculty;

                return `
                                    <tr>
                                        <td style="font-weight: 600;">${facultyName}</td>
                                        <td style="text-align: center; font-weight: 600; color: #2a5298;">${stats.count}</td>
                                        <td style="text-align: center;">${stats.years['1'] || 0}</td>
                                        <td style="text-align: center;">${stats.years['2'] || 0}</td>
                                        <td style="text-align: center;">${stats.years['3'] || 0}</td>
                                        <td style="text-align: center;">${stats.years['4'] || 0}</td>
                                    </tr>
                                `;
            }).join('')}
                        </tbody>
                    </table>
                </div>

                <!-- ผู้ใช้ที่ลงทะเบียนล่าสุด -->
                <div style="background: #fff; padding: 25px; border-radius: 15px; border: 1px solid #dee2e6;">
                    <h4 style="color: #2a5298; margin-bottom: 20px;">
                        <i class="fas fa-user-plus"></i> ผู้ใช้ที่ลงทะเบียนในระบบ
                    </h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        ${[...Object.values(users.students), ...Object.values(users.admins)]
                    .slice(-6)
                    .map(user => `
                                <div style="border: 1px solid #dee2e6; border-radius: 10px; padding: 15px;">
                                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                        <i class="fas fa-${user.type === 'student' ? 'user-graduate' : 'user-tie'}" style="color: ${user.type === 'student' ? '#2a5298' : '#dc3545'}; margin-right: 10px; font-size: 18px;"></i>
                                        <strong>${user.firstname} ${user.lastname}</strong>
                                    </div>
                                    <div style="font-size: 14px; color: #666;">
                                        <div>รหัส: ${user.id}</div>
                                        <div>อีเมล: ${user.email}</div>
                                        ${user.type === 'student' ?
                            `<div>${{
                                'engineering': 'วิศวกรรมศาสตร์',
                                'business': 'บริหารธุรกิจฯ',
                                'education': 'ครุศาสตร์อุตสาหกรรม'
                            }[user.faculty]} ปี ${user.year}</div>` :
                            `<div>${user.department}</div>`
                        }
                                    </div>
                                </div>
                            `).join('')}
                    </div>
                </div>
            `;
        }

        function showOrderReport() {
            const totalOrders = orders.length;
            const completedOrders = orders.filter(order => order.status === 'completed').length;
            const pendingOrders = orders.filter(order =>
                ['pending-payment', 'pending-confirmation', 'pending-approval', 'preparing', 'ready'].includes(order.status)
            ).length;
            const cancelledOrders = orders.filter(order => order.status === 'cancelled').length;

            // สถิติตามสถานะ
            const statusStats = {};
            orders.forEach(order => {
                if (!statusStats[order.status]) {
                    statusStats[order.status] = 0;
                }
                statusStats[order.status]++;
            });

            // คำสั่งซื้อล่าสุด
            const recentOrders = orders.slice(-10).reverse();

            const content = document.getElementById('report-content');
            content.innerHTML = `
                <h3 style="color: #2a5298; margin-bottom: 25px;">
                    <i class="fas fa-shopping-cart"></i> รายงานคำสั่งซื้อ
                </h3>

                <!-- สถิติคำสั่งซื้อรวม -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: linear-gradient(45deg, #2a5298, #1e3c72); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700;">${totalOrders}</div>
                        <div style="font-size: 14px; opacity: 0.9;">คำสั่งซื้อทั้งหมด</div>
                    </div>
                    <div style="background: linear-gradient(45deg, #28a745, #20c997); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700;">${completedOrders}</div>
                        <div style="font-size: 14px; opacity: 0.9;">เสร็จสิ้น</div>
                    </div>
                    <div style="background: linear-gradient(45deg, #ffc107, #ffca2c); color: #333; padding: 20px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700;">${pendingOrders}</div>
                        <div style="font-size: 14px; opacity: 0.8;">กำลังดำเนินการ</div>
                    </div>
                    <div style="background: linear-gradient(45deg, #6c757d, #5a6268); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700;">${cancelledOrders}</div>
                        <div style="font-size: 14px; opacity: 0.9;">ยกเลิก</div>
                    </div>
                </div>

                <!-- สถิติตามสถานะ -->
                <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 25px;">
                    <h4 style="color: #2a5298; margin-bottom: 20px;">
                        <i class="fas fa-list-alt"></i> สถิติตามสถานะ
                    </h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>สถานะ</th>
                                <th>จำนวน</th>
                                <th>เปอร์เซ็นต์</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(statusStats).map(([status, count]) => {
                const statusInfo = orderStatuses[status];
                const percentage = totalOrders > 0 ? (count / totalOrders * 100).toFixed(1) : 0;

                return `
                                    <tr>
                                        <td>
                                            <i class="${statusInfo.icon}" style="color: ${statusInfo.color}; margin-right: 8px;"></i>
                                            ${statusInfo.name}
                                        </td>
                                        <td style="text-align: center; font-weight: 600;">${count}</td>
                                        <td style="text-align: center;">${percentage}%</td>
                                    </tr>
                                `;
            }).join('')}
                        </tbody>
                    </table>
                </div>

                <!-- คำสั่งซื้อล่าสุด -->
                <div style="background: #fff; padding: 25px; border-radius: 15px; border: 1px solid #dee2e6;">
                    <h4 style="color: #2a5298; margin-bottom: 20px;">
                        <i class="fas fa-clock"></i> คำสั่งซื้อล่าสุด (10 รายการ)
                    </h4>
                    ${recentOrders.length > 0 ? `
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>รหัสคำสั่งซื้อ</th>
                                    <th>นักศึกษา</th>
                                    <th>วันที่สั่ง</th>
                                    <th>ยอดรวม</th>
                                    <th>สถานะ</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${recentOrders.map(order => {
                const statusInfo = orderStatuses[order.status];
                return `
                                        <tr>
                                            <td style="font-weight: 600; color: #2a5298;">${order.id}</td>
                                            <td>${order.studentName}</td>
                                            <td>${order.date}</td>
                                            <td style="text-align: right; font-weight: 600; color: #28a745;">${order.total.toLocaleString()} บาท</td>
                                            <td>
                                                <span class="status-badge status-${order.status.replace('-', '-')}">${statusInfo.name}</span>
                                            </td>
                                        </tr>
                                    `;
            }).join('')}
                            </tbody>
                        </table>
                    ` : '<p style="text-align: center; color: #666;">ยังไม่มีคำสั่งซื้อ</p>'}
                </div>

                <!-- ข้อเสนอแนะ -->
                ${pendingOrders > 0 || products.filter(p => p.stock <= 10).length > 0 ? `
                <div style="background: linear-gradient(135deg, #fff3cd 0%, #fef9e7 100%); padding: 20px; border-radius: 15px; border: 2px solid #ffc107; margin-top: 25px;">
                    <h4 style="color: #856404; margin-bottom: 15px;">
                        <i class="fas fa-lightbulb"></i> ข้อเสนอแนะ
                    </h4>
                    <ul style="color: #856404; margin: 0; padding-left: 20px;">
                        ${pendingOrders > 0 ? `<li>มีคำสั่งซื้อรอดำเนินการ ${pendingOrders} รายการ ควรตรวจสอบและดำเนินการให้เสร็จสิ้น</li>` : ''}
                        ${products.filter(p => p.stock <= 10).length > 0 ? `<li>มีสินค้าสต็อกต่ำ ${products.filter(p => p.stock <= 10).length} รายการ ควรเติมสต็อกเพื่อป้องกันการขาดแคลน</li>` : ''}
                        ${completedOrders === 0 ? '<li>ยังไม่มีการขายที่เสร็จสิ้น ควรติดตามและช่วยเหลือลูกค้าในการสั่งซื้อ</li>' : ''}
                    </ul>
                </div>
                ` : ''}
            `;
        }

        // ===== ฟังก์ชันจัดการคลัง =====

        // ตัวแปรเก็บประวัติการเคลื่อนไหวสต็อก
        let stockMovements = [];
        let movementIdCounter = 1;

        // แสดงหน้าจัดการคลัง
        function showInventoryManagement() {
            // ปิด modal อื่นๆ ทั้งหมดก่อน
            document.getElementById('product-management-modal').style.display = 'none';
            document.getElementById('order-management-modal').style.display = 'none';
            document.getElementById('payment-management-modal').style.display = 'none';
            document.getElementById('user-management-modal').style.display = 'none';
            document.getElementById('reports-modal').style.display = 'none';

            updateInventoryStats();
            loadInventoryTable();
            document.getElementById('inventory-management-modal').style.display = 'block';
        }

        // ปิดหน้าจัดการคลัง
        function closeInventoryManagement() {
            document.getElementById('inventory-management-modal').style.display = 'none';
        }

        // อัพเดทสถิติคลัง
        function updateInventoryStats() {
            const totalItems = products.length;
            const totalStock = products.reduce((sum, product) => sum + product.stock, 0);
            const lowStock = products.filter(p => p.stock > 0 && p.stock <= 10).length;
            const outStock = products.filter(p => p.stock === 0).length;

            document.getElementById('inventory-total-items').textContent = totalItems;
            document.getElementById('inventory-total-stock').textContent = totalStock.toLocaleString();
            document.getElementById('inventory-low-stock').textContent = lowStock;
            document.getElementById('inventory-out-stock').textContent = outStock;


        }

        // โหลดตารางสินค้าในคลัง
        function loadInventoryTable() {
            const tbody = document.getElementById('inventory-table-body');
            tbody.innerHTML = '';

            let filteredProducts = [...products];

            // กรองข้อมูล
            const categoryFilter = document.getElementById('inventory-category-filter')?.value;
            const stockFilter = document.getElementById('inventory-stock-filter')?.value;
            const searchFilter = document.getElementById('inventory-search')?.value.toLowerCase();

            if (categoryFilter) {
                filteredProducts = filteredProducts.filter(p => p.category === categoryFilter);
            }

            if (stockFilter) {
                switch (stockFilter) {
                    case 'in-stock':
                        filteredProducts = filteredProducts.filter(p => p.stock > 10);
                        break;
                    case 'low-stock':
                        filteredProducts = filteredProducts.filter(p => p.stock > 0 && p.stock <= 10);
                        break;
                    case 'out-stock':
                        filteredProducts = filteredProducts.filter(p => p.stock === 0);
                        break;
                }
            }

            if (searchFilter) {
                filteredProducts = filteredProducts.filter(p =>
                    p.name.toLowerCase().includes(searchFilter) ||
                    p.description.toLowerCase().includes(searchFilter)
                );
            }

            if (filteredProducts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #666; padding: 30px;">ไม่พบสินค้าที่ตรงกับเงื่อนไข</td></tr>';
                return;
            }

            filteredProducts.forEach(product => {
                const stockStatus = getStockStatus(product.stock);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <img src="${product.image}" alt="${product.name}" 
                             style="width: 50px; height: 50px; object-fit: cover; border-radius: 8px;">
                    </td>
                    <td style="font-weight: 600;">${product.name}</td>
                    <td>${getCategoryName(product.category)}</td>
                    <td style="text-align: right; font-weight: 600; color: #2a5298;">${product.price.toLocaleString()} บาท</td>
                    <td style="text-align: center; font-weight: 700; color: ${stockStatus.color}; font-size: 18px;">${product.stock}</td>
                    <td style="text-align: center;">
                        <span class="status-badge" style="background: ${stockStatus.color}; color: ${stockStatus.textColor};">
                            ${stockStatus.text}
                        </span>
                    </td>
                    <td>
                        <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                            <button class="btn btn-success btn-small" onclick="quickStockIn(${product.id})" title="รับสินค้าเข้า">
                                <i class="fas fa-plus"></i>
                            </button>
                            <button class="btn btn-warning btn-small" onclick="quickStockOut(${product.id})" title="จ่ายสินค้าออก" 
                                    ${product.stock === 0 ? 'disabled style="opacity: 0.5;"' : ''}>
                                <i class="fas fa-minus"></i>
                            </button>
                            <button class="btn btn-info btn-small" onclick="showProductMovements(${product.id})" title="ดูประวัติ">
                                <i class="fas fa-history"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // กรองข้อมูลสินค้า
        function filterInventory() {
            loadInventoryTable();
        }

        // รับสถานะสต็อก
        function getStockStatus(stock) {
            if (stock === 0) {
                return { color: '#dc3545', textColor: 'white', text: 'หมด' };
            } else if (stock <= 10) {
                return { color: '#ffc107', textColor: '#333', text: 'ต่ำ' };
            } else {
                return { color: '#28a745', textColor: 'white', text: 'ปกติ' };
            }
        }

        // รับชื่อหมวดหมู่
        function getCategoryName(category) {
            const categories = {
                'Learning Supplies': '📚 อุปกรณ์การเรียน',
                'Student Uniform': '👔 เครื่องแบบนักศึกษา',
                'Activity': '🎽 เสื้อกิจกรรม',
                'Souvenirs': '🎁 ของที่ระลึก'
            };
            return categories[category] || category;
        }

        // รับสินค้าเข้าแบบเร็ว
        function quickStockIn(productId) {
            const quantity = prompt('🔢 จำนวนที่ต้องการรับเข้า:');
            if (quantity && !isNaN(quantity) && parseInt(quantity) > 0) {
                addStockMovement(productId, 'in', parseInt(quantity), 'รับสินค้าเข้าแบบด่วน');
                updateInventoryStats();
                // ตรวจสอบสต็อกต่ำและแจ้งเตือน
                checkLowStockAlert();
                loadInventoryTable();
                if (currentUser && currentUser.type === 'admin') {
                    updateAdminStats();
                }
                showNotification(`✅ รับสินค้าเข้า ${parseInt(quantity)} ชิ้น เรียบร้อยแล้ว!`, 'success');
            }
        }

        // จ่ายสินค้าออกแบบเร็ว
        function quickStockOut(productId) {
            const product = products.find(p => p.id === productId);
            if (!product || product.stock === 0) {
                showNotification('❌ ไม่สามารถจ่ายสินค้าได้ เนื่องจากสต็อกหมด', 'error');
                return;
            }

            const quantity = prompt(`🔢 จำนวนที่ต้องการจ่าย (สต็อกปัจจุบัน: ${product.stock}):`);
            if (quantity && !isNaN(quantity) && parseInt(quantity) > 0) {
                if (parseInt(quantity) > product.stock) {
                    showNotification(`❌ จำนวนที่ต้องการจ่ายเกินสต็อกที่มี (${product.stock} ชิ้น)`, 'error');
                    return;
                }

                addStockMovement(productId, 'out', parseInt(quantity), 'จ่ายสินค้าออกแบบด่วน');
                updateInventoryStats();
                loadInventoryTable();
                if (currentUser && currentUser.type === 'admin') {
                    updateAdminStats();
                }
                showNotification(`✅ จ่ายสินค้าออก ${parseInt(quantity)} ชิ้น เรียบร้อยแล้ว!`, 'success');
            }
        }

        // เพิ่มการเคลื่อนไหวสต็อก
        function addStockMovement(productId, type, quantity, note) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            const movement = {
                id: movementIdCounter++,
                productId: productId,
                productName: product.name,
                type: type, // 'in', 'out', 'adjust'
                quantity: quantity,
                stockBefore: product.stock,
                stockAfter: type === 'in' ? product.stock + quantity :
                    type === 'out' ? product.stock - quantity : quantity,
                note: note,
                timestamp: getCurrentDateTime(),
                adminId: currentUser?.id,
                adminName: currentUser ? `${currentUser.firstname} ${currentUser.lastname}` : 'System'
            };

            // อัพเดทสต็อกสินค้า
            if (type === 'in') {
                product.stock += quantity;
            } else if (type === 'out') {
                product.stock = Math.max(0, product.stock - quantity);
            } else if (type === 'adjust') {
                product.stock = quantity;
            }

            stockMovements.push(movement);
        }

        // ดูประวัติการเคลื่อนไหวสินค้า
        function showProductMovements(productId) {
            const product = products.find(p => p.id === productId);
            const movements = stockMovements.filter(m => m.productId === productId).reverse();

            let historyHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 800px; margin: 20px auto;">
                    <h2><i class="fas fa-history"></i> ประวัติการเคลื่อนไหว</h2>
                    <h3 style="color: #2a5298; margin-bottom: 20px;">${product.name}</h3>
            
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <strong>สต็อกปัจจุบัน:</strong> 
                        <span style="font-size: 24px; font-weight: 700; color: #2a5298;">${product.stock} ชิ้น</span>
                    </div>
            `;

            if (movements.length === 0) {
                historyHTML += `
                    <div style="text-align: center; color: #666; padding: 40px;">
                        <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 15px; display: block; color: #ccc;"></i>
                        <h3>ยังไม่มีประวัติการเคลื่อนไหว</h3>
                    <p>เมื่อมีการรับ-จ่ายสินค้า จะแสดงรายการที่นี่</p>
                    </div>
                `;
            } else {
                historyHTML += '<div style="max-height: 400px; overflow-y: auto;">';
                movements.forEach(movement => {
                    const typeInfo = {
                        'in': { icon: 'fas fa-plus-circle', color: '#28a745', text: 'รับเข้า' },
                        'out': { icon: 'fas fa-minus-circle', color: '#dc3545', text: 'จ่ายออก' },
                        'adjust': { icon: 'fas fa-edit', color: '#ffc107', text: 'ปรับปรุง' }
                    }[movement.type];

                    historyHTML += `
                        <div style="border-left: 4px solid ${typeInfo.color}; padding: 15px; margin-bottom: 10px; background: white; border-radius: 0 8px 8px 0;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <i class="${typeInfo.icon}" style="color: ${typeInfo.color}; font-size: 18px;"></i>
                                    <strong style="color: ${typeInfo.color};">${typeInfo.text}</strong>
                                </div>
                                <span style="color: #999; font-size: 14px;">${movement.timestamp}</span>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-bottom: 10px;">
                                <div><strong>จำนวน:</strong> ${movement.quantity} ชิ้น</div>
                                <div><strong>สต็อกก่อน:</strong> ${movement.stockBefore}</div>
                                <div><strong>สต็อกหลัง:</strong> ${movement.stockAfter}</div>
                            </div>
                            <div><strong>หมายเหตุ:</strong> ${movement.note}</div>
                            <div style="color: #666; font-size: 12px; margin-top: 5px;">
                                <i class="fas fa-user"></i> ${movement.adminName}
                            </div>
                        </div>
                    `;
                });
                historyHTML += '</div>';
            }

            historyHTML += `
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-secondary" onclick="this.parentElement.parentElement.parentElement.remove()">
                            <i class="fas fa-times"></i> ปิด
                        </button>
                    </div>
                </div>
            `;

            // สร้าง overlay
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.6);
                backdrop-filter: blur(5px);
                z-index: 1001;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
                overflow-y: auto;
            `;
            overlay.innerHTML = historyHTML;
            document.body.appendChild(overlay);

            // ปิดเมื่อคลิกข้างนอก
            overlay.addEventListener('click', function (e) {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            });
        }

        // ===== ฟังก์ชันจัดการคลังแบบละเอียด =====

        // ฟอร์มรับสินค้าเข้าคลัง
        function showStockInForm() {
            // ปิด modal จัดการคลัง
            document.getElementById('inventory-management-modal').style.display = 'none';

            const modalContent = document.getElementById('modal-product-content');
            modalContent.innerHTML = `
        <h2><i class="fas fa-plus-circle"></i> รับสินค้าเข้าคลัง</h2>
        
        <form id="stockInForm">
            <div class="form-section">
                <h3><i class="fas fa-box"></i> เลือกสินค้า</h3>
                
                <div class="form-group">
                    <label for="stock-in-product">สินค้า *</label>
                    <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="select-container">
                        <select id="stock-in-product" required onchange="updateStockInInfo()"
                            style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none; appearance: none; cursor: pointer;">
                            <option value="">เลือกสินค้า</option>
                            ${products.map(p => `<option value="${p.id}">${p.name} (สต็อกปัจจุบัน: ${p.stock})</option>`).join('')}
                        </select>
                        <i class="fas fa-box" style="position: absolute; right: 45px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px; pointer-events: none;"></i>
                        <i class="fas fa-chevron-down" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 14px; pointer-events: none;"></i>
                    </div>
                </div>

                <div id="stock-in-product-info" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        <div><strong>สต็อกปัจจุบัน:</strong> <span id="current-stock">0</span> ชิ้น</div>
                        <div><strong>ราคา:</strong> <span id="product-price">0</span> บาท</div>
                        <div><strong>หมวดหมู่:</strong> <span id="product-category">-</span></div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3><i class="fas fa-plus-square"></i> ข้อมูลการรับเข้า</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="stock-in-quantity">จำนวนที่รับเข้า *</label>
                        <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                            <input type="number" id="stock-in-quantity" min="1" placeholder="0" required onchange="calculateNewStock()"
                                style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                            <i class="fas fa-plus" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="stock-in-cost">ต้นทุนต่อหน่วย (บาท)</label>
                        <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                            <input type="number" id="stock-in-cost" min="0" step="0.01" placeholder="0.00"
                                style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                            <i class="fas fa-money-bill-wave" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="stock-in-supplier">ผู้จำหน่าย/แหล่งที่มา</label>
                    <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                        <input type="text" id="stock-in-supplier" placeholder="ระบุผู้จำหน่ายหรือแหล่งที่มา"
                            style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                        <i class="fas fa-truck" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                    </div>
                </div>

                <div class="form-group">
                    <label for="stock-in-note">หมายเหตุ</label>
                    <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                        <textarea id="stock-in-note" rows="3" placeholder="หมายเหตุเพิ่มเติม"
                            style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none; resize: vertical; min-height: 80px;"></textarea>
                        <i class="fas fa-sticky-note" style="position: absolute; right: 15px; top: 15px; color: #666; font-size: 16px;"></i>
                    </div>
                </div>

                <div id="stock-calculation" style="display: none; background: linear-gradient(135deg, #d4edda 0%, #ffffff 100%); padding: 20px; border-radius: 15px; border: 2px solid #28a745; margin-top: 20px;">
                    <h4 style="color: #28a745; margin-bottom: 15px;">
                        <i class="fas fa-calculator"></i> สรุปการรับเข้า
                    </h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div><strong>สต็อกปัจจุบัน:</strong> <span id="summary-current">0</span> ชิ้น</div>
                        <div><strong>จำนวนรับเข้า:</strong> <span id="summary-quantity">0</span> ชิ้น</div>
                        <div><strong>สต็อกหลังรับเข้า:</strong> <span id="summary-new" style="color: #28a745; font-weight: 700;">0</span> ชิ้น</div>
                        <div><strong>มูลค่ารวม:</strong> <span id="summary-total-cost" style="color: #2a5298; font-weight: 700;">0</span> บาท</div>
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-save"></i> บันทึกการรับเข้า
                </button>
                <button type="button" class="btn btn-secondary" onclick="showInventoryManagement()">
                    <i class="fas fa-arrow-left"></i> กลับ
                </button>
            </div>
        </form>
    `;

            document.getElementById('product-modal').style.display = 'block';

            // เพิ่ม Event Listener
            document.getElementById('stockInForm').addEventListener('submit', function (e) {
                e.preventDefault();
                processStockIn();
            });

            // ===== ระบบแจ้งเตือนสต็อกต่ำ =====

            // ระบบแจ้งเตือนสต็อกต่ำ
            function checkLowStockAlert() {
                if (!currentUser || currentUser.type !== 'admin') return;

                const lowStockProducts = products.filter(p => p.stock > 0 && p.stock <= 10);
                const outOfStockProducts = products.filter(p => p.stock === 0);

                // แจ้งเตือนสินค้าหมด
                if (outOfStockProducts.length > 0) {
                    setTimeout(() => {
                        showLowStockModal(outOfStockProducts, lowStockProducts);
                    }, 2000);
                }
                // แจ้งเตือนเฉพาะสต็อกต่ำ
                else if (lowStockProducts.length > 0) {
                    setTimeout(() => {
                        showLowStockModal([], lowStockProducts);
                    }, 2000);
                }
            }

            function showLowStockModal(outOfStock, lowStock) {
                const totalIssues = outOfStock.length + lowStock.length;

                if (totalIssues === 0) return;

                let alertHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; box-shadow: 0 15px 40px rgba(0,0,0,0.2); max-width: 600px; margin: 20px auto; border: 3px solid ${outOfStock.length > 0 ? '#dc3545' : '#ffc107'};">
                    <h2 style="color: ${outOfStock.length > 0 ? '#dc3545' : '#856404'}; margin-bottom: 20px; text-align: center;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 48px; display: block; margin-bottom: 15px;"></i>
                        ⚠️ แจ้งเตือนสต็อกสินค้า
                    </h2>
            
                    <div style="background: ${outOfStock.length > 0 ? 'linear-gradient(135deg, #f8d7da, #ffffff)' : 'linear-gradient(135deg, #fff3cd, #ffffff)'}; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                        <div style="text-align: center; margin-bottom: 15px;">
                            <span style="font-size: 24px; font-weight: 700; color: ${outOfStock.length > 0 ? '#dc3545' : '#856404'};">
                                ${totalIssues}
                            </span>
                            <div style="font-size: 16px; color: #666;">รายการที่ต้องดำเนินการ</div>
                        </div>
                    </div>
            `;

                // สินค้าหมด
                if (outOfStock.length > 0) {
                    alertHTML += `
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: #dc3545; margin-bottom: 15px;">
                            <i class="fas fa-times-circle"></i> สินค้าหมด (${outOfStock.length} รายการ)
                        </h3>
                        <div style="max-height: 150px; overflow-y: auto; background: #f8d7da; padding: 15px; border-radius: 10px;">
                            ${outOfStock.map(product => `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid rgba(220,53,69,0.2);">
                                    <span style="font-weight: 600;">${product.name}</span>
                                    <button class="btn btn-success btn-small" onclick="quickStockIn(${product.id}); closeAlert();" style="padding: 5px 10px;">
                                        <i class="fas fa-plus"></i> เติมด่วน
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                }

                // สินค้าสต็อกต่ำ
                if (lowStock.length > 0) {
                    alertHTML += `
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: #856404; margin-bottom: 15px;">
                            <i class="fas fa-exclamation-circle"></i> สต็อกต่ำ (${lowStock.length} รายการ)
                        </h3>
                        <div style="max-height: 150px; overflow-y: auto; background: #fff3cd; padding: 15px; border-radius: 10px;">
                            ${lowStock.map(product => `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid rgba(255,193,7,0.3);">
                                    <div>
                                        <span style="font-weight: 600;">${product.name}</span>
                                        <div style="font-size: 12px; color: #856404;">เหลือ ${product.stock} ชิ้น</div>
                                    </div>
                                    <button class="btn btn-warning btn-small" onclick="quickStockIn(${product.id}); closeAlert();" style="padding: 5px 10px;">
                                        <i class="fas fa-plus"></i> เติม
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                }

                alertHTML += `
                    <div style="text-align: center; margin-top: 25px;">
                        <button class="btn btn-primary" onclick="showInventoryManagement(); closeAlert();" style="margin-right: 10px;">
                            <i class="fas fa-warehouse"></i> ไปจัดการคลัง
                        </button>
                        <button class="btn btn-secondary" onclick="closeAlert()">
                            <i class="fas fa-times"></i> ปิดแจ้งเตือน
                        </button>
                    </div>
            
                    <div style="text-align: center; margin-top: 15px; font-size: 12px; color: #666;">
                        <i class="fas fa-info-circle"></i> การแจ้งเตือนนี้จะแสดงทุกครั้งที่เข้าสู่ระบบจนกว่าจะแก้ไขปัญหา
                    </div>
                </div>
            `;

                // สร้าง overlay
                const overlay = document.createElement('div');
                overlay.id = 'low-stock-alert';
                overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                backdrop-filter: blur(8px);
                z-index: 1002;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
                animation: modalOverlayFadeIn 0.3s ease;
            `;
                overlay.innerHTML = alertHTML;
                document.body.appendChild(overlay);
            }

            function closeAlert() {
                const alert = document.getElementById('low-stock-alert');
                if (alert) {
                    document.body.removeChild(alert);
                }
            }

            setupFormEffects();
        }

        // ฟอร์มจ่ายสินค้าออกคลัง
        function showStockOutForm() {
            // ปิด modal จัดการคลัง
            document.getElementById('inventory-management-modal').style.display = 'none';

            const availableProducts = products.filter(p => p.stock > 0);

            const modalContent = document.getElementById('modal-product-content');
            modalContent.innerHTML = `
        <h2><i class="fas fa-minus-circle"></i> จ่ายสินค้าออกคลัง</h2>
        
        <form id="stockOutForm">
            <div class="form-section">
                <h3><i class="fas fa-box-open"></i> เลือกสินค้า</h3>
                
                <div class="form-group">
                    <label for="stock-out-product">สินค้า *</label>
                    <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="select-container">
                        <select id="stock-out-product" required onchange="updateStockOutInfo()"
                            style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none; appearance: none; cursor: pointer;">
                            <option value="">เลือกสินค้า</option>
                            ${availableProducts.map(p => `<option value="${p.id}">${p.name} (สต็อกปัจจุบัน: ${p.stock})</option>`).join('')}
                        </select>
                        <i class="fas fa-box-open" style="position: absolute; right: 45px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px; pointer-events: none;"></i>
                        <i class="fas fa-chevron-down" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 14px; pointer-events: none;"></i>
                    </div>
                </div>

                <div id="stock-out-product-info" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        <div><strong>สต็อกปัจจุบัน:</strong> <span id="out-current-stock">0</span> ชิ้น</div>
                        <div><strong>ราคา:</strong> <span id="out-product-price">0</span> บาท</div>
                        <div><strong>หมวดหมู่:</strong> <span id="out-product-category">-</span></div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3><i class="fas fa-minus-square"></i> ข้อมูลการจ่ายออก</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="stock-out-quantity">จำนวนที่จ่ายออก *</label>
                        <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                            <input type="number" id="stock-out-quantity" min="1" placeholder="0" required onchange="calculateOutStock()"
                                style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                            <i class="fas fa-minus" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="stock-out-reason">เหตุผลการจ่าย *</label>
                        <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="select-container">
                            <select id="stock-out-reason" required
                                style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none; appearance: none; cursor: pointer;">
                                <option value="">เลือกเหตุผล</option>
                                <option value="sale">ขาย</option>
                                <option value="damaged">สินค้าเสียหาย</option>
                                <option value="expired">สินค้าหมดอายุ</option>
                                <option value="return">คืนสินค้า</option>
                                <option value="transfer">โอนย้าย</option>
                                <option value="other">อื่นๆ</option>
                            </select>
                            <i class="fas fa-question-circle" style="position: absolute; right: 45px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px; pointer-events: none;"></i>
                            <i class="fas fa-chevron-down" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 14px; pointer-events: none;"></i>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="stock-out-recipient">ผู้รับ/หน่วยงาน</label>
                    <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                        <input type="text" id="stock-out-recipient" placeholder="ระบุผู้รับหรือหน่วยงาน"
                            style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                        <i class="fas fa-user-check" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                    </div>
                </div>

                <div class="form-group">
                    <label for="stock-out-note">หมายเหตุ</label>
                    <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                        <textarea id="stock-out-note" rows="3" placeholder="หมายเหตุเพิ่มเติม"
                            style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none; resize: vertical; min-height: 80px;"></textarea>
                        <i class="fas fa-sticky-note" style="position: absolute; right: 15px; top: 15px; color: #666; font-size: 16px;"></i>
                    </div>
                </div>

                <div id="stock-out-calculation" style="display: none; background: linear-gradient(135deg, #fff3cd 0%, #ffffff 100%); padding: 20px; border-radius: 15px; border: 2px solid #ffc107; margin-top: 20px;">
                    <h4 style="color: #856404; margin-bottom: 15px;">
                        <i class="fas fa-calculator"></i> สรุปการจ่ายออก
                    </h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div><strong>สต็อกปัจจุบัน:</strong> <span id="out-summary-current">0</span> ชิ้น</div>
                        <div><strong>จำนวนจ่ายออก:</strong> <span id="out-summary-quantity">0</span> ชิ้น</div>
                        <div><strong>สต็อกหลังจ่าย:</strong> <span id="out-summary-new" style="color: #dc3545; font-weight: 700;">0</span> ชิ้น</div>
                        <div><strong>มูลค่าจ่าย:</strong> <span id="out-summary-value" style="color: #2a5298; font-weight: 700;">0</span> บาท</div>
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button type="submit" class="btn btn-warning">
                    <i class="fas fa-save"></i> บันทึกการจ่ายออก
                </button>
                <button type="button" class="btn btn-secondary" onclick="showInventoryManagement()">
                    <i class="fas fa-arrow-left"></i> กลับ
                </button>
            </div>
        </form>
    `;

            document.getElementById('product-modal').style.display = 'block';

            // เพิ่ม Event Listener
            document.getElementById('stockOutForm').addEventListener('submit', function (e) {
                e.preventDefault();
                processStockOut();
            });

            setupFormEffects();
        }

        // ฟอร์มปรับปรุงสต็อก
        function showStockAdjustForm() {
            // ปิด modal จัดการคลัง
            document.getElementById('inventory-management-modal').style.display = 'none';

            const modalContent = document.getElementById('modal-product-content');
            modalContent.innerHTML = `
        <h2><i class="fas fa-edit"></i> ปรับปรุงสต็อกสินค้า</h2>
        
        <form id="stockAdjustForm">
            <div class="form-section">
                <h3><i class="fas fa-box"></i> เลือกสินค้า</h3>
                
                <div class="form-group">
                    <label for="stock-adjust-product">สินค้า *</label>
                    <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="select-container">
                        <select id="stock-adjust-product" required onchange="updateAdjustInfo()"
                            style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none; appearance: none; cursor: pointer;">
                            <option value="">เลือกสินค้า</option>
                            ${products.map(p => `<option value="${p.id}">${p.name} (สต็อกปัจจุบัน: ${p.stock})</option>`).join('')}
                        </select>
                        <i class="fas fa-box" style="position: absolute; right: 45px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px; pointer-events: none;"></i>
                        <i class="fas fa-chevron-down" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 14px; pointer-events: none;"></i>
                    </div>
                </div>

                <div id="stock-adjust-product-info" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        <div><strong>สต็อกปัจจุบัน:</strong> <span id="adjust-current-stock">0</span> ชิ้น</div>
                        <div><strong>ราคา:</strong> <span id="adjust-product-price">0</span> บาท</div>
                        <div><strong>หมวดหมู่:</strong> <span id="adjust-product-category">-</span></div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3><i class="fas fa-edit"></i> ข้อมูลการปรับปรุง</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="stock-adjust-new">สต็อกใหม่ *</label>
                        <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                            <input type="number" id="stock-adjust-new" min="0" placeholder="0" required onchange="calculateAdjustment()"
                                style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                            <i class="fas fa-edit" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="stock-adjust-reason">เหตุผลการปรับปรุง *</label>
                        <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="select-container">
                            <select id="stock-adjust-reason" required
                                style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none; appearance: none; cursor: pointer;">
                                <option value="">เลือกเหตุผล</option>
                                <option value="count-error">นับสต็อกผิดพลาด</option>
                                <option value="damage">สินค้าเสียหาย</option>
                                <option value="loss">สินค้าสูญหาย</option>
                                <option value="system-error">ข้อผิดพลาดของระบบ</option>
                                <option value="audit">ปรับปรุงจากการตรวจสอบ</option>
                                <option value="other">อื่นๆ</option>
                            </select>
                            <i class="fas fa-question-circle" style="position: absolute; right: 45px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px; pointer-events: none;"></i>
                            <i class="fas fa-chevron-down" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 14px; pointer-events: none;"></i>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="stock-adjust-note">หมายเหตุ *</label>
                    <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                        <textarea id="stock-adjust-note" rows="3" placeholder="อธิบายรายละเอียดการปรับปรุง" required
                            style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none; resize: vertical; min-height: 80px;"></textarea>
                        <i class="fas fa-sticky-note" style="position: absolute; right: 15px; top: 15px; color: #666; font-size: 16px;"></i>
                    </div>
                </div>

                <div id="stock-adjust-calculation" style="display: none; background: linear-gradient(135deg, #e2e3e5 0%, #ffffff 100%); padding: 20px; border-radius: 15px; border: 2px solid #6c757d; margin-top: 20px;">
                    <h4 style="color: #495057; margin-bottom: 15px;">
                        <i class="fas fa-calculator"></i> สรุปการปรับปรุง
                    </h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div><strong>สต็อกปัจจุบัน:</strong> <span id="adjust-summary-current">0</span> ชิ้น</div>
                        <div><strong>สต็อกใหม่:</strong> <span id="adjust-summary-new">0</span> ชิ้น</div>
                        <div><strong>ผลต่าง:</strong> <span id="adjust-summary-diff" style="font-weight: 700;">0</span> ชิ้น</div>
                        <div><strong>ประเภท:</strong> <span id="adjust-summary-type" style="font-weight: 700;">-</span></div>
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button type="submit" class="btn btn-info">
                    <i class="fas fa-save"></i> บันทึกการปรับปรุง
                </button>
                <button type="button" class="btn btn-secondary" onclick="showInventoryManagement()">
                    <i class="fas fa-arrow-left"></i> กลับ
                </button>
            </div>
        </form>
    `;

            document.getElementById('product-modal').style.display = 'block';

            // เพิ่ม Event Listener
            document.getElementById('stockAdjustForm').addEventListener('submit', function (e) {
                e.preventDefault();
                processStockAdjust();
            });

            setupFormEffects();
        }

        // รายงานประวัติการเคลื่อนไหว
        function showStockHistory() {
            // ปิด modal จัดการคลัง
            document.getElementById('inventory-management-modal').style.display = 'none';

            const modalContent = document.getElementById('modal-product-content');
            modalContent.innerHTML = `
        <h2><i class="fas fa-history"></i> ประวัติการเคลื่อนไหวสต็อก</h2>
        
        <!-- ตัวกรอง -->
        <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; margin-bottom: 25px;">
            <h3 style="color: #2a5298; margin-bottom: 15px;">
                <i class="fas fa-filter"></i> ตัวกรองข้อมูล
            </h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">สินค้า:</label>
                    <select id="history-product-filter" onchange="filterStockHistory()" style="width: 100%; padding: 8px; border-radius: 6px;">
                        <option value="">ทุกสินค้า</option>
                        ${products.map(p => `<option value="${p.id}">${p.name}</option>`).join('')}
                    </select>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">ประเภท:</label>
                    <select id="history-type-filter" onchange="filterStockHistory()" style="width: 100%; padding: 8px; border-radius: 6px;">
                        <option value="">ทุกประเภท</option>
                        <option value="in">รับเข้า</option>
                        <option value="out">จ่ายออก</option>
                        <option value="adjust">ปรับปรุง</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">วันที่เริ่มต้น:</label>
                    <input type="date" id="history-date-from" onchange="filterStockHistory()" style="width: 100%; padding: 8px; border-radius: 6px;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">วันที่สิ้นสุด:</label>
                    <input type="date" id="history-date-to" onchange="filterStockHistory()" style="width: 100%; padding: 8px; border-radius: 6px;">
                </div>
            </div>
        </div>

        <!-- สถิติสรุป -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 25px;">
            <div style="background: linear-gradient(45deg, #28a745, #20c997); color: white; padding: 15px; border-radius: 10px; text-align: center;">
                <div style="font-size: 24px; font-weight: 700;" id="history-in-count">0</div>
                <div style="font-size: 12px; opacity: 0.9;">ครั้งรับเข้า</div>
            </div>
            <div style="background: linear-gradient(45deg, #ffc107, #ffca2c); color: #333; padding: 15px; border-radius: 10px; text-align: center;">
                <div style="font-size: 24px; font-weight: 700;" id="history-out-count">0</div>
                <div style="font-size: 12px; opacity: 0.8;">ครั้งจ่ายออก</div>
            </div>
            <div style="background: linear-gradient(45deg, #17a2b8, #138496); color: white; padding: 15px; border-radius: 10px; text-align: center;">
                <div style="font-size: 24px; font-weight: 700;" id="history-adjust-count">0</div>
                <div style="font-size: 12px; opacity: 0.9;">ครั้งปรับปรุง</div>
            </div>
            <div style="background: linear-gradient(45deg, #2a5298, #1e3c72); color: white; padding: 15px; border-radius: 10px; text-align: center;">
                <div style="font-size: 24px; font-weight: 700;" id="history-total-count">0</div>
                <div style="font-size: 12px; opacity: 0.9;">รวมทั้งหมด</div>
            </div>
        </div>
        
        <!-- ตารางประวัติ -->
        <div style="max-height: 500px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 10px;">
            <table class="table" style="margin: 0;">
                <thead style="position: sticky; top: 0; background: #f8f9fa; z-index: 10;">
                    <tr>
                        <th>วันเวลา</th>
                        <th>สินค้า</th>
                        <th>ประเภท</th>
                        <th>จำนวน</th>
                        <th>สต็อกก่อน</th>
                        <th>สต็อกหลัง</th>
                        <th>ผู้ดำเนินการ</th>
                        <th>หมายเหตุ</th>
                    </tr>
                </thead>
                <tbody id="stock-history-table">
                    <!-- ข้อมูลประวัติจะถูกโหลดที่นี่ -->
                </tbody>
            </table>
        </div>
        
        <div class="button-group" style="margin-top: 25px;">
            <button class="btn btn-success" onclick="exportStockHistory()">
                <i class="fas fa-download"></i> Export Excel
            </button>
            <button class="btn btn-secondary" onclick="showInventoryManagement()">
                <i class="fas fa-arrow-left"></i> กลับ
            </button>
        </div>
    `;

            document.getElementById('product-modal').style.display = 'block';

            // โหลดข้อมูลประวัติ
            loadStockHistoryTable();
        }

        function showSettings() {
            // ปิด modal อื่นๆ ทั้งหมดก่อน
            document.getElementById('product-management-modal').style.display = 'none';
            document.getElementById('order-management-modal').style.display = 'none';
            document.getElementById('payment-management-modal').style.display = 'none';
            document.getElementById('user-management-modal').style.display = 'none';
            document.getElementById('reports-modal').style.display = 'none';
            document.getElementById('inventory-management-modal').style.display = 'none';

            const modalContent = document.getElementById('modal-product-content');
            modalContent.innerHTML = `
        <h2><i class="fas fa-cog"></i> ตั้งค่าระบบ</h2>
        
        <!-- Tabs Navigation -->
        <div class="profile-tabs" style="margin-bottom: 30px; justify-content: center;">
            <button class="tab-btn active" onclick="showSettingsTab('general')">
                <i class="fas fa-cogs"></i> ทั่วไป
            </button>
            <button class="tab-btn" onclick="showSettingsTab('shop')">
                <i class="fas fa-store"></i> ร้านค้า
            </button>
            <button class="tab-btn" onclick="showSettingsTab('categories')">
                <i class="fas fa-tags"></i> หมวดหมู่
            </button>
            <button class="tab-btn" onclick="showSettingsTab('notifications')">
                <i class="fas fa-bell"></i> แจ้งเตือน
            </button>
            <button class="tab-btn" onclick="showSettingsTab('system')">
                <i class="fas fa-database"></i> ระบบ
            </button>
        </div>

        <!-- Tab Content Container -->
        <div style="max-width: 800px; margin: 0 auto;">
            
            <!-- ตั้งค่าทั่วไป -->
            <div id="settings-tab-general" class="tab-content active">
                <div class="form-section">
                    <h3><i class="fas fa-university"></i> ข้อมูลมหาวิทยาลัย</h3>
                    
                    <div class="form-group">
                        <label for="uni-name-th">ชื่อมหาวิทยาลัย (ไทย)</label>
                        <input type="text" id="uni-name-th" value="มหาวิทยาลัยเทคโนโลยีราชมงคลอีสาน" 
                               style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                    </div>

                    <div class="form-group">
                        <label for="uni-name-en">ชื่อมหาวิทยาลัย (อังกฤษ)</label>
                        <input type="text" id="uni-name-en" value="Rajamangala University of Technology Isan" 
                               style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                    </div>

                    <div class="form-group">
                        <label for="campus-name">วิทยาเขต</label>
                        <input type="text" id="campus-name" value="ขอนแก่น" 
                               style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-globe"></i> ตั้งค่าภาษาและเวลา</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="default-language">ภาษาหลัก</label>
                            <select id="default-language" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                                <option value="th" selected>ไทย</option>
                                <option value="en">English</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="timezone">เขตเวลา</label>
                            <select id="timezone" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                                <option value="Asia/Bangkok" selected>เวลาประเทศไทย (GMT+7)</option>
                                <option value="UTC">UTC (GMT+0)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-success" onclick="saveGeneralSettings()">
                        <i class="fas fa-save"></i> บันทึกการตั้งค่า
                    </button>
                </div>
            </div>

            <!-- ตั้งค่าร้านค้า -->
            <div id="settings-tab-shop" class="tab-content">
                <div class="form-section">
                    <h3><i class="fas fa-store-alt"></i> ข้อมูลร้านค้า</h3>
                    
                    <div class="form-group">
                        <label for="shop-name">ชื่อร้านค้า</label>
                        <input type="text" id="shop-name" value="RMUTI KKC SHOP" 
                               style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                    </div>

                    <div class="form-group">
                        <label for="shop-description">รายละเอียดร้านค้า</label>
                        <textarea id="shop-description" rows="3" 
                                  style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; resize: vertical;">ร้านค้ามหาวิทยาลัยเทคโนโลยีราชมงคลอีสาน วิทยาเขตขอนแก่น จำหน่ายเครื่องแบบนักศึกษา อุปกรณ์การเรียน และของที่ระลึก</textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="shop-phone">เบอร์โทรติดต่อ</label>
                            <input type="tel" id="shop-phone" value="043-336-000 ต่อ 1234" 
                                   style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                        </div>
                        <div class="form-group">
                            <label for="shop-email">อีเมลติดต่อ</label>
                            <input type="email" id="shop-email" value="shop@rmuti.ac.th" 
                                   style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-credit-card"></i> ข้อมูลบัญชีธนาคาร</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="bank-name">ธนาคาร</label>
                            <input type="text" id="bank-name" value="ธนาคารกรุงไทย" 
                                   style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                        </div>
                        <div class="form-group">
                            <label for="bank-account">เลขที่บัญชี</label>
                            <input type="text" id="bank-account" value="123-4-56789-0" 
                                   style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="bank-account-name">ชื่อบัญชี</label>
                        <input type="text" id="bank-account-name" value="มหาวิทยาลัยเทคโนโลยีราชมงคลอีสาน วิทยาเขตขอนแก่น" 
                               style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                    </div>

                    <div class="form-group">
                        <label for="promptpay-id">พร้อมเพย์</label>
                        <input type="text" id="promptpay-id" value="0123456789" 
                               style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-clock"></i> เวลาทำการ</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="opening-time">เวลาเปิด</label>
                            <input type="time" id="opening-time" value="08:00" 
                                   style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                        </div>
                        <div class="form-group">
                            <label for="closing-time">เวลาปิด</label>
                            <input type="time" id="closing-time" value="16:00" 
                                   style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>วันทำการ</label>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; margin-top: 10px;">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" checked> จันทร์
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" checked> อังคาร
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" checked> พุธ
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" checked> พฤหัสบดี
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" checked> ศุกร์
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox"> เสาร์
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox"> อาทิตย์
                            </label>
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-success" onclick="saveShopSettings()">
                        <i class="fas fa-save"></i> บันทึกการตั้งค่า
                    </button>
                </div>
            </div>

            <!-- จัดการหมวดหมู่ -->
            <div id="settings-tab-categories" class="tab-content">
                <div class="form-section">
                    <h3><i class="fas fa-plus-circle"></i> เพิ่มหมวดหมู่ใหม่</h3>
                    
                    <div class="form-row">
                        <div class="form-group" style="flex: 2;">
                            <label for="new-category-name">ชื่อหมวดหมู่</label>
                            <input type="text" id="new-category-name" placeholder="กรอกชื่อหมวดหมู่ใหม่" 
                                   style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label for="new-category-icon">ไอคอน</label>
                            <select id="new-category-icon" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                                <option value="📚">📚 หนังสือ/เรียน</option>
                                <option value="👔">👔 เครื่องแบบ</option>
                                <option value="🎽">🎽 กิจกรรม/กีฬา</option>
                                <option value="🎁">🎁 ของขวัญ/ระลึก</option>
                                <option value="💻">💻 เทคโนโลยี</option>
                                <option value="🍔">🍔 อาหาร/เครื่องดื่ม</option>
                                <option value="🏠">🏠 ที่อยู่อาศัย</option>
                                <option value="✏️">✏️ เครื่องเขียน</option>
                                <option value="🎨">🎨 ศิลปะ/งานฝีมือ</option>
                                <option value="⚽">⚽ กีฬา</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 0;">
                            <label>&nbsp;</label>
                            <button class="btn btn-primary" onclick="addNewCategory()" style="width: 100%; padding: 12px;">
                                <i class="fas fa-plus"></i> เพิ่ม
                            </button>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-list"></i> หมวดหมู่ที่มีอยู่</h3>
                    
                    <div id="categories-list" style="background: #f8f9fa; padding: 20px; border-radius: 10px; max-height: 300px; overflow-y: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; margin-bottom: 10px; background: white; border-radius: 8px; border: 1px solid #dee2e6;">
                            <span><strong>📚 อุปกรณ์การเรียน</strong></span>
                            <div>
                                <button class="btn btn-warning btn-small" onclick="editCategory('Learning Supplies')" style="margin-right: 5px;">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger btn-small" onclick="deleteCategory('Learning Supplies')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; margin-bottom: 10px; background: white; border-radius: 8px; border: 1px solid #dee2e6;">
                            <span><strong>👔 เครื่องแบบนักศึกษา</strong></span>
                            <div>
                                <button class="btn btn-warning btn-small" onclick="editCategory('Student Uniform')" style="margin-right: 5px;">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger btn-small" onclick="deleteCategory('Student Uniform')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; margin-bottom: 10px; background: white; border-radius: 8px; border: 1px solid #dee2e6;">
                            <span><strong>🎽 เสื้อกิจกรรม</strong></span>
                            <div>
                                <button class="btn btn-warning btn-small" onclick="editCategory('Activity')" style="margin-right: 5px;">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger btn-small" onclick="deleteCategory('Activity')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; margin-bottom: 10px; background: white; border-radius: 8px; border: 1px solid #dee2e6;">
                            <span><strong>🎁 ของที่ระลึก</strong></span>
                            <div>
                                <button class="btn btn-warning btn-small" onclick="editCategory('Souvenirs')" style="margin-right: 5px;">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger btn-small" onclick="deleteCategory('Souvenirs')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-info" onclick="refreshCategoriesList()">
                        <i class="fas fa-sync-alt"></i> รีเฟรช
                    </button>
                </div>
            </div>

            <!-- ตั้งค่าการแจ้งเตือน -->
            <div id="settings-tab-notifications" class="tab-content">
                <div class="form-section">
                    <h3><i class="fas fa-bell"></i> การแจ้งเตือนสำหรับนักศึกษา</h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 15px; align-items: center;">
                        <div>
                            <label style="font-weight: 600;">แจ้งเตือนเมื่อสถานะคำสั่งซื้อเปลี่ยนแปลง</label>
                            <small style="color: #666; display: block;">ส่งการแจ้งเตือนเมื่อมีการอัพเดทสถานะคำสั่งซื้อ</small>
                        </div>
                        <label class="switch">
                            <input type="checkbox" checked>
                            <span class="slider" style="position: relative; display: inline-block; width: 50px; height: 24px; background-color: #ccc; border-radius: 24px; cursor: pointer; transition: .4s;">
                                <span style="position: absolute; content: ''; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; border-radius: 50%; transition: .4s;"></span>
                            </span>
                        </label>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 15px; align-items: center; margin-top: 20px;">
                        <div>
                            <label style="font-weight: 600;">แจ้งเตือนเมื่อมีสินค้าใหม่</label>
                            <small style="color: #666; display: block;">ส่งการแจ้งเตือนเมื่อมีสินค้าใหม่เข้ามาในร้าน</small>
                        </div>
                        <label class="switch">
                            <input type="checkbox" checked>
                            <span class="slider" style="position: relative; display: inline-block; width: 50px; height: 24px; background-color: #28a745; border-radius: 24px; cursor: pointer; transition: .4s;">
                                <span style="position: absolute; content: ''; height: 18px; width: 18px; right: 3px; bottom: 3px; background-color: white; border-radius: 50%; transition: .4s;"></span>
                            </span>
                        </label>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 15px; align-items: center; margin-top: 20px;">
                        <div>
                            <label style="font-weight: 600;">แจ้งเตือนโปรโมชั่นและส่วนลด</label>
                            <small style="color: #666; display: block;">ส่งข้อมูลโปรโมชั่นและส่วนลดพิเศษ</small>
                        </div>
                        <label class="switch">
                            <input type="checkbox">
                            <span class="slider" style="position: relative; display: inline-block; width: 50px; height: 24px; background-color: #ccc; border-radius: 24px; cursor: pointer; transition: .4s;">
                                <span style="position: absolute; content: ''; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; border-radius: 50%; transition: .4s;"></span>
                            </span>
                        </label>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-user-tie"></i> การแจ้งเตือนสำหรับเจ้าหน้าที่</h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 15px; align-items: center;">
                        <div>
                            <label style="font-weight: 600;">แจ้งเตือนคำสั่งซื้อใหม่</label>
                            <small style="color: #666; display: block;">แจ้งเตือนทันทีเมื่อมีคำสั่งซื้อใหม่</small>
                        </div>
                        <label class="switch">
                            <input type="checkbox" checked>
                            <span class="slider" style="position: relative; display: inline-block; width: 50px; height: 24px; background-color: #28a745; border-radius: 24px; cursor: pointer; transition: .4s;">
                                <span style="position: absolute; content: ''; height: 18px; width: 18px; right: 3px; bottom: 3px; background-color: white; border-radius: 50%; transition: .4s;"></span>
                            </span>
                        </label>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 15px; align-items: center; margin-top: 20px;">
                        <div>
                            <label style="font-weight: 600;">แจ้งเตือนสต็อกต่ำ</label>
                            <small style="color: #666; display: block;">แจ้งเตือนเมื่อสินค้าใกล้หมดหรือสต็อกต่ำกว่า 10 ชิ้น</small>
                        </div>
                        <label class="switch">
                            <input type="checkbox" checked>
                            <span class="slider" style="position: relative; display: inline-block; width: 50px; height: 24px; background-color: #28a745; border-radius: 24px; cursor: pointer; transition: .4s;">
                                <span style="position: absolute; content: ''; height: 18px; width: 18px; right: 3px; bottom: 3px; background-color: white; border-radius: 50%; transition: .4s;"></span>
                            </span>
                        </label>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 15px; align-items: center; margin-top: 20px;">
                        <div>
                            <label style="font-weight: 600;">รายงานประจำวัน</label>
                            <small style="color: #666; display: block;">ส่งสรุปยอดขายและสถิติประจำวัน</small>
                        </div>
                        <label class="switch">
                            <input type="checkbox">
                            <span class="slider" style="position: relative; display: inline-block; width: 50px; height: 24px; background-color: #ccc; border-radius: 24px; cursor: pointer; transition: .4s;">
                                <span style="position: absolute; content: ''; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; border-radius: 50%; transition: .4s;"></span>
                            </span>
                        </label>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-sliders-h"></i> ระดับการแจ้งเตือนสต็อก</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="low-stock-threshold">เตือนสต็อกต่ำเมื่อเหลือ (ชิ้น)</label>
                            <input type="number" id="low-stock-threshold" value="10" min="1" 
                                   style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                        </div>
                        <div class="form-group">
                            <label for="critical-stock-threshold">เตือนสต็อกวิกฤตเมื่อเหลือ (ชิ้น)</label>
                            <input type="number" id="critical-stock-threshold" value="3" min="0" 
                                   style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-success" onclick="saveNotificationSettings()">
                        <i class="fas fa-save"></i> บันทึกการตั้งค่า
                    </button>
                </div>
            </div>

            <!-- ตั้งค่าระบบ -->
            <div id="settings-tab-system" class="tab-content">
                <div class="form-section">
                    <h3><i class="fas fa-database"></i> การจัดการข้อมูล</h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div style="background: #e8f5e8; padding: 20px; border-radius: 10px; text-align: center; border: 2px solid #28a745;">
                            <i class="fas fa-download" style="font-size: 32px; color: #28a745; margin-bottom: 10px;"></i>
                            <h4 style="color: #28a745; margin-bottom: 10px;">สำรองข้อมูล</h4>
                            <p style="font-size: 14px; color: #155724; margin-bottom: 15px;">ดาวน์โหลดข้อมูลระบบทั้งหมด</p>
                            <button class="btn btn-success" onclick="exportSystemData()">
                                <i class="fas fa-download"></i> สำรองข้อมูล
                            </button>
                        </div>
                        
                        <div style="background: #fff3cd; padding: 20px; border-radius: 10px; text-align: center; border: 2px solid #ffc107;">
                            <i class="fas fa-upload" style="font-size: 32px; color: #856404; margin-bottom: 10px;"></i>
                            <h4 style="color: #856404; margin-bottom: 10px;">คืนค่าข้อมูล</h4>
                            <p style="font-size: 14px; color: #856404; margin-bottom: 15px;">นำเข้าข้อมูลจากไฟล์สำรอง</p>
                            <input type="file" id="import-file" accept=".json" style="margin-bottom: 10px;">
                            <br>
                            <button class="btn btn-warning" onclick="importSystemData()">
                                <i class="fas fa-upload"></i> คืนค่าข้อมูล
                            </button>
                        </div>
                        
                        <div style="background: #f8d7da; padding: 20px; border-radius: 10px; text-align: center; border: 2px solid #dc3545;">
                            <i class="fas fa-trash-alt" style="font-size: 32px; color: #dc3545; margin-bottom: 10px;"></i>
                            <h4 style="color: #dc3545; margin-bottom: 10px;">ล้างข้อมูล</h4>
                            <p style="font-size: 14px; color: #721c24; margin-bottom: 15px;">ลบข้อมูลทั้งหมดในระบบ</p>
                            <button class="btn btn-danger" onclick="clearSystemData()">
                                <i class="fas fa-exclamation-triangle"></i> ล้างข้อมูล
                            </button>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-chart-line"></i> สถิติระบบ</h3>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px;">
                            <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: 700; color: #2a5298;">${products.length}</div>
                                <div style="font-size: 14px; color: #666;">สินค้าทั้งหมด</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: 700; color: #17a2b8;">${orders.length}</div>
                                <div style="font-size: 14px; color: #666;">คำสั่งซื้อทั้งหมด</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: 700; color: #28a745;">${Object.keys(users.students).length}</div>
                                <div style="font-size: 14px; color: #666;">นักศึกษาลงทะเบียน</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: 700; color: #dc3545;">${Object.keys(users.admins).length}</div>
                                <div style="font-size: 14px; color: #666;">เจ้าหน้าที่</div>
                            </div>
                        </div>
                        
                        <div style="text-align: center;">
                            <small style="color: #666;">
                                <i class="fas fa-info-circle"></i> 
                                ข้อมูลอัพเดทล่าสุด: ${getCurrentDateTime()}
                            </small>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-cog"></i> การตั้งค่าขั้นสูง</h3>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" style="margin-right: 10px;">
                            เปิดใช้งาน Debug Mode (สำหรับการพัฒนา)
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" checked style="margin-right: 10px;">
                            บันทึก Log การใช้งานระบบ
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" checked style="margin-right: 10px;">
                            อัพเดทข้อมูลแบบ Real-time
                        </label>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="session-timeout">Session Timeout (นาที)</label>
                            <input type="number" id="session-timeout" value="30" min="5" max="480" 
                                   style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                        </div>
                        <div class="form-group">
                            <label for="max-file-size">ขนาดไฟล์สูงสุด (MB)</label>
                            <input type="number" id="max-file-size" value="5" min="1" max="50" 
                                   style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-success" onclick="saveSystemSettings()">
                        <i class="fas fa-save"></i> บันทึกการตั้งค่า
                    </button>
                    <button class="btn btn-info" onclick="restoreDefaultSettings()">
                        <i class="fas fa-undo"></i> คืนค่าเริ่มต้น
                    </button>
                </div>
            </div>
        </div>

        <div class="button-group" style="margin-top: 30px; border-top: 1px solid #dee2e6; padding-top: 20px;">
            <button class="btn btn-secondary" onclick="closeModal()">
                <i class="fas fa-times"></i> ปิด
            </button>
        </div>
    `;

            document.getElementById('product-modal').style.display = 'block';
            setupSettingsEffects();
        }

        // ฟังก์ชันแสดงแท็บการตั้งค่า
        function showSettingsTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('#product-modal .tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));

            const tabButtons = document.querySelectorAll('#product-modal .tab-btn');
            tabButtons.forEach(btn => btn.classList.remove('active'));

            // Show selected tab
            document.getElementById(`settings-tab-${tabName}`).classList.add('active');
            event.target.classList.add('active');
        }

        // ตั้งค่า Effects สำหรับฟอร์ม Settings
        function setupSettingsEffects() {
            // Switch toggle effects
            const switches = document.querySelectorAll('.switch input[type="checkbox"]');
            switches.forEach(switchInput => {
                switchInput.addEventListener('change', function () {
                    const slider = this.nextElementSibling;
                    const sliderDot = slider.querySelector('span');

                    if (this.checked) {
                        slider.style.backgroundColor = '#28a745';
                        sliderDot.style.transform = 'translateX(26px)';
                    } else {
                        slider.style.backgroundColor = '#ccc';
                        sliderDot.style.transform = 'translateX(0)';
                    }
                });

                // Set initial state
                const slider = switchInput.nextElementSibling;
                const sliderDot = slider.querySelector('span');

                if (switchInput.checked) {
                    slider.style.backgroundColor = '#28a745';
                    sliderDot.style.transform = 'translateX(26px)';
                } else {
                    slider.style.backgroundColor = '#ccc';
                    sliderDot.style.transform = 'translateX(0)';
                }
            });
        }

        // ฟังก์ชันบันทึกการตั้งค่าทั่วไป
        function saveGeneralSettings() {
            const settings = {
                uniNameTh: document.getElementById('uni-name-th').value,
                uniNameEn: document.getElementById('uni-name-en').value,
                campusName: document.getElementById('campus-name').value,
                defaultLanguage: document.getElementById('default-language').value,
                timezone: document.getElementById('timezone').value
            };

            showNotification('✅ บันทึกการตั้งค่าทั่วไปเรียบร้อยแล้ว!', 'success');
            console.log('General Settings:', settings);
        }

        // ฟังก์ชันบันทึกการตั้งค่าร้านค้า
        function saveShopSettings() {
            const settings = {
                shopName: document.getElementById('shop-name').value,
                shopDescription: document.getElementById('shop-description').value,
                shopPhone: document.getElementById('shop-phone').value,
                shopEmail: document.getElementById('shop-email').value,
                bankName: document.getElementById('bank-name').value,
                bankAccount: document.getElementById('bank-account').value,
                bankAccountName: document.getElementById('bank-account-name').value,
                promptPayId: document.getElementById('promptpay-id').value,
                openingTime: document.getElementById('opening-time').value,
                closingTime: document.getElementById('closing-time').value
            };

            showNotification('🏪 บันทึกการตั้งค่าร้านค้าเรียบร้อยแล้ว!', 'success');
            console.log('Shop Settings:', settings);
        }

        // ฟังก์ชันเพิ่มหมวดหมู่ใหม่
        function addNewCategory() {
            const name = document.getElementById('new-category-name').value.trim();
            const icon = document.getElementById('new-category-icon').value;

            if (!name) {
                showNotification('⚠️ กรุณากรอกชื่อหมวดหมู่', 'error');
                return;
            }

            showNotification(`✅ เพิ่มหมวดหมู่ "${icon} ${name}" เรียบร้อยแล้ว!`, 'success');
            document.getElementById('new-category-name').value = '';
            refreshCategoriesList();
        }

        // ฟังก์ชันแก้ไขหมวดหมู่
        function editCategory(categoryId) {
            const newName = prompt('แก้ไขชื่อหมวดหมู่:', categoryId);
            if (newName && newName.trim()) {
                showNotification(`✅ แก้ไขหมวดหมู่เป็น "${newName}" เรียบร้อยแล้ว!`, 'success');
                refreshCategoriesList();
            }
        }

        // ฟังก์ชันลบหมวดหมู่
        function deleteCategory(categoryId) {
            if (confirm(`ต้องการลบหมวดหมู่ "${categoryId}" หรือไม่?\n\n⚠️ หมายเหตุ: สินค้าในหมวดหมู่นี้จะยังคงอยู่ แต่จะไม่มีหมวดหมู่`)) {
                showNotification(`🗑️ ลบหมวดหมู่ "${categoryId}" เรียบร้อยแล้ว!`, 'info');
                refreshCategoriesList();
            }
        }

        // ฟังก์ชันรีเฟรชรายการหมวดหมู่
        function refreshCategoriesList() {
            showNotification('🔄 รีเฟรชรายการหมวดหมู่เรียบร้อยแล้ว!', 'info');
        }

        // ฟังก์ชันบันทึกการตั้งค่าการแจ้งเตือน
        function saveNotificationSettings() {
            const lowStockThreshold = document.getElementById('low-stock-threshold').value;
            const criticalStockThreshold = document.getElementById('critical-stock-threshold').value;

            const settings = {
                lowStockThreshold: parseInt(lowStockThreshold),
                criticalStockThreshold: parseInt(criticalStockThreshold)
            };

            showNotification('🔔 บันทึกการตั้งค่าการแจ้งเตือนเรียบร้อยแล้ว!', 'success');
            console.log('Notification Settings:', settings);
        }

        // ฟังก์ชันส่งออกข้อมูลระบบ
        function exportSystemData() {
            const systemData = {
                products: products,
                orders: orders,
                users: users,
                stockMovements: stockMovements,
                notifications: notifications,
                exportDate: new Date().toISOString()
            };

            const dataStr = JSON.stringify(systemData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });

            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `RMUTI_Shop_Backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();

            showNotification('📥 ดาวน์โหลดไฟล์สำรองข้อมูลเรียบร้อยแล้ว!', 'success');
        }

        // ฟังก์ชันนำเข้าข้อมูลระบบ
        function importSystemData() {
            const fileInput = document.getElementById('import-file');
            const file = fileInput.files[0];

            if (!file) {
                showNotification('⚠️ กรุณาเลือกไฟล์ที่ต้องการนำเข้า', 'error');
                return;
            }

            if (!confirm('⚠️ การนำเข้าข้อมูลจะเขียนทับข้อมูลปัจจุบันทั้งหมด\n\nต้องการดำเนินการต่อหรือไม่?')) {
                return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const data = JSON.parse(e.target.result);

                    // Validate data structure
                    if (!data.products || !data.orders || !data.users) {
                        throw new Error('ไฟล์ข้อมูลไม่ถูกต้อง');
                    }

                    showNotification('📤 กำลังนำเข้าข้อมูล...', 'info');

                    setTimeout(() => {
                        // This would normally restore the data
                        showNotification('✅ นำเข้าข้อมูลเรียบร้อยแล้ว!\n\n🔄 กรุณาโหลดหน้าเว็บใหม่เพื่อดูการเปลี่ยนแปลง', 'success');
                        console.log('Imported Data:', data);
                    }, 1000);

                } catch (error) {
                    showNotification('❌ เกิดข้อผิดพลาดในการอ่านไฟล์\n\nกรุณาตรวจสอบรูปแบบไฟล์', 'error');
                }
            };
            reader.readAsText(file);
        }

        // ฟังก์ชันล้างข้อมูลระบบ
        function clearSystemData() {
            if (!confirm('⚠️ คำเตือน: การล้างข้อมูลจะลบทุกอย่างในระบบ\n\nรวมถึง:\n• ข้อมูลสินค้าทั้งหมด\n• คำสั่งซื้อทั้งหมด\n• ข้อมูลผู้ใช้ (ยกเว้น Admin หลัก)\n• ประวัติการทำงานทั้งหมด\n\n❌ การดำเนินการนี้ไม่สามารถยกเลิกได้!\n\nต้องการดำเนินการหรือไม่?')) {
                return;
            }

            const confirmText = prompt('กรุณาพิมพ์ "CLEAR ALL DATA" เพื่อยืนยัน:');
            if (confirmText !== 'CLEAR ALL DATA') {
                showNotification('❌ ยกเลิกการล้างข้อมูล', 'info');
                return;
            }

            showNotification('🗑️ กำลังล้างข้อมูล...', 'warning');

            setTimeout(() => {
                showNotification('✅ ล้างข้อมูลระบบเรียบร้อยแล้ว!\n\n🔄 กรุณาโหลดหน้าเว็บใหม่', 'success');
                console.log('System data cleared');
            }, 2000);
        }

        // ฟังก์ชันบันทึกการตั้งค่าระบบ
        function saveSystemSettings() {
            const settings = {
                sessionTimeout: parseInt(document.getElementById('session-timeout').value),
                maxFileSize: parseInt(document.getElementById('max-file-size').value)
            };

            showNotification('⚙️ บันทึกการตั้งค่าระบบเรียบร้อยแล้ว!', 'success');
            console.log('System Settings:', settings);
        }

        // ฟังก์ชันคืนค่าเริ่มต้น
        function restoreDefaultSettings() {
            if (confirm('คืนค่าการตั้งค่าทั้งหมดเป็นค่าเริ่มต้นหรือไม่?')) {
                showNotification('🔄 คืนค่าการตั้งค่าเป็นค่าเริ่มต้นเรียบร้อยแล้ว!', 'info');

                // Reset form values
                document.getElementById('session-timeout').value = '30';
                document.getElementById('max-file-size').value = '5';
                document.getElementById('low-stock-threshold').value = '10';
                document.getElementById('critical-stock-threshold').value = '3';
            }
        }

        function setupAddProductFormEffects() {
            // เพิ่ม focus effects สำหรับ input และ select
            const inputContainers = document.querySelectorAll('#product-modal .input-container');
            const selectContainers = document.querySelectorAll('#product-modal .select-container');

            inputContainers.forEach(container => {
                const input = container.querySelector('input, textarea');
                if (input) {
                    input.addEventListener('focus', function () {
                        container.style.borderColor = '#2a5298';
                        container.style.boxShadow = '0 0 15px rgba(42, 82, 152, 0.2)';
                        container.style.transform = 'translateY(-2px)';
                    });

                    input.addEventListener('blur', function () {
                        container.style.borderColor = '#e9ecef';
                        container.style.boxShadow = 'none';
                        container.style.transform = 'translateY(0)';
                    });
                }
            });
        }

        function showAddProductForm() {
            // ปิด modal อื่นๆ
            document.getElementById('product-management-modal').style.display = 'none';

            const modalContent = document.getElementById('modal-product-content');
            modalContent.innerHTML = `
                <h2><i class="fas fa-plus"></i> เพิ่มสินค้าใหม่</h2>
        
                <form id="addProductForm">
                    <div class="form-group">
                        <label for="product-name">ชื่อสินค้า *</label>
                        <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                            <input type="text" id="product-name" placeholder="กรอกชื่อสินค้า" required 
                                style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                            <i class="fas fa-tag" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                        </div>
                    </div>
            
                    <div class="form-group">
                        <label for="product-description">รายละเอียดสินค้า *</label>
                        <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                            <textarea id="product-description" rows="3" placeholder="กรอกรายละเอียดสินค้า" required 
                                style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none; resize: vertical; min-height: 80px;"></textarea>
                            <i class="fas fa-align-left" style="position: absolute; right: 15px; top: 15px; color: #666; font-size: 16px;"></i>
                        </div>
                    </div>
            
                    <div class="form-row">
                        <div class="form-group">
                            <label for="product-price">ราคา (บาท) *</label>
                            <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                                <input type="number" id="product-price" placeholder="0" min="0" step="0.01" required 
                                    style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                                <i class="fas fa-money-bill-wave" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="product-stock">จำนวนสต็อก *</label>
                            <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                                <input type="number" id="product-stock" placeholder="0" min="0" required 
                                    style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                                <i class="fas fa-boxes" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                            </div>
                        </div>
                    </div>
            
                    <div class="form-group">
                        <label for="product-category">หมวดหมู่ *</label>
                        <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="select-container">
                            <select id="product-category" required 
                                style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none; appearance: none; cursor: pointer;">
                                <option value="">เลือกหมวดหมู่</option>
                                <option value="Learning Supplies">📚 อุปกรณ์การเรียน</option>
                                <option value="Student Uniform">👔 เครื่องแบบนักศึกษา</option>
                                <option value="Activity">🎽 เสื้อกิจกรรม</option>
                                <option value="Souvenirs">🎁 ของที่ระลึก</option>
                            </select>
                            <i class="fas fa-list" style="position: absolute; right: 45px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px; pointer-events: none;"></i>
                            <i class="fas fa-chevron-down" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 14px; pointer-events: none;"></i>
                        </div>
                    </div>
            
                    <div class="form-group">
                        <label for="product-image">รูปภาพสินค้า *</label>
                        <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                            <input type="file" id="product-image" accept="image/*" required 
                                style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none; cursor: pointer;">
                            <i class="fas fa-image" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px; pointer-events: none;"></i>
                        </div>
                        <small style="color: #666; font-size: 12px; display: block; margin-top: 8px;">
                            <i class="fas fa-info-circle"></i> รองรับไฟล์ JPG, PNG ขนาดไม่เกิน 5MB
                        </small>
                    </div>
            
                    <div class="button-group">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> บันทึกสินค้า
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="showProductManagement()">
                            <i class="fas fa-arrow-left"></i> กลับ
                        </button>
                    </div>
                </form>
            `;

            document.getElementById('product-modal').style.display = 'block';

            // เพิ่ม event listener
            document.getElementById('addProductForm').addEventListener('submit', function (e) {
                e.preventDefault();
                addNewProduct();
            });
        }

        function addNewProduct() {
            const name = document.getElementById('product-name').value.trim();
            const description = document.getElementById('product-description').value.trim();
            const price = parseFloat(document.getElementById('product-price').value);
            const stock = parseInt(document.getElementById('product-stock').value);
            const category = document.getElementById('product-category').value;
            const imageFile = document.getElementById('product-image').files[0];

            // ตรวจสอบข้อมูล
            if (!name || !description || !price || !stock || !category || !imageFile) {
                showNotification('⚠️ กรุณากรอกข้อมูลให้ครบถ้วน', 'error');
                return;
            }

            showNotification('✅ เพิ่มสินค้าใหม่เรียบร้อยแล้ว!', 'success');
        }

        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) {
                showNotification('ไม่พบสินค้าที่ต้องการแก้ไข', 'error');
                return;
            }

            // ปิด modal อื่นๆ
            document.getElementById('product-management-modal').style.display = 'none';

            const modalContent = document.getElementById('modal-product-content');
            modalContent.innerHTML = `
                <h2><i class="fas fa-edit"></i> แก้ไขสินค้า</h2>

                <form id="editProductForm">
                <div class="form-group">
                    <label for="edit-product-name">ชื่อสินค้า *</label>
                    <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                        <input type="text" id="edit-product-name" value="${product.name}" required 
                            style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                        <i class="fas fa-tag" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                    </div>
                </div>

                    <div class="form-group">
                        <label for="edit-product-description">รายละเอียดสินค้า *</label>
                        <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                            <textarea id="edit-product-description" rows="3" required style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none; resize: vertical; min-height: 80px;">${product.description}</textarea>
                            <i class="fas fa-align-left" style="position: absolute; right: 15px; top: 15px; color: #666; font-size: 16px;"></i>
                         </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-product-price">ราคา (บาท) *</label>
                            <input type="number" id="edit-product-price" value="${product.price}" min="0" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-product-stock">จำนวนสต็อก *</label>
                            <input type="number" id="edit-product-stock" value="${product.stock}" min="0" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="edit-product-category">หมวดหมู่ *</label>
                        <select id="edit-product-category" required>
                            <option value="Learning Supplies" ${product.category === 'Learning Supplies' ? 'selected' : ''}>📚 อุปกรณ์การเรียน</option>
                            <option value="Student Uniform" ${product.category === 'Student Uniform' ? 'selected' : ''}>👔 เครื่องแบบนักศึกษา</option>
                            <option value="Activity" ${product.category === 'Activity' ? 'selected' : ''}>🎽 เสื้อกิจกรรม</option>
                            <option value="Souvenirs" ${product.category === 'Souvenirs' ? 'selected' : ''}>🎁 ของที่ระลึก</option>
                        </select>
                    </div>

                    <div class="button-group">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> บันทึกการแก้ไข
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="showProductManagement()">
                            <i class="fas fa-arrow-left"></i> กลับ
                        </button>
                    </div>
                </form>
            `;

            document.getElementById('product-modal').style.display = 'block';

            // Event listener for form submission
            document.getElementById('editProductForm').addEventListener('submit', function (e) {
                e.preventDefault();
                saveProductChanges(productId);
            });
        }

        function saveProductChanges(productId) {
            const product = products.find(p => p.id === productId);
            const updatedData = {
                name: document.getElementById('edit-product-name').value.trim(),
                description: document.getElementById('edit-product-description').value.trim(),
                price: parseFloat(document.getElementById('edit-product-price').value),
                stock: parseInt(document.getElementById('edit-product-stock').value),
                category: document.getElementById('edit-product-category').value
            };

            if (!updatedData.name || !updatedData.description || !updatedData.price || !updatedData.stock || !updatedData.category) {
                showNotification('กรุณากรอกข้อมูลให้ครบถ้วน', 'error');
                return;
            }

            // Update product data
            Object.assign(product, updatedData);

            closeModal();
            showProductManagement();
            showNotification('บันทึกการแก้ไขสินค้าเรียบร้อยแล้ว', 'success');
        }

        function deleteProduct(productId) {
            if (confirm('ต้องการลบสินค้านี้หรือไม่?')) {
                const index = products.findIndex(p => p.id === productId);
                if (index > -1) {
                    products.splice(index, 1);
                    loadProductManagementTable();
                    updateAdminStats();
                    showNotification('🗑️ ลบสินค้าเรียบร้อยแล้ว', 'success');
                }
            }
        }

        // ===== ฟังก์ชันโปรไฟล์ =====
        function showStudentProfile() {
            if (!currentUser || currentUser.type !== 'student') {
                showNotification('❌ ไม่สามารถเข้าถึงข้อมูลโปรไฟล์ได้', 'error');
                return;
            }
            loadStudentProfileForm();
            document.getElementById('student-profile-modal').style.display = 'block';
        }

        function showAdminProfile() {
            if (!currentUser || currentUser.type !== 'admin') {
                showNotification('❌ ไม่สามารถเข้าถึงข้อมูลโปรไฟล์ได้', 'error');
                return;
            }
            loadAdminProfileForm();
            document.getElementById('admin-profile-modal').style.display = 'block';
        }

        function loadAdminProfileForm() {
            const user = currentUser;
            const content = document.getElementById('admin-profile-content');

            content.innerHTML = `
                <h2 style="text-align: center; margin-bottom: 30px;"><i class="fas fa-user-tie"></i> แก้ไขข้อมูลเจ้าหน้าที่</h2>

                <!-- Tabs Navigation -->
                <div class="profile-tabs" style="margin-bottom: 30px; justify-content: center;">
                    <button class="tab-btn active" onclick="showAdminProfileTab('personal')">
                        <i class="fas fa-user"></i> ข้อมูลส่วนตัว
                    </button>
                    <button class="tab-btn" onclick="showAdminProfileTab('password')">
                        <i class="fas fa-lock"></i> เปลี่ยนรหัสผ่าน
                    </button>
                    <button class="tab-btn" onclick="showAdminProfileTab('contact')">
                        <i class="fas fa-phone"></i> ข้อมูลติดต่อ
                    </button>
                </div>

                <!-- Tab Content Container -->
                <div style="max-width: 600px; margin: 0 auto; padding: 0 20px;">
                    <!-- Tab Content -->
                    <div id="admin-tab-personal" class="tab-content active">
                        <form id="adminPersonalInfoForm">
                            <div class="form-section">
                                <h3 style="text-align: center;"><i class="fas fa-id-badge"></i> ข้อมูลทั่วไป</h3>
                
                                <div class="form-group">
                                    <label for="edit-admin-id">รหัสเจ้าหน้าที่</label>
                                    <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: #f8f9fa; transition: all 0.3s ease;" class="input-container readonly">
                                        <input type="text" id="edit-admin-id" value="${user.id}" readonly 
                                            style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none; cursor: not-allowed;">
                                        <i class="fas fa-id-badge" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #999; font-size: 16px;"></i>
                                    </div>
                                    <small style="color: #666; font-size: 12px; display: block; margin-top: 8px;">รหัสเจ้าหน้าที่ไม่สามารถเปลี่ยนแปลงได้</small>
                                </div>
                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="edit-admin-firstname">ชื่อ *</label>
                                        <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                                            <input type="text" id="edit-admin-firstname" value="${user.firstname}" required 
                                                style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                                            <i class="fas fa-user" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="edit-admin-lastname">นามสกุล *</label>
                                        <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                                            <input type="text" id="edit-admin-lastname" value="${user.lastname}" required 
                                                style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                                            <i class="fas fa-user-tag" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="edit-admin-department">สาขาวิชา/แผนก *</label>
                                    <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                                        <input type="text" id="edit-admin-department" value="${user.department}" required 
                                            style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                                        <i class="fas fa-building" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="button-group">
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-save"></i> บันทึกข้อมูล
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="loadAdminProfileForm()">
                                    <i class="fas fa-undo"></i> รีเซ็ต
                                </button>
                            </div>
                        </form>
                    </div>

                    <div id="admin-tab-password" class="tab-content">
                        <form id="adminChangePasswordForm">
                            <div class="form-section">
                                <h3 style="text-align: center;"><i class="fas fa-shield-alt"></i> เปลี่ยนรหัสผ่าน</h3>
                
                                <div class="form-group">
                                    <label for="admin-current-password">รหัสผ่านปัจจุบัน *</label>
                                    <div class="password-container" style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;">
                                        <input type="password" id="admin-current-password" placeholder="กรอกรหัสผ่านปัจจุบัน" required 
                                            style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                                        <i class="fas fa-eye password-toggle" onclick="togglePassword('admin-current-password', this)" 
                                            style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #666; font-size: 18px; transition: color 0.3s ease;"></i>
                                    </div>
                                    <div class="error-message" id="admin-current-password-error">รหัสผ่านปัจจุบันไม่ถูกต้อง</div>
                                </div>

                                <div class="form-group">
                                    <label for="admin-new-password">รหัสผ่านใหม่ *</label>
                                    <div class="password-container" style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;">
                                        <input type="password" id="admin-new-password" placeholder="กรอกรหัสผ่านใหม่" required 
                                            style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                                        <i class="fas fa-eye password-toggle" onclick="togglePassword('admin-new-password', this)" 
                                            style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #666; font-size: 18px; transition: color 0.3s ease;"></i>
                                    </div>
                                    <small style="color: #666; font-size: 12px; display: block; margin-top: 8px;">
                                        <i class="fas fa-info-circle"></i> รหัสผ่านต้องมีอย่างน้อย 6 ตัวอักษร
                                    </small>
                                </div>

                                <div class="form-group">
                                    <label for="admin-confirm-new-password">ยืนยันรหัสผ่านใหม่ *</label>
                                    <div class="password-container" style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;">
                                        <input type="password" id="admin-confirm-new-password" placeholder="ยืนยันรหัสผ่านใหม่" required 
                                            style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                                        <i class="fas fa-eye password-toggle" onclick="togglePassword('admin-confirm-new-password', this)" 
                                            style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #666; font-size: 18px; transition: color 0.3s ease;"></i>
                                    </div>
                                    <div class="error-message" id="admin-confirm-password-error">รหัสผ่านไม่ตรงกัน</div>
                                </div>

                                <!-- Password Strength Indicator -->
                                <div class="password-strength" id="admin-password-strength" style="display: none;">
                                    <div class="strength-label">ความแข็งแกร่งของรหัสผ่าน:</div>
                                    <div class="strength-meter">
                                        <div class="strength-bar" id="admin-strength-bar"></div>
                                    </div>
                                    <div class="strength-text" id="admin-strength-text">อ่อนแอ</div>
                                </div>
                            </div>

                            <div class="button-group">
                                <button type="submit" class="btn btn-warning">
                                    <i class="fas fa-key"></i> เปลี่ยนรหัสผ่าน
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="document.getElementById('adminChangePasswordForm').reset(); hideAdminPasswordErrors();">
                                    <i class="fas fa-undo"></i> รีเซ็ต
                                </button>
                            </div>
                        </form>
                    </div>

                    <div id="admin-tab-contact" class="tab-content">
                        <form id="adminContactInfoForm">
                            <div class="form-section">
                                <h3 style="text-align: center;"><i class="fas fa-address-book"></i> ข้อมูลติดต่อ</h3>
                
                                <div class="form-group">
                                    <label for="edit-admin-email">อีเมล *</label>
                                    <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                                        <input type="email" id="edit-admin-email" value="${user.email}" required 
                                            style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                                        <i class="fas fa-envelope" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                                    </div>
                                    <small style="color: #666; font-size: 12px; display: block; margin-top: 8px;">
                                        <i class="fas fa-info-circle"></i> อีเมลนี้จะใช้สำหรับการแจ้งเตือนและการติดต่อ
                                    </small>
                                </div>

                                <div class="form-group">
                                    <label for="edit-admin-phone">เบอร์โทรศัพท์ *</label>
                                    <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                                        <input type="tel" id="edit-admin-phone" value="${user.phone}" required 
                                            pattern="[0-9]{10}" title="กรุณากรอกเบอร์โทรศัพท์ 10 หลัก"
                                            style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                                        <i class="fas fa-phone" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                                    </div>
                                    <small style="color: #666; font-size: 12px; display: block; margin-top: 8px;">
                                        <i class="fas fa-info-circle"></i> กรอกเบอร์โทรศัพท์ 10 หลัก เช่น 0812345678
                                    </small>
                                </div>

                            <div class="button-group">
                                <button type="submit" class="btn btn-info">
                                    <i class="fas fa-save"></i> บันทึกข้อมูลติดต่อ
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="loadAdminProfileForm()">
                                    <i class="fas fa-undo"></i> รีเซ็ต
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="button-group" style="margin-top: 30px; border-top: 1px solid #dee2e6; padding-top: 20px;">
                    <button class="btn btn-secondary" onclick="closeAdminProfile()">
                        <i class="fas fa-times"></i> ปิด
                    </button>
                </div>
            `;

            // เพิ่ม Event Listeners สำหรับ forms
            setupAdminProfileEventListeners();
        }

        function loadStudentProfileForm() {
            const user = currentUser;
            const content = document.getElementById('student-profile-content');

            content.innerHTML = `
                <h2 style="text-align: center; margin-bottom: 30px;"><i class="fas fa-user-edit"></i> แก้ไขข้อมูลส่วนตัว</h2>
        
                <!-- Tabs Navigation -->
                <div class="profile-tabs" style="margin-bottom: 30px; justify-content: center;">
                    <button class="tab-btn active" onclick="showProfileTab('personal')">
                        <i class="fas fa-user"></i> ข้อมูลส่วนตัว
                    </button>
                    <button class="tab-btn" onclick="showProfileTab('password')">
                        <i class="fas fa-lock"></i> เปลี่ยนรหัสผ่าน
                    </button>
                    <button class="tab-btn" onclick="showProfileTab('contact')">
                        <i class="fas fa-phone"></i> ข้อมูลติดต่อ
                    </button>
                </div>

                <!-- Tab Content Container -->
                <div style="max-width: 600px; margin: 0 auto; padding: 0 20px;">
                    <!-- Tab Content -->
                    <div id="tab-personal" class="tab-content active">
                        <form id="personalInfoForm">
                            <div class="form-section">
                                <h3 style="text-align: center;"><i class="fas fa-id-card"></i> ข้อมูลทั่วไป</h3>
                        
                                <div class="form-group">
                                    <label for="edit-student-id">รหัสนักศึกษา</label>
                                    <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: #f8f9fa; transition: all 0.3s ease;" class="input-container readonly">
                                        <input type="text" id="edit-student-id" value="${user.id}" readonly 
                                            style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none; cursor: not-allowed;">
                                        <i class="fas fa-id-card" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #999; font-size: 16px;"></i>
                                    </div>
                                    <small style="color: #666; font-size: 12px; display: block; margin-top: 8px;">รหัสนักศึกษาไม่สามารถเปลี่ยนแปลงได้</small>
                                </div>
                        
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="edit-firstname">ชื่อ *</label>
                                        <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                                            <input type="text" id="edit-firstname" value="${user.firstname}" required 
                                                style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                                            <i class="fas fa-user" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="edit-lastname">นามสกุล *</label>
                                        <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                                            <input type="text" id="edit-lastname" value="${user.lastname}" required 
                                                style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                                            <i class="fas fa-user-tag" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="edit-faculty">คณะ *</label>
                                    <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="select-container">
                                        <select id="edit-faculty" required 
                                            style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none; appearance: none; cursor: pointer;">
                                            <option value="engineering" ${user.faculty === 'engineering' ? 'selected' : ''}>คณะวิศวกรรมศาสตร์</option>
                                            <option value="business" ${user.faculty === 'business' ? 'selected' : ''}>คณะบริหารธุรกิจและเทคโนโลยีสารสนเทศ</option>
                                            <option value="education" ${user.faculty === 'education' ? 'selected' : ''}>คณะครุศาสตร์อุตสาหกรรม</option>
                                        </select>
                                        <i class="fas fa-university" style="position: absolute; right: 45px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px; pointer-events: none;"></i>
                                        <i class="fas fa-chevron-down" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 14px; pointer-events: none;"></i>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="edit-major">สาขาวิชา *</label>
                                        <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                                            <input type="text" id="edit-major" value="${user.major}" required 
                                                style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                                            <i class="fas fa-graduation-cap" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="edit-year">ชั้นปี *</label>
                                        <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="select-container">
                                            <select id="edit-year" required 
                                                style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none; appearance: none; cursor: pointer;">
                                                <option value="1" ${user.year === '1' ? 'selected' : ''}>ปี 1</option>
                                                <option value="2" ${user.year === '2' ? 'selected' : ''}>ปี 2</option>
                                                <option value="3" ${user.year === '3' ? 'selected' : ''}>ปี 3</option>
                                                <option value="4" ${user.year === '4' ? 'selected' : ''}>ปี 4</option>
                                            </select>
                                            <i class="fas fa-calendar-alt" style="position: absolute; right: 45px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px; pointer-events: none;"></i>
                                            <i class="fas fa-chevron-down" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 14px; pointer-events: none;"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="button-group">
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-save"></i> บันทึกข้อมูล
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="loadStudentProfileForm()">
                                    <i class="fas fa-undo"></i> รีเซ็ต
                                </button>
                            </div>
                        </form>
                    </div>

                    <div id="tab-password" class="tab-content">
                        <form id="changePasswordForm">
                            <div class="form-section">
                                <h3 style="text-align: center;"><i class="fas fa-shield-alt"></i> เปลี่ยนรหัสผ่าน</h3>
                        
                                <div class="form-group">
                                    <label for="current-password">รหัสผ่านปัจจุบัน *</label>
                                    <div class="password-container" style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;">
                                        <input type="password" id="current-password" placeholder="กรอกรหัสผ่านปัจจุบัน" required 
                                            style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                                        <i class="fas fa-eye password-toggle" onclick="togglePassword('current-password', this)" 
                                            style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #666; font-size: 18px; transition: color 0.3s ease;"></i>
                                    </div>
                                    <div class="error-message" id="current-password-error">รหัสผ่านปัจจุบันไม่ถูกต้อง</div>
                                </div>

                                <div class="form-group">
                                    <label for="new-password">รหัสผ่านใหม่ *</label>
                                    <div class="password-container" style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;">
                                        <input type="password" id="new-password" placeholder="กรอกรหัสผ่านใหม่" required 
                                            style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                                        <i class="fas fa-eye password-toggle" onclick="togglePassword('new-password', this)" 
                                            style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #666; font-size: 18px; transition: color 0.3s ease;"></i>
                                    </div>
                                    <small style="color: #666; font-size: 12px; display: block; margin-top: 8px;">
                                        <i class="fas fa-info-circle"></i> รหัสผ่านต้องมีอย่างน้อย 6 ตัวอักษร
                                    </small>
                                </div>

                                <div class="form-group">
                                    <label for="confirm-new-password">ยืนยันรหัสผ่านใหม่ *</label>
                                    <div class="password-container" style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;">
                                        <input type="password" id="confirm-new-password" placeholder="ยืนยันรหัสผ่านใหม่" required 
                                            style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                                        <i class="fas fa-eye password-toggle" onclick="togglePassword('confirm-new-password', this)" 
                                            style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #666; font-size: 18px; transition: color 0.3s ease;"></i>
                                    </div>
                                    <div class="error-message" id="confirm-password-error">รหัสผ่านไม่ตรงกัน</div>
                                </div>

                                <!-- Password Strength Indicator -->
                                <div class="password-strength" id="password-strength" style="display: none;">
                                    <div class="strength-label">ความแข็งแกร่งของรหัสผ่าน:</div>
                                    <div class="strength-meter">
                                        <div class="strength-bar" id="strength-bar"></div>
                                    </div>
                                    <div class="strength-text" id="strength-text">อ่อนแอ</div>
                                </div>
                            </div>

                            <div class="button-group">
                                <button type="submit" class="btn btn-warning">
                                    <i class="fas fa-key"></i> เปลี่ยนรหัสผ่าน
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="document.getElementById('changePasswordForm').reset(); hidePasswordErrors();">
                                    <i class="fas fa-undo"></i> รีเซ็ต
                                </button>
                            </div>
                        </form>
                    </div>

                    <div id="tab-contact" class="tab-content">
                        <form id="contactInfoForm">
                            <div class="form-section">
                                <h3 style="text-align: center;"><i class="fas fa-address-book"></i> ข้อมูลติดต่อ</h3>
                        
                                <div class="form-group">
                                    <label for="edit-email">อีเมล *</label>
                                    <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                                        <input type="email" id="edit-email" value="${user.email}" required 
                                            style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                                        <i class="fas fa-envelope" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                                    </div>
                                    <small style="color: #666; font-size: 12px; display: block; margin-top: 8px;">
                                        <i class="fas fa-info-circle"></i> อีเมลนี้จะใช้สำหรับการแจ้งเตือนและการติดต่อ
                                    </small>
                                </div>

                                <div class="form-group">
                                    <label for="edit-phone">เบอร์โทรศัพท์ *</label>
                                    <div style="position: relative; border: 2px solid #e9ecef; border-radius: 12px; overflow: hidden; background: white; transition: all 0.3s ease;" class="input-container">
                                        <input type="tel" id="edit-phone" value="${user.phone}" required 
                                            pattern="[0-9]{10}" title="กรุณากรอกเบอร์โทรศัพท์ 10 หลัก"
                                            style="border: none; padding: 15px 50px 15px 15px; width: 100%; margin: 0; border-radius: 0; background: transparent; outline: none;">
                                        <i class="fas fa-phone" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; font-size: 16px;"></i>
                                    </div>
                                    <small style="color: #666; font-size: 12px; display: block; margin-top: 8px;">
                                        <i class="fas fa-info-circle"></i> กรอกเบอร์โทรศัพท์ 10 หลัก เช่น 0812345678
                                    </small>
                                </div>

                            <div class="button-group">
                                <button type="submit" class="btn btn-info">
                                    <i class="fas fa-save"></i> บันทึกข้อมูลติดต่อ
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="loadStudentProfileForm()">
                                    <i class="fas fa-undo"></i> รีเซ็ต
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="button-group" style="margin-top: 30px; border-top: 1px solid #dee2e6; padding-top: 20px;">
                    <button class="btn btn-secondary" onclick="closeStudentProfile()">
                        <i class="fas fa-times"></i> ปิด
                    </button>
                </div>
            `;

            // เพิ่ม Event Listeners สำหรับ forms
            setupAdminProfileEventListeners();
        }

        function setupProfileEventListeners() {
            // Personal Info Form
            document.getElementById('personalInfoForm').addEventListener('submit', function (e) {
                e.preventDefault();
                updatePersonalInfo();
            });

            // Change Password Form
            document.getElementById('changePasswordForm').addEventListener('submit', function (e) {
                e.preventDefault();
                changePassword();
            });

            // Contact Info Form
            document.getElementById('contactInfoForm').addEventListener('submit', function (e) {
                e.preventDefault();
                updateContactInfo();
            });

            // Password strength checker
            const newPasswordInput = document.getElementById('new-password');
            if (newPasswordInput) {
                newPasswordInput.addEventListener('input', checkPasswordStrength);
            }

            // Phone number formatting
            const phoneInput = document.getElementById('edit-phone');
            if (phoneInput) {
                phoneInput.addEventListener('input', function () {
                    let value = this.value.replace(/[^0-9]/g, '');
                    if (value.length > 10) value = value.slice(0, 10);
                    this.value = value;
                });
            }

            // เพิ่ม focus effects สำหรับ password containers, input containers และ select containers
            const passwordContainers = document.querySelectorAll('.password-container');
            const inputContainers = document.querySelectorAll('.input-container');
            const selectContainers = document.querySelectorAll('.select-container');

            // Password containers
            passwordContainers.forEach(container => {
                const input = container.querySelector('input');
                if (input) {
                    input.addEventListener('focus', function () {
                        container.style.borderColor = '#2a5298';
                        container.style.boxShadow = '0 0 15px rgba(42, 82, 152, 0.2)';
                        container.style.transform = 'translateY(-2px)';
                    });

                    input.addEventListener('blur', function () {
                        container.style.borderColor = '#e9ecef';
                        container.style.boxShadow = 'none';
                        container.style.transform = 'translateY(0)';
                    });
                }
            });

            // Input containers สำหรับช่องกรอกทั่วไป
            inputContainers.forEach(container => {
                const input = container.querySelector('input');
                if (input && !container.classList.contains('readonly')) {
                    input.addEventListener('focus', function () {
                        container.style.borderColor = '#2a5298';
                        container.style.boxShadow = '0 0 15px rgba(42, 82, 152, 0.2)';
                        container.style.transform = 'translateY(-2px)';
                    });

                    input.addEventListener('blur', function () {
                        container.style.borderColor = '#e9ecef';
                        container.style.boxShadow = 'none';
                        container.style.transform = 'translateY(0)';
                    });
                }
            });

            // Select containers สำหรับ dropdown
            selectContainers.forEach(container => {
                const select = container.querySelector('select');
                if (select) {
                    select.addEventListener('focus', function () {
                        container.style.borderColor = '#2a5298';
                        container.style.boxShadow = '0 0 15px rgba(42, 82, 152, 0.2)';
                        container.style.transform = 'translateY(-2px)';
                    });

                    select.addEventListener('blur', function () {
                        container.style.borderColor = '#e9ecef';
                        container.style.boxShadow = 'none';
                        container.style.transform = 'translateY(0)';
                    });
                }
            });
        }

        function setupAdminProfileEventListeners() {
            // Admin Personal Info Form
            const adminPersonalForm = document.getElementById('adminPersonalInfoForm');
            if (adminPersonalForm) {
                adminPersonalForm.addEventListener('submit', function (e) {
                    e.preventDefault();
                    updateAdminPersonalInfo();
                });
            }

            // Admin Change Password Form
            const adminPasswordForm = document.getElementById('adminChangePasswordForm');
            if (adminPasswordForm) {
                adminPasswordForm.addEventListener('submit', function (e) {
                    e.preventDefault();
                    changeAdminPassword();
                });
            }

            // Admin Contact Info Form
            const adminContactForm = document.getElementById('adminContactInfoForm');
            if (adminContactForm) {
                adminContactForm.addEventListener('submit', function (e) {
                    e.preventDefault();
                    updateAdminContactInfo();
                });
            }

            // Admin Password strength checker
            const adminNewPasswordInput = document.getElementById('admin-new-password');
            if (adminNewPasswordInput) {
                adminNewPasswordInput.addEventListener('input', checkAdminPasswordStrength);
            }

            // Admin Phone number formatting
            const adminPhoneInput = document.getElementById('edit-admin-phone');
            if (adminPhoneInput) {
                adminPhoneInput.addEventListener('input', function () {
                    let value = this.value.replace(/[^0-9]/g, '');
                    if (value.length > 10) value = value.slice(0, 10);
                    this.value = value;
                });
            }

            setupCommonProfileEffects('#admin-profile-modal');
        }

        function setupCommonProfileEffects(selector = '') {
            // เพิ่ม focus effects สำหรับ password containers, input containers และ select containers
            const passwordContainers = document.querySelectorAll(`${selector} .password-container`);
            const inputContainers = document.querySelectorAll(`${selector} .input-container`);
            const selectContainers = document.querySelectorAll(`${selector} .select-container`);

            // Password containers
            passwordContainers.forEach(container => {
                const input = container.querySelector('input');
                if (input) {
                    input.addEventListener('focus', function () {
                        container.style.borderColor = '#2a5298';
                        container.style.boxShadow = '0 0 15px rgba(42, 82, 152, 0.2)';
                        container.style.transform = 'translateY(-2px)';
                    });

                    input.addEventListener('blur', function () {
                        container.style.borderColor = '#e9ecef';
                        container.style.boxShadow = 'none';
                        container.style.transform = 'translateY(0)';
                    });
                }
            });

            // Input containers สำหรับช่องกรอกทั่วไป
            inputContainers.forEach(container => {
                const input = container.querySelector('input');
                if (input && !container.classList.contains('readonly')) {
                    input.addEventListener('focus', function () {
                        container.style.borderColor = '#2a5298';
                        container.style.boxShadow = '0 0 15px rgba(42, 82, 152, 0.2)';
                        container.style.transform = 'translateY(-2px)';
                    });

                    input.addEventListener('blur', function () {
                        container.style.borderColor = '#e9ecef';
                        container.style.boxShadow = 'none';
                        container.style.transform = 'translateY(0)';
                    });
                }
            });

            // Select containers สำหรับ dropdown
            selectContainers.forEach(container => {
                const select = container.querySelector('select');
                if (select) {
                    select.addEventListener('focus', function () {
                        container.style.borderColor = '#2a5298';
                        container.style.boxShadow = '0 0 15px rgba(42, 82, 152, 0.2)';
                        container.style.transform = 'translateY(-2px)';
                    });

                    select.addEventListener('blur', function () {
                        container.style.borderColor = '#e9ecef';
                        container.style.boxShadow = 'none';
                        container.style.transform = 'translateY(0)';
                    });
                }
            });
        }

        function showProfileTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));

            const tabButtons = document.querySelectorAll('.tab-btn');
            tabButtons.forEach(btn => btn.classList.remove('active'));

            // Show selected tab
            document.getElementById(`tab-${tabName}`).classList.add('active');
            event.target.classList.add('active');
        }

        function showAdminProfileTab(tabName) {
            // Hide all tabs  
            const tabs = document.querySelectorAll('#admin-profile-modal .tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));

            const tabButtons = document.querySelectorAll('#admin-profile-modal .tab-btn');
            tabButtons.forEach(btn => btn.classList.remove('active'));

            // Show selected tab
            document.getElementById(`admin-tab-${tabName}`).classList.add('active');
            event.target.classList.add('active');
        }

        function updatePersonalInfo() {
            const updatedData = {
                firstname: document.getElementById('edit-firstname').value.trim(),
                lastname: document.getElementById('edit-lastname').value.trim(),
                faculty: document.getElementById('edit-faculty').value,
                major: document.getElementById('edit-major').value.trim(),
                year: document.getElementById('edit-year').value
            };

            // Validate required fields
            if (!updatedData.firstname || !updatedData.lastname || !updatedData.faculty ||
                !updatedData.major || !updatedData.year) {
                showNotification('⚠️ กรุณากรอกข้อมูลให้ครบถ้วน', 'error');
                return;
            }

            // Update user data
            Object.assign(currentUser, updatedData);
            users.students[currentUser.id] = currentUser;

            // Update welcome message
            const displayName = `นักศึกษา ${currentUser.firstname} ${currentUser.lastname} (${currentUser.id})`;
            document.getElementById('student-welcome-message').innerHTML = `<i class="fas fa-hand-holding-heart"></i> ยินดีต้อนรับ ${displayName}`;

            showNotification('✅ บันทึกข้อมูลส่วนตัวเรียบร้อยแล้ว!', 'success');
        }

        function changePassword() {
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-new-password').value;

            // Hide previous errors
            hidePasswordErrors();

            // Validate current password
            if (currentPassword !== currentUser.password) {
                document.getElementById('current-password-error').style.display = 'block';
                showNotification('❌ รหัสผ่านปัจจุบันไม่ถูกต้อง', 'error');
                return;
            }

            // Validate new password length
            if (newPassword.length < 6) {
                showNotification('⚠️ รหัสผ่านใหม่ต้องมีอย่างน้อย 6 ตัวอักษร', 'error');
                return;
            }

            // Validate password confirmation
            if (newPassword !== confirmPassword) {
                document.getElementById('confirm-password-error').style.display = 'block';
                showNotification('❌ รหัสผ่านใหม่ไม่ตรงกัน', 'error');
                return;
            }

            // Check if new password is different from current
            if (newPassword === currentPassword) {
                showNotification('⚠️ รหัสผ่านใหม่ต้องแตกต่างจากรหัสผ่านปัจจุบัน', 'error');
                return;
            }

            // Update password
            currentUser.password = newPassword;
            users.students[currentUser.id] = currentUser;

            // Clear form
            document.getElementById('changePasswordForm').reset();
            const strengthElement = document.getElementById('password-strength');
            if (strengthElement) strengthElement.style.display = 'none';

            showNotification('🔐 เปลี่ยนรหัสผ่านเรียบร้อยแล้ว!', 'success');
        }

        function updateContactInfo() {
            const email = document.getElementById('edit-email').value.trim();
            const phone = document.getElementById('edit-phone').value.trim();

            // Validate email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showNotification('⚠️ กรุณากรอกอีเมลที่ถูกต้อง', 'error');
                return;
            }

            // Validate phone
            if (!/^[0-9]{10}$/.test(phone)) {
                showNotification('⚠️ กรุณากรอกเบอร์โทรศัพท์ 10 หลัก', 'error');
                return;
            }

            // Update contact data
            currentUser.email = email;
            currentUser.phone = phone;
            users.students[currentUser.id] = currentUser;

            showNotification('📞 บันทึกข้อมูลติดต่อเรียบร้อยแล้ว!', 'success');
        }

        function checkPasswordStrength() {
            const password = document.getElementById('new-password').value;
            const strengthElement = document.getElementById('password-strength');
            const strengthBar = document.getElementById('strength-bar');
            const strengthText = document.getElementById('strength-text');

            if (password.length === 0) {
                strengthElement.style.display = 'none';
                return;
            }

            strengthElement.style.display = 'block';

            let strength = 0;
            let feedback = [];

            // Length check
            if (password.length >= 8) strength += 2;
            else if (password.length >= 6) strength += 1;
            else feedback.push('อย่างน้อย 6 ตัวอักษร');

            // Character variety
            if (/[a-z]/.test(password)) strength += 1;
            if (/[A-Z]/.test(password)) strength += 1;
            if (/[0-9]/.test(password)) strength += 1;
            if (/[^a-zA-Z0-9]/.test(password)) strength += 1;

            // Update visual feedback
            let strengthLevel, color, text;
            if (strength <= 2) {
                strengthLevel = 'weak';
                color = '#dc3545';
                text = 'อ่อนแอ';
            } else if (strength <= 4) {
                strengthLevel = 'medium';
                color = '#ffc107';
                text = 'ปานกลาง';
            } else {
                strengthLevel = 'strong';
                color = '#28a745';
                text = 'แข็งแกร่ง';
            }

            strengthBar.style.width = `${(strength / 6) * 100}%`;
            strengthBar.style.backgroundColor = color;
            strengthText.textContent = text;
            strengthText.style.color = color;
        }

        function checkAdminPasswordStrength() {
            const password = document.getElementById('admin-new-password').value;
            const strengthElement = document.getElementById('admin-password-strength');
            const strengthBar = document.getElementById('admin-strength-bar');
            const strengthText = document.getElementById('admin-strength-text');

            if (password.length === 0) {
                strengthElement.style.display = 'none';
                return;
            }

            strengthElement.style.display = 'block';

            let strength = 0;

            // Length check
            if (password.length >= 8) strength += 2;
            else if (password.length >= 6) strength += 1;

            // Character variety
            if (/[a-z]/.test(password)) strength += 1;
            if (/[A-Z]/.test(password)) strength += 1;
            if (/[0-9]/.test(password)) strength += 1;
            if (/[^a-zA-Z0-9]/.test(password)) strength += 1;

            // Update visual feedback
            let color, text;
            if (strength <= 2) {
                color = '#dc3545';
                text = 'อ่อนแอ';
            } else if (strength <= 4) {
                color = '#ffc107';
                text = 'ปานกลาง';
            } else {
                color = '#28a745';
                text = 'แข็งแกร่ง';
            }

            strengthBar.style.width = `${(strength / 6) * 100}%`;
            strengthBar.style.backgroundColor = color;
            strengthText.textContent = text;
            strengthText.style.color = color;
        }

        function hidePasswordErrors() {
            document.getElementById('current-password-error').style.display = 'none';
            document.getElementById('confirm-password-error').style.display = 'none';
        }

        function hideAdminPasswordErrors() {
            document.getElementById('admin-current-password-error').style.display = 'none';
            document.getElementById('admin-confirm-password-error').style.display = 'none';
        }

        function closeStudentProfile() {
            document.getElementById('student-profile-modal').style.display = 'none';

        }

        function closeAdminProfile() {
            document.getElementById('admin-profile-modal').style.display = 'none';
        }

        function showOrderHistory() {
            if (!currentUser || currentUser.type !== 'student') {
                showNotification('❌ ไม่สามารถเข้าถึงประวัติการสั่งซื้อได้', 'error');
                return;
            }

            // ปิด modal อื่นๆ ทั้งหมดก่อน
            document.getElementById('payment-modal').style.display = 'none';
            document.getElementById('order-tracking-modal').style.display = 'none';
            document.getElementById('cart-modal').style.display = 'none';
            document.getElementById('product-modal').style.display = 'none';
            document.getElementById('product-management-modal').style.display = 'none';
            document.getElementById('order-management-modal').style.display = 'none';
            document.getElementById('payment-management-modal').style.display = 'none';
            document.getElementById('student-profile-modal').style.display = 'none';

            // กรองเฉพาะออเดอร์ที่ไม่ใช่สถานะยกเลิก
            const studentOrders = orders.filter(order =>
                order.studentId === currentUser.id && order.status !== 'cancelled'
            );

            if (studentOrders.length === 0) {
                showNotification('📋 ยังไม่มีประวัติการสั่งซื้อ หรือคำสั่งซื้อทั้งหมดถูกยกเลิก', 'info');
                return;
            }

            let historyHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 900px; margin: 20px auto;">
                    <h2><i class="fas fa-history"></i> ประวัติการสั่งซื้อ</h2>
                    <div style="margin-top: 20px;">
            `;

            studentOrders.reverse().forEach(order => {
                const status = orderStatuses[order.status];

                historyHTML += `
                    <div style="border: 1px solid #dee2e6; border-radius: 10px; padding: 20px; margin-bottom: 15px; background: #f8f9fa;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 style="color: #2a5298; margin: 0;">คำสั่งซื้อ: ${order.id}</h4>
                            <span class="status-badge status-${order.status.replace('-', '-')}">${status.name}</span>
                        </div>
                        <p><strong>วันที่สั่ง:</strong> ${order.date}</p>
                        <p><strong>รายการสินค้า:</strong></p>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                `;

                order.items.forEach(item => {
                    historyHTML += `<li>${item.name} × ${item.quantity} = ${(item.price * item.quantity).toLocaleString()} บาท</li>`;
                });

                historyHTML += `
                        </ul>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                            <p style="margin: 0; font-size: 18px; font-weight: 700; color: #2a5298;">
                                <strong>รวมทั้งหมด: ${order.total.toLocaleString()} บาท</strong>
                            </p>
                            <button class="btn btn-info btn-small" onclick="showOrderTracking('${order.id}')">
                                <i class="fas fa-search"></i> ติดตามสถานะ
                            </button>
                        </div>
                    </div>
                `;
            });

            historyHTML += `
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-secondary" onclick="this.parentElement.parentElement.parentElement.remove()">
                            <i class="fas fa-times"></i> ปิด
                        </button>
                    </div>
                </div>
            `;

            // สร้าง overlay
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.6);
                backdrop-filter: blur(5px);
                z-index: 1000;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
                overflow-y: auto;
            `;
            overlay.innerHTML = historyHTML;
            document.body.appendChild(overlay);

            // ปิดเมื่อคลิกข้างนอก
            overlay.addEventListener('click', function (e) {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            });
        }

        // ===== ฟังก์ชันลงทะเบียนผู้ใช้ใหม่ =====

        function registerUser(userType, userData) {
            const userGroup = userType === 'student' ? 'students' : 'admins';

            if (users[userGroup][userData.id]) {
                showNotification('❌ รหัสนี้มีผู้ใช้งานแล้ว กรุณาใช้รหัสอื่น', 'error');
                return false;
            }

            users[userGroup][userData.id] = userData;
            return true;
        }

        // ===== Event Listeners =====

        // Event Listeners สำหรับฟอร์ม Login
        document.getElementById('studentLoginForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const userId = document.getElementById('student-id').value.trim();
            const password = document.getElementById('student-password').value;

            if (login('student', userId, password)) {
                document.getElementById('studentLoginForm').reset();
                showNotification(`🎓 ยินดีต้อนรับนักศึกษา ${currentUser.firstname}!`, 'success');
            } else {
                showNotification('❌ รหัสนักศึกษาหรือรหัสผ่านไม่ถูกต้อง\n\n💡 ทดลองใช้: รหัส 641234567 รหัสผ่าน 123456', 'error');
            }
        });

        document.getElementById('adminLoginForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const userId = document.getElementById('admin-id').value.trim();
            const password = document.getElementById('admin-password').value;

            if (login('admin', userId, password)) {
                document.getElementById('adminLoginForm').reset();
                showNotification(`👨‍💼 ยินดีต้อนรับเจ้าหน้าที่ ${currentUser.firstname}!`, 'success');
            } else {
                showNotification('❌ รหัสเจ้าหน้าที่หรือรหัสผ่านไม่ถูกต้อง\n\n💡 ทดลองใช้: รหัส A001 รหัสผ่าน admin123', 'error');
            }
        });

        // Event Listeners สำหรับฟอร์ม Register
        document.getElementById('studentRegForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const password = document.getElementById('new-student-password').value;
            const confirmPassword = document.getElementById('confirm-student-password').value;

            if (password !== confirmPassword) {
                document.getElementById('password-error').style.display = 'block';
                return;
            }

            if (password.length < 6) {
                showNotification('⚠️ รหัสผ่านต้องมีอย่างน้อย 6 ตัวอักษร', 'error');
                return;
            }

            document.getElementById('password-error').style.display = 'none';

            const newUser = {
                id: document.getElementById('new-student-id').value.trim(),
                type: 'student',
                firstname: document.getElementById('student-firstname').value.trim(),
                lastname: document.getElementById('student-lastname').value.trim(),
                faculty: document.getElementById('student-faculty').value,
                major: document.getElementById('student-major').value.trim(),
                year: document.getElementById('student-year').value,
                email: document.getElementById('student-email').value.trim(),
                phone: document.getElementById('student-phone').value.trim(),
                password: password
            };

            if (registerUser('student', newUser)) {
                showNotification('✅ ลงทะเบียนเรียบร้อยแล้ว!\n\n🎉 สามารถเข้าสู่ระบบได้ทันที', 'success');
                document.getElementById('studentRegForm').reset();
                showLoginForm('student');
            }
        });

        document.getElementById('adminRegForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const password = document.getElementById('new-admin-password').value;
            const confirmPassword = document.getElementById('confirm-admin-password').value;

            if (password !== confirmPassword) {
                document.getElementById('admin-password-error').style.display = 'block';
                return;
            }

            if (password.length < 6) {
                showNotification('⚠️ รหัสผ่านต้องมีอย่างน้อย 6 ตัวอักษร', 'error');
                return;
            }

            document.getElementById('admin-password-error').style.display = 'none';

            const newUser = {
                id: document.getElementById('new-admin-id').value.trim(),
                type: 'admin',
                firstname: document.getElementById('admin-firstname').value.trim(),
                lastname: document.getElementById('admin-lastname').value.trim(),
                department: document.getElementById('admin-department').value.trim(),
                email: document.getElementById('admin-email').value.trim(),
                phone: document.getElementById('admin-phone').value.trim(),
                password: password
            };

            if (registerUser('admin', newUser)) {
                showNotification('✅ ลงทะเบียนเรียบร้อยแล้ว!\n\n🎉 สามารถเข้าสู่ระบบได้ทันที', 'success');
                document.getElementById('adminRegForm').reset();
                showLoginForm('admin');
            }
        });

        // Event Listeners สำหรับฟอร์มลืมรหัสผ่าน (แบบปลอดภัย)
        const studentForgotForm = document.getElementById('studentForgotForm');
        if (studentForgotForm) {
            studentForgotForm.addEventListener('submit', function (e) {
                e.preventDefault();

                const fullname = document.getElementById('forgot-student-fullname').value.trim();
                const nationalId = document.getElementById('forgot-student-national-id').value.trim();
                const userId = document.getElementById('forgot-student-id').value.trim();
                const newPassword = document.getElementById('forgot-student-new-password').value;
                const confirmPassword = document.getElementById('forgot-student-confirm-password').value;

                // ตรวจสอบข้อมูลพื้นฐาน
                if (!fullname || !nationalId || !userId || !newPassword || !confirmPassword) {
                    showNotification('⚠️ กรุณากรอกข้อมูลให้ครบถ้วน', 'error');
                    return;
                }

                // ตรวจสอบรหัสประจำตัวประชาชน
                if (!/^\d{13}$/.test(nationalId)) {
                    showNotification('⚠️ รหัสประจำตัวประชาชนต้องเป็นตัวเลข 13 หลัก', 'error');
                    return;
                }

                // ตรวจสอบความยาวรหัสผ่าน
                if (newPassword.length < 6) {
                    showNotification('⚠️ รหัสผ่านต้องมีอย่างน้อย 6 ตัวอักษร', 'error');
                    return;
                }

                // ตรวจสอบการยืนยันรหัสผ่าน
                if (newPassword !== confirmPassword) {
                    const errorElement = document.getElementById('student-forgot-password-error');
                    if (errorElement) errorElement.style.display = 'block';
                    showNotification('❌ รหัสผ่านไม่ตรงกัน', 'error');
                    return;
                }

                // ซ่อน error message
                const errorElement = document.getElementById('student-forgot-password-error');
                if (errorElement) errorElement.style.display = 'none';

                // เรียกใช้ฟังก์ชันรีเซ็ตรหัสผ่าน
                resetPassword('student', {
                    fullname: fullname,
                    nationalId: nationalId,
                    userId: userId,
                    newPassword: newPassword
                });
            });
        }

        const adminForgotForm = document.getElementById('adminForgotForm');
        if (adminForgotForm) {
            adminForgotForm.addEventListener('submit', function (e) {
                e.preventDefault();

                const fullname = document.getElementById('forgot-admin-fullname').value.trim();
                const nationalId = document.getElementById('forgot-admin-national-id').value.trim();
                const userId = document.getElementById('forgot-admin-id').value.trim();
                const newPassword = document.getElementById('forgot-admin-new-password').value;
                const confirmPassword = document.getElementById('forgot-admin-confirm-password').value;

                // ตรวจสอบข้อมูลพื้นฐาน
                if (!fullname || !nationalId || !userId || !newPassword || !confirmPassword) {
                    showNotification('⚠️ กรุณากรอกข้อมูลให้ครบถ้วน', 'error');
                    return;
                }

                // ตรวจสอบรหัสประจำตัวประชาชน
                if (!/^\d{13}$/.test(nationalId)) {
                    showNotification('⚠️ รหัสประจำตัวประชาชนต้องเป็นตัวเลข 13 หลัก', 'error');
                    return;
                }

                // ตรวจสอบความยาวรหัสผ่าน
                if (newPassword.length < 6) {
                    showNotification('⚠️ รหัสผ่านต้องมีอย่างน้อย 6 ตัวอักษร', 'error');
                    return;
                }

                // ตรวจสอบการยืนยันรหัสผ่าน
                if (newPassword !== confirmPassword) {
                    const errorElement = document.getElementById('admin-forgot-password-error');
                    if (errorElement) errorElement.style.display = 'block';
                    showNotification('❌ รหัสผ่านไม่ตรงกัน', 'error');
                    return;
                }

                // ซ่อน error message
                const errorElement = document.getElementById('admin-forgot-password-error');
                if (errorElement) errorElement.style.display = 'none';

                // เรียกใช้ฟังก์ชันรีเซ็ตรหัสผ่าน
                resetPassword('admin', {
                    fullname: fullname,
                    nationalId: nationalId,
                    userId: userId,
                    newPassword: newPassword
                });
            });
        }

        // ปิด modal เมื่อคลิกข้างนอก
        window.onclick = function (event) {
            const modals = ['product-modal', 'cart-modal', 'product-management-modal', 'order-management-modal', 'order-tracking-modal', 'student-profile-modal', 'admin-profile-modal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // แสดงหน้าหลักเมื่อโหลดเสร็จ
        document.addEventListener('DOMContentLoaded', function () {
            goBack();

            // แสดงข้อมูลทดสอบใน Console
            console.log('🎓 ระบบจัดการสินค้ามหาวิทยาลัยเทคโนโลยีราชมงคลอีสาน วิทยาเขตขอนแก่น');
            console.log('💡 ข้อมูลทดสอบ:');
            console.log('👨‍🎓 นักศึกษา: รหัส 641234567 รหัสผ่าน 123456');
            console.log('👨‍💼 เจ้าหน้าที่: รหัส A001 รหัสผ่าน admin123');
            console.log('');
            console.log('🆕 ระบบใหม่:');
            console.log('📱 นักศึกษา: Dashboard แยก, ตะกร้าสินค้า, ติดตามสถานะครบถ้วน');
            console.log('🛠️ Admin: Dashboard จัดการ, สถิติ, จัดการคำสั่งซื้อ');
            console.log('🚚 ระบบติดตาม: 7 สถานะ (รอชำระ → รอยืนยัน → รออนุมัติ → เตรียมสินค้า → พร้อมรับ → เสร็จสิ้น → ยกเลิก)');
            console.log('🔑 ระบบลืมรหัสผ่าน: ส่งผ่านอีเมลหรือ SMS (จำลอง)');
        });

        // สร้างข้อมูลประวัติการเคลื่อนไหวสต็อกตัวอย่าง
        stockMovements.push({
            id: movementIdCounter++,
            productId: 1,
            productName: 'เสื้อที่ระลึกครบรอบ 60 ปี RMUTI',
            type: 'in',
            quantity: 20,
            stockBefore: 0,
            stockAfter: 20,
            note: 'รับสินค้าเข้าคลังครั้งแรก',
            timestamp: '22 สิงหาคม 2568, 09:00',
            adminId: 'A001',
            adminName: 'อรุณ ศรีสุข'
        });

        stockMovements.push({
            id: movementIdCounter++,
            productId: 1,
            productName: 'เสื้อที่ระลึกครบรอบ 60 ปี RMUTI',
            type: 'out',
            quantity: 5,
            stockBefore: 20,
            stockAfter: 15,
            note: 'จ่ายสินค้าออกคลัง เหตุผล: ขาย',
            timestamp: '22 สิงหาคม 2568, 14:30',
            adminId: 'A001',
            adminName: 'อรุณ ศรีสุข'
        });

        stockMovements.push({
            id: movementIdCounter++,
            productId: 2,
            productName: 'เสื้อช็อปมหาวิทยาลัย',
            type: 'in',
            quantity: 60,
            stockBefore: 0,
            stockAfter: 60,
            note: 'รับสินค้าเข้าคลัง จาก บริษัทแฟชั่น จำกัด ต้นทุน 200 บาท/หน่วย',
            timestamp: '21 สิงหาคม 2568, 10:15',
            adminId: 'A001',
            adminName: 'อรุณ ศรีสุข'
        });

        stockMovements.push({
            id: movementIdCounter++,
            productId: 2,
            productName: 'เสื้อช็อปมหาวิทยาลัย',
            type: 'out',
            quantity: 10,
            stockBefore: 60,
            stockAfter: 50,
            note: 'จ่ายสินค้าออกคลัง เหตุผล: ขาย',
            timestamp: '22 สิงหาคม 2568, 11:20',
            adminId: 'A001',
            adminName: 'อรุณ ศรีสุข'
        });

        stockMovements.push({
            id: movementIdCounter++,
            productId: 3,
            productName: 'สมุดบันทึกมหาวิทยาลัย',
            type: 'adjust',
            quantity: 100,
            stockBefore: 105,
            stockAfter: 100,
            note: 'ปรับปรุงสต็อก เหตุผล: นับสต็อกผิดพลาด - พบสินค้าเสียหาย 5 เล่ม',
            timestamp: '20 สิงหาคม 2568, 16:45',
            adminId: 'A001',
            adminName: 'อรุณ ศรีสุข'
        });

        // อัพเดท movementIdCounter
        movementIdCounter = 6;

        // สร้างข้อมูลคำสั่งซื้อตัวอย่าง
        orders.push({
            id: 'ORD-001',
            studentId: '641234567',
            studentName: 'สมชาย ใจดี',
            items: [
                { id: 1, name: 'เสื้อที่ระลึกครบรอบ 60 ปี RMUTI', price: 350, quantity: 2, image: products[0].image },
                { id: 3, name: 'สมุดบันทึกมหาวิทยาลัย', price: 10, quantity: 5, image: products[2].image }
            ],
            total: 750,
            date: getCurrentDateTime(),
            status: 'pending-approval',
            tracking: [
                {
                    status: 'pending-payment',
                    timestamp: '18 สิงหาคม 2568, 09:00',
                    description: 'สร้างคำสั่งซื้อเรียบร้อยแล้ว รอการชำระเงิน'
                },
                {
                    status: 'pending-confirmation',
                    timestamp: '18 สิงหาคม 2568, 09:30',
                    description: 'นักศึกษายืนยันการชำระเงินแล้ว รอเจ้าหน้าที่ตรวจสอบ'
                },
                {
                    status: 'pending-approval',
                    timestamp: '18 สิงหาคม 2568, 10:00',
                    description: 'เจ้าหน้าที่ยืนยันการชำระเงินแล้ว รอการอนุมัติ'
                }
            ]
        });

        orders.push({
            id: 'ORD-002',
            studentId: '642345678',
            studentName: 'สุดา มีสุข',
            items: [
                { id: 2, name: 'เสื้อช็อปมหาวิทยาลัย', price: 350, quantity: 1, image: products[1].image },
                { id: 4, name: 'เนคไทนักศึกษาชาย', price: 150, quantity: 2, image: products[3].image }
            ],
            total: 650,
            date: '17 สิงหาคม 2568, 14:30',
            status: 'completed',
            tracking: [
                {
                    status: 'pending-payment',
                    timestamp: '17 สิงหาคม 2568, 14:30',
                    description: 'สร้างคำสั่งซื้อเรียบร้อยแล้ว รอการชำระเงิน'
                },
                {
                    status: 'pending-confirmation',
                    timestamp: '17 สิงหาคม 2568, 15:00',
                    description: 'นักศึกษายืนยันการชำระเงินแล้ว รอเจ้าหน้าที่ตรวจสอบ'
                },
                {
                    status: 'pending-approval',
                    timestamp: '17 สิงหาคม 2568, 15:30',
                    description: 'เจ้าหน้าที่ยืนยันการชำระเงินแล้ว รอการอนุมัติ'
                },
                {
                    status: 'preparing',
                    timestamp: '17 สิงหาคม 2568, 16:00',
                    description: 'เจ้าหน้าที่อนุมัติคำสั่งซื้อแล้ว กำลังเตรียมสินค้า'
                },
                {
                    status: 'ready',
                    timestamp: '18 สิงหาคม 2568, 08:00',
                    description: 'สินค้าเตรียมเรียบร้อยแล้ว พร้อมสำหรับการรับ'
                },
                {
                    status: 'completed',
                    timestamp: '18 สิงหาคม 2568, 11:00',
                    description: 'นักศึกษายืนยันการรับสินค้าเรียบร้อยแล้ว'
                }
            ]
        });

        orders.push({
            id: 'ORD-003',
            studentId: '641234567',
            studentName: 'สมชาย ใจดี',
            items: [
                { id: 3, name: 'สมุดบันทึกมหาวิทยาลัย', price: 10, quantity: 10, image: products[2].image }
            ],
            total: 100,
            date: '16 สิงหาคม 2568, 11:15',
            status: 'ready',
            tracking: [
                {
                    status: 'pending-payment',
                    timestamp: '16 สิงหาคม 2568, 11:15',
                    description: 'สร้างคำสั่งซื้อเรียบร้อยแล้ว รอการชำระเงิน'
                },
                {
                    status: 'pending-confirmation',
                    timestamp: '16 สิงหาคม 2568, 11:30',
                    description: 'นักศึกษายืนยันการชำระเงินแล้ว รอเจ้าหน้าที่ตรวจสอบ'
                },
                {
                    status: 'pending-approval',
                    timestamp: '16 สิงหาคม 2568, 12:00',
                    description: 'เจ้าหน้าที่ยืนยันการชำระเงินแล้ว รอการอนุมัติ'
                },
                {
                    status: 'preparing',
                    timestamp: '16 สิงหาคม 2568, 13:00',
                    description: 'เจ้าหน้าที่อนุมัติคำสั่งซื้อแล้ว กำลังเตรียมสินค้า'
                },
                {
                    status: 'ready',
                    timestamp: '17 สิงหาคม 2568, 08:00',
                    description: 'สินค้าเตรียมเรียบร้อยแล้ว พร้อมสำหรับการรับ'
                }
            ]
        });
        // อัพเดท movementIdCounter
        movementIdCounter = 6;

        // สร้างข้อมูลคำสั่งซื้อตัวอย่าง
        orders.push({
            // ... โค้ดเดิม
        });

        // เพิ่มโค้ดใหม่ตรงนี้ (ก่อนบรรทัด 10040)

        function loadUserManagementTable() {
            const studentCount = Object.keys(users.students).length;
            const adminCount = Object.keys(users.admins).length;
            const totalCount = studentCount + adminCount;

            document.getElementById('count-all').textContent = totalCount;
            document.getElementById('count-students').textContent = studentCount;
            document.getElementById('count-admins').textContent = adminCount;

            const activeTab = document.querySelector('.tab-btn.active').id;

            if (activeTab === 'tab-all') {
                displayUserTable('all');
            } else if (activeTab === 'tab-students') {
                displayUserTable('students');
            } else if (activeTab === 'tab-admins') {
                displayUserTable('admins');
            }
        }

        function showUserTab(tabType) {
            document.getElementById('management-buttons-all').style.display = tabType === 'all' ? 'inline-flex' : 'none';
            document.getElementById('management-buttons-students').style.display = tabType === 'students' ? 'inline-flex' : 'none';
            document.getElementById('management-buttons-admins').style.display = tabType === 'admins' ? 'inline-flex' : 'none';

            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`tab-${tabType}`).classList.add('active');

            displayUserTable(tabType);
        }

        function showAddStudentForm() {
            document.getElementById('user-management-modal').style.display = 'none';

            const modalContent = document.getElementById('modal-product-content');
            modalContent.innerHTML = `
                <h2><i class="fas fa-user-plus"></i> เพิ่มนักศึกษาใหม่</h2>
                
                <form id="addStudentForm">
                    <div class="form-group">
                        <label for="new-student-id">รหัสนักศึกษา *</label>
                        <input type="text" id="new-student-id" placeholder="กรอกรหัสนักศึกษา" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="student-firstname">ชื่อ *</label>
                            <input type="text" id="student-firstname" placeholder="กรอกชื่อ" required>
                        </div>
                        <div class="form-group">
                            <label for="student-lastname">นามสกุล *</label>
                            <input type="text" id="student-lastname" placeholder="กรอกนามสกุล" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="student-faculty">คณะ *</label>
                        <select id="student-faculty" required>
                            <option value="">เลือกคณะ</option>
                            <option value="engineering">คณะวิศวกรรมศาสตร์</option>
                            <option value="business">คณะบริหารธุรกิจและเทคโนโลยีสารสนเทศ</option>
                            <option value="education">คณะครุศาสตร์อุตสาหกรรม</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="student-major">สาขาวิชา *</label>
                            <input type="text" id="student-major" placeholder="กรอกสาขาวิชา" required>
                        </div>
                        <div class="form-group">
                            <label for="student-year">ชั้นปี *</label>
                            <select id="student-year" required>
                                <option value="">เลือกชั้นปี</option>
                                <option value="1">ปี 1</option>
                                <option value="2">ปี 2</option>
                                <option value="3">ปี 3</option>
                                <option value="4">ปี 4</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="student-email">อีเมล *</label>
                        <input type="email" id="student-email" placeholder="กรอกที่อยู่อีเมล" required>
                    </div>

                    <div class="form-group">
                        <label for="student-phone">เบอร์โทรศัพท์ *</label>
                        <input type="tel" id="student-phone" placeholder="กรอกเบอร์โทรศัพท์" required>
                    </div>

                    <div class="form-group">
                        <label for="student-password">รหัสผ่าน *</label>
                        <input type="password" id="student-password" placeholder="กรอกรหัสผ่าน" required>
                    </div>

                    <div class="button-group">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> บันทึกข้อมูล
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="closeModalAndShowUserManagement()">
                            <i class="fas fa-arrow-left"></i> กลับ
                        </button>
                    </div>
                </form>
            `;

            document.getElementById('product-modal').style.display = 'block';

            document.getElementById('addStudentForm').addEventListener('submit', function (e) {
                e.preventDefault();
                addNewStudent();
            });
        }

        function showAddAdminForm() {
            document.getElementById('user-management-modal').style.display = 'none';

            const modalContent = document.getElementById('modal-product-content');
            modalContent.innerHTML = `
                <h2><i class="fas fa-user-tie"></i> เพิ่มเจ้าหน้าที่ใหม่</h2>
                
                <form id="addAdminForm">
                    <div class="form-group">
                        <label for="new-admin-id">รหัสเจ้าหน้าที่ *</label>
                        <input type="text" id="new-admin-id" placeholder="กรอกรหัสเจ้าหน้าที่" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="admin-firstname">ชื่อ *</label>
                            <input type="text" id="admin-firstname" placeholder="กรอกชื่อ" required>
                        </div>
                        <div class="form-group">
                            <label for="admin-lastname">นามสกุล *</label>
                            <input type="text" id="admin-lastname" placeholder="กรอกนามสกุล" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="admin-department">แผนก/สาขา *</label>
                        <input type="text" id="admin-department" placeholder="กรอกแผนกหรือสาขา" required>
                    </div>

                    <div class="form-group">
                        <label for="admin-email">อีเมล *</label>
                        <input type="email" id="admin-email" placeholder="กรอกที่อยู่อีเมล" required>
                    </div>

                    <div class="form-group">
                        <label for="admin-phone">เบอร์โทรศัพท์ *</label>
                        <input type="tel" id="admin-phone" placeholder="กรอกเบอร์โทรศัพท์" required>
                    </div>

                    <div class="form-group">
                        <label for="admin-password">รหัสผ่าน *</label>
                        <input type="password" id="admin-password" placeholder="กรอกรหัสผ่าน" required>
                    </div>

                    <div class="button-group">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> บันทึกข้อมูล
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="closeModalAndShowUserManagement()">
                            <i class="fas fa-arrow-left"></i> กลับ
                        </button>
                    </div>
                </form>
            `;

            document.getElementById('product-modal').style.display = 'block';

            document.getElementById('addAdminForm').addEventListener('submit', function (e) {
                e.preventDefault();
                addNewAdmin();
            });
        }

        function showImportStudentsModal() {
            document.getElementById('user-management-modal').style.display = 'none';

            const modalContent = document.getElementById('modal-product-content');
            modalContent.innerHTML = `
                <h2><i class="fas fa-file-excel"></i> Import ข้อมูลนักศึกษาจาก Excel</h2>
                
                <div style="background: #e8f5e8; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h4 style="color: #28a745; margin-bottom: 15px;">รูปแบบไฟล์ Excel ที่รองรับ</h4>
                    <p>ไฟล์ Excel ต้องมีคอลัมน์ดังนี้:</p>
                    <ul>
                        <li><strong>รหัสนักศึกษา</strong> (student_id)</li>
                        <li><strong>ชื่อ</strong> (firstname)</li>
                        <li><strong>นามสกุล</strong> (lastname)</li>
                        <li><strong>คณะ</strong> (faculty)</li>
                        <li><strong>สาขา</strong> (major)</li>
                        <li><strong>ปีการศึกษา</strong> (year)</li>
                        <li><strong>อีเมล</strong> (email)</li>
                        <li><strong>เบอร์โทร</strong> (phone)</li>
                    </ul>
                </div>

                <form id="importForm">
                    <div class="form-group">
                        <label for="excel-file">เลือกไฟล์ Excel *</label>
                        <input type="file" id="excel-file" accept=".xlsx,.xls" required>
                        <small style="color: #666; display: block; margin-top: 5px;">
                            รองรับเฉพาะไฟล์ .xlsx และ .xls
                        </small>
                    </div>

                    <div class="button-group">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-upload"></i> Import ข้อมูล
                        </button>
                        <button type="button" class="btn btn-info" onclick="downloadExcelTemplate()">
                            <i class="fas fa-download"></i> ดาวน์โหลดแม่แบบ
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="showUserManagement()">
                            <i class="fas fa-arrow-left"></i> กลับ
                        </button>
                    </div>
                </form>
            `;

            document.getElementById('product-modal').style.display = 'block';

            document.getElementById('importForm').addEventListener('submit', function (e) {
                e.preventDefault();
                importStudentData();
            });
        }

        function addNewStudent() {
            const studentData = {
                id: document.getElementById('new-student-id').value.trim(),
                type: 'student',
                firstname: document.getElementById('student-firstname').value.trim(),
                lastname: document.getElementById('student-lastname').value.trim(),
                faculty: document.getElementById('student-faculty').value,
                major: document.getElementById('student-major').value.trim(),
                year: document.getElementById('student-year').value,
                email: document.getElementById('student-email').value.trim(),
                phone: document.getElementById('student-phone').value.trim(),
                password: document.getElementById('student-password').value
            };

            if (users.students[studentData.id]) {
                showNotification('รหัสนักศึกษานี้มีผู้ใช้แล้ว', 'error');
                return;
            }

            users.students[studentData.id] = studentData;
            closeModalAndShowUserManagement();
            showNotification('เพิ่มนักศึกษาเรียบร้อยแล้ว', 'success');
        }

        function addNewAdmin() {
            const adminData = {
                id: document.getElementById('new-admin-id').value.trim(),
                type: 'admin',
                firstname: document.getElementById('admin-firstname').value.trim(),
                lastname: document.getElementById('admin-lastname').value.trim(),
                department: document.getElementById('admin-department').value.trim(),
                email: document.getElementById('admin-email').value.trim(),
                phone: document.getElementById('admin-phone').value.trim(),
                password: document.getElementById('admin-password').value
            };

            if (users.admins[adminData.id]) {
                showNotification('รหัสเจ้าหน้าที่นี้มีผู้ใช้แล้ว', 'error');
                return;
            }

            users.admins[adminData.id] = adminData;
            closeModalAndShowUserManagement();
            showNotification('เพิ่มเจ้าหน้าที่เรียบร้อยแล้ว', 'success');
        }

        function importStudentData() {
            showNotification('ฟีเจอร์ Import Excel กำลังพัฒนา', 'info');
        }

        function downloadExcelTemplate() {
            showNotification('กำลังดาวน์โหลดแม่แบบ Excel...', 'info');
        }

        function closeModalAndShowUserManagement() {
            document.getElementById('product-modal').style.display = 'none';
            document.getElementById('user-management-modal').style.display = 'block';
            showUserTab('all'); // รีเซ็ตกลับไปแท็บทั้งหมด
        }
    </script>
</body>

</html>